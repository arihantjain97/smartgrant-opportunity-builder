Directory Structure:
==================================================
â””â”€â”€ src/
    â”œâ”€â”€ app/
    â”‚   â””â”€â”€ routes/
    â”‚       â””â”€â”€ AppRouter.tsx
    â”œâ”€â”€ components/
    â”‚   â”œâ”€â”€ coach/
    â”‚   â”‚   â””â”€â”€ ChatWindow.tsx
    â”‚   â”œâ”€â”€ common/
    â”‚   â”‚   â”œâ”€â”€ Alert.tsx
    â”‚   â”‚   â”œâ”€â”€ Card.tsx
    â”‚   â”‚   â”œâ”€â”€ Header.tsx
    â”‚   â”‚   â”œâ”€â”€ Launchpad.tsx
    â”‚   â”‚   â”œâ”€â”€ LeadScoreBadge.tsx
    â”‚   â”‚   â”œâ”€â”€ MetricTiles.tsx
    â”‚   â”‚   â”œâ”€â”€ ModeCard.tsx
    â”‚   â”‚   â”œâ”€â”€ PageHeader.tsx
    â”‚   â”‚   â”œâ”€â”€ PeekNextStep.tsx
    â”‚   â”‚   â”œâ”€â”€ Pipeline.tsx
    â”‚   â”‚   â””â”€â”€ StatusBadge.tsx
    â”‚   â”œâ”€â”€ matching/
    â”‚   â”‚   â”œâ”€â”€ IndicativeSubmissionModal.tsx
    â”‚   â”‚   â”œâ”€â”€ LiveResponseCard.tsx
    â”‚   â”‚   â”œâ”€â”€ StatsOverview.tsx
    â”‚   â”‚   â””â”€â”€ StatusCard.tsx
    â”‚   â”œâ”€â”€ preview/
    â”‚   â”‚   â”œâ”€â”€ ConsultantCard.tsx
    â”‚   â”‚   â”œâ”€â”€ DispatchSummary.tsx
    â”‚   â”‚   â””â”€â”€ VendorCard.tsx
    â”‚   â””â”€â”€ ui/
    â”œâ”€â”€ features/
    â”‚   â”œâ”€â”€ dashboard/
    â”‚   â”‚   â”œâ”€â”€ consultant/
    â”‚   â”‚   â”‚   â””â”€â”€ ConsultantDashboard.tsx
    â”‚   â”‚   â”œâ”€â”€ sme/
    â”‚   â”‚   â”‚   â””â”€â”€ SmeDashboard.tsx
    â”‚   â”‚   â””â”€â”€ vendor/
    â”‚   â”‚       â””â”€â”€ VendorDashboard.tsx
    â”‚   â”œâ”€â”€ leads/
    â”‚   â”‚   â”œâ”€â”€ ConsultantLeadInbox.tsx
    â”‚   â”‚   â””â”€â”€ VendorLeadInbox.tsx
    â”‚   â””â”€â”€ opportunityBuilder/
    â”‚       â”œâ”€â”€ comparison/
    â”‚       â”‚   â””â”€â”€ ComparisonView.tsx
    â”‚       â””â”€â”€ sme/
    â”‚           â”œâ”€â”€ CompareDrawer.tsx
    â”‚           â”œâ”€â”€ Step1_GoalCapture.tsx
    â”‚           â”œâ”€â”€ Step2_TRHLS.tsx
    â”‚           â”œâ”€â”€ Step3_PrivacyAndConsent.tsx
    â”‚           â”œâ”€â”€ Step4_MatchingMode.tsx
    â”‚           â”œâ”€â”€ Step5_PreviewAndDispatch.tsx
    â”‚           â”œâ”€â”€ Step5_PreviewDispatch.tsx
    â”‚           â””â”€â”€ Step6_LiveMatchingDashboard.tsx
    â”œâ”€â”€ lib/
    â”‚   â””â”€â”€ utils.ts
    â”œâ”€â”€ mocks/
    â”‚   â”œâ”€â”€ api.ts
    â”‚   â”œâ”€â”€ matching.seeds.ts
    â”‚   â”œâ”€â”€ preview.seeds.ts
    â”‚   â”œâ”€â”€ seeds.trhls.ts
    â”‚   â””â”€â”€ seeds.ts
    â”œâ”€â”€ state/
    â”‚   â”œâ”€â”€ coach/
    â”‚   â”‚   â”œâ”€â”€ coachConfig.ts
    â”‚   â”‚   â”œâ”€â”€ coachMachine.ts
    â”‚   â”‚   â””â”€â”€ types.ts
    â”‚   â”œâ”€â”€ matching/
    â”‚   â”‚   â”œâ”€â”€ modes.ts
    â”‚   â”‚   â”œâ”€â”€ recommendation.ts
    â”‚   â”‚   â”œâ”€â”€ store.ts
    â”‚   â”‚   â””â”€â”€ types.ts
    â”‚   â”œâ”€â”€ opportunity/
    â”‚   â”‚   â””â”€â”€ uiHints.ts
    â”‚   â”œâ”€â”€ preview/
    â”‚   â”‚   â”œâ”€â”€ store.ts
    â”‚   â”‚   â””â”€â”€ types.ts
    â”‚   â”œâ”€â”€ trhls/
    â”‚   â”‚   â”œâ”€â”€ impact.ts
    â”‚   â”‚   â””â”€â”€ store.ts
    â”‚   â”œâ”€â”€ store.ts
    â”‚   â””â”€â”€ types.ts
    â”œâ”€â”€ styles/
    â”‚   â””â”€â”€ index.css
    â”œâ”€â”€ App.tsx
    â””â”€â”€ main.tsx

File: App.tsx
[App.tsx: start]
import AppRouter from './app/routes/AppRouter';

function App() {
  return (
    <div className="min-h-screen bg-slate-50 font-sans">
      <AppRouter />
    </div>
  );
}

export default App;
[App.tsx: end]

File: app/routes/AppRouter.tsx
[AppRouter.tsx: start]
import React, { useState } from 'react';
import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';
import { useAppStore } from '../../state/store';
import { Header } from '../../components/common/Header';
import { SmeDashboard } from '../../features/dashboard/sme/SmeDashboard';
import { VendorDashboard } from '../../features/dashboard/vendor/VendorDashboard';
import { ConsultantDashboard } from '../../features/dashboard/consultant/ConsultantDashboard';
import { VendorLeadInbox } from '../../features/leads/VendorLeadInbox';
import { ConsultantLeadInbox } from '../../features/leads/ConsultantLeadInbox';
import { Step1_GoalCapture } from '../../features/opportunityBuilder/sme/Step1_GoalCapture';
import { Step2_TRHLS } from '../../features/opportunityBuilder/sme/Step2_TRHLS';
import { Step3_PrivacyAndConsent } from '../../features/opportunityBuilder/sme/Step3_PrivacyAndConsent';
import { Step4_MatchingMode } from '../../features/opportunityBuilder/sme/Step4_MatchingMode';
import { Step5_PreviewDispatch } from '../../features/opportunityBuilder/sme/Step5_PreviewDispatch';
import { Step6_LiveMatchingDashboard } from '../../features/opportunityBuilder/sme/Step6_LiveMatchingDashboard';
import { ComparisonView } from '../../features/opportunityBuilder/comparison/ComparisonView';

const AppRouter: React.FC = () => {
  const { currentPersona } = useAppStore();
  const [currentStep, setCurrentStep] = useState(1);

  const handleStartNewOpportunity = () => {
    setCurrentStep(1);
  };

  const handleNextStep = () => {
    setCurrentStep(prev => prev + 1);
  };

  const handleBackStep = () => {
    setCurrentStep(prev => prev - 1);
  };

  const handleFinish = () => {
    setCurrentStep(1);
  };

  const renderSMEBuilder = () => {
    switch (currentStep) {
      case 1:
        return <Step1_GoalCapture onNext={handleNextStep} onBack={handleFinish} />;
      case 2:
        return <Step2_TRHLS onNext={handleNextStep} onBack={handleBackStep} />;
      case 3:
        return <Step3_PrivacyAndConsent onNext={handleNextStep} onBack={handleBackStep} />;
      case 4:
        return <Step4_MatchingMode onNext={handleNextStep} onBack={handleBackStep} />;
      case 5:
        return <Step5_PreviewDispatch onNext={handleNextStep} onBack={handleBackStep} />;
      case 6:
        return <Step6_LiveMatchingDashboard onBack={handleBackStep} />;
      default:
        return <Step1_GoalCapture onNext={handleNextStep} onBack={handleFinish} />;
    }
  };

  const renderDashboard = () => {
    switch (currentPersona) {
      case 'SME':
        return <SmeDashboard onStartNewOpportunity={() => {}} />;
      case 'VENDOR':
        return <VendorDashboard onViewLead={(leadId) => console.log('View lead:', leadId)} />;
      case 'CONSULTANT':
        return <ConsultantDashboard onViewLead={(leadId) => console.log('View lead:', leadId)} />;
      default:
        return <SmeDashboard onStartNewOpportunity={() => {}} />;
    }
  };

  const renderLeadInbox = () => {
    switch (currentPersona) {
      case 'VENDOR':
        return <VendorLeadInbox />;
      case 'CONSULTANT':
        return <ConsultantLeadInbox />;
      default:
        return <Navigate to="/dashboard" replace />;
    }
  };

  return (
    <Router>
      <Header />
      <main className="p-4 md:p-6">
        <Routes>
          <Route path="/" element={<Navigate to="/dashboard" replace />} />
          <Route path="/dashboard" element={renderDashboard()} />
          <Route path="/leads" element={renderLeadInbox()} />
          <Route path="/sme/builder" element={renderSMEBuilder()} />
          <Route path="/comparison/:reqDocId" element={<ComparisonView reqDocId="reqdoc-1" onBack={() => window.history.back()} />} />
          <Route path="*" element={<Navigate to="/dashboard" replace />} />
        </Routes>
      </main>
    </Router>
  );
};

export default AppRouter;
[AppRouter.tsx: end]

File: components/coach/ChatWindow.tsx
[ChatWindow.tsx: start]
import React, { useEffect, useRef, useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Brain, User, CheckCircle, Sparkles } from 'lucide-react';
import { ChatMessage } from '../../state/coach/types';

interface ChatWindowProps {
  messages: ChatMessage[];
  onAction: (actionId: string) => void;
  isTyping?: boolean;
}

const TypingDots: React.FC<{ visible: boolean }> = ({ visible }) => {
  if (!visible) return null;
  
  return (
    <motion.div
      initial={{ opacity: 0, y: 10 }}
      animate={{ opacity: 1, y: 0 }}
      exit={{ opacity: 0, y: -10 }}
      className="flex items-center gap-2 text-sm text-slate-500 py-2"
    >
      <div className="flex gap-1">
        <motion.div
          className="w-2 h-2 bg-blue-400 rounded-full"
          animate={{ scale: [1, 1.2, 1] }}
          transition={{ duration: 0.6, repeat: Infinity, delay: 0 }}
        />
        <motion.div
          className="w-2 h-2 bg-blue-400 rounded-full"
          animate={{ scale: [1, 1.2, 1] }}
          transition={{ duration: 0.6, repeat: Infinity, delay: 0.2 }}
        />
        <motion.div
          className="w-2 h-2 bg-blue-400 rounded-full"
          animate={{ scale: [1, 1.2, 1] }}
          transition={{ duration: 0.6, repeat: Infinity, delay: 0.4 }}
        />
      </div>
      <span>AI Coach is typing...</span>
    </motion.div>
  );
};

const MessageBubble: React.FC<{ 
  message: ChatMessage; 
  onAction: (actionId: string) => void;
  index: number;
}> = ({ message, onAction, index }) => {
  const getRoleIcon = (role: string) => {
    switch (role) {
      case 'AI':
        return <Brain size={16} className="text-blue-600" />;
      case 'SME':
        return <User size={16} className="text-slate-600" />;
      case 'SYSTEM':
        return <CheckCircle size={16} className="text-emerald-600" />;
      default:
        return null;
    }
  };

  const getBubbleStyles = (role: string) => {
    switch (role) {
      case 'AI':
        return 'bg-gradient-to-br from-[#F0F6FF] to-[#F9FBFF] border-[#E0E8F8] text-gray-700';
      case 'SME':
        return 'bg-white border-gray-200 text-gray-900';
      case 'SYSTEM':
        return 'bg-[#F9FAFB] text-gray-500 text-sm italic border-0';
      default:
        return 'bg-slate-50 border-slate-200 text-slate-800';
    }
  };

  const getContainerStyles = (role: string) => {
    switch (role) {
      case 'AI':
        return 'justify-start';
      case 'SME':
        return 'justify-end';
      case 'SYSTEM':
        return 'justify-center';
      default:
        return 'justify-start';
    }
  };

  return (
    <motion.div
      initial={{ opacity: 0, scale: 0.95, y: 10 }}
      animate={{ opacity: 1, scale: 1, y: 0 }}
      transition={{ 
        duration: 0.25, 
        delay: index * 0.1,
        ease: "easeOut"
      }}
      className={`flex ${getContainerStyles(message.role)} mb-4`}
    >
      <motion.div 
        className={`max-w-[80%] rounded-2xl border p-4 shadow-sm ${getBubbleStyles(message.role)}`}
        whileHover={{ scale: 1.02 }}
        transition={{ duration: 0.2 }}
      >
        <div className="flex items-start gap-2 mb-2">
          {getRoleIcon(message.role)}
          <span className={`text-xs font-medium uppercase tracking-wide ${
            message.role === 'AI' ? 'text-blue-700' : 
            message.role === 'SME' ? 'text-gray-700' : 
            'text-gray-500'
          }`}>
            {message.role === 'SME' ? 'You' : message.role === 'AI' ? 'AI Coach' : 'System'}
          </span>
        </div>
        
        <div className="text-sm leading-relaxed whitespace-pre-line">
          {message.text}
        </div>
        
        {message.actions && message.actions.length > 0 && (
          <motion.div 
            className="mt-3 flex flex-wrap gap-2"
            initial={{ opacity: 0, y: 5 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.3 }}
          >
            {message.actions.map((action) => (
              <motion.button
                key={action.id}
                onClick={() => onAction(action.id)}
                className="px-3 py-1.5 bg-white border border-slate-300 rounded-lg text-xs font-medium text-slate-700 hover:bg-slate-50 hover:border-slate-400 transition-all duration-200"
                whileHover={{ scale: 1.05, boxShadow: "0 4px 12px rgba(0,0,0,0.1)" }}
                whileTap={{ scale: 0.98 }}
              >
                {action.label}
              </motion.button>
            ))}
          </motion.div>
        )}
      </motion.div>
    </motion.div>
  );
};

export const ChatWindow: React.FC<ChatWindowProps> = ({ messages, onAction, isTyping = false }) => {
  const chatEndRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    chatEndRef.current?.scrollIntoView({ behavior: "smooth" });
  }, [messages, isTyping]);

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.4, ease: "easeOut" }}
      className="bg-white rounded-2xl border border-slate-200 shadow-lg overflow-hidden"
    >
      {/* Sticky Header */}
      <div className="sticky top-0 bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-slate-200 px-6 py-4">
        <div className="flex items-center gap-2">
          <div className="w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center">
            <Brain size={16} className="text-white" />
          </div>
          <h3 className="font-semibold text-slate-900">AI Coach</h3>
          <Sparkles size={16} className="text-blue-500" />
        </div>
      </div>

      {/* Chat Content */}
      <div className="max-h-[420px] overflow-y-auto px-6 py-4">
        <div className="space-y-4">
          {messages.length === 0 ? (
            <motion.div 
              className="text-center text-slate-500 py-8"
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              transition={{ delay: 0.2 }}
            >
              <Brain size={32} className="mx-auto mb-2 text-slate-400" />
              <p className="text-sm">AI Coach is ready to help refine your goal</p>
            </motion.div>
          ) : (
            <AnimatePresence>
              {messages.map((message, index) => (
                <MessageBubble
                  key={message.id}
                  message={message}
                  onAction={onAction}
                  index={index}
                />
              ))}
            </AnimatePresence>
          )}
          
          <TypingDots visible={isTyping} />
          <div ref={chatEndRef} />
        </div>
      </div>
    </motion.div>
  );
};
[ChatWindow.tsx: end]

File: components/common/Alert.tsx
[Alert.tsx: start]
import React from 'react';
import { motion } from 'framer-motion';
import { CheckCircle, AlertCircle, Info, X } from 'lucide-react';

interface AlertProps {
  variant?: 'success' | 'warning' | 'error' | 'info';
  children: React.ReactNode;
  onClose?: () => void;
  className?: string;
}

export const Alert: React.FC<AlertProps> = ({ 
  variant = 'info', 
  children, 
  onClose,
  className = "" 
}) => {
  const getVariantStyles = () => {
    switch (variant) {
      case 'success':
        return 'bg-emerald-50 border-emerald-200 text-emerald-800';
      case 'warning':
        return 'bg-amber-50 border-amber-200 text-amber-800';
      case 'error':
        return 'bg-red-50 border-red-200 text-red-800';
      case 'info':
      default:
        return 'bg-blue-50 border-blue-200 text-blue-800';
    }
  };

  const getIcon = () => {
    switch (variant) {
      case 'success':
        return <CheckCircle size={16} className="text-emerald-600" />;
      case 'warning':
        return <AlertCircle size={16} className="text-amber-600" />;
      case 'error':
        return <X size={16} className="text-red-600" />;
      case 'info':
      default:
        return <Info size={16} className="text-blue-600" />;
    }
  };

  return (
    <motion.div
      initial={{ opacity: 0, y: 10 }}
      animate={{ opacity: 1, y: 0 }}
      exit={{ opacity: 0, y: -10 }}
      transition={{ duration: 0.3, ease: "easeOut" }}
      className={`rounded-xl border p-4 ${getVariantStyles()} ${className}`}
    >
      <div className="flex items-start gap-3">
        {getIcon()}
        <div className="flex-1 text-sm font-medium">
          {children}
        </div>
        {onClose && (
          <button
            onClick={onClose}
            className="text-slate-400 hover:text-slate-600 transition-colors"
          >
            <X size={16} />
          </button>
        )}
      </div>
    </motion.div>
  );
};
[Alert.tsx: end]

File: components/common/Card.tsx
[Card.tsx: start]
import React from 'react';
import { cn } from '../../lib/utils';

interface CardProps {
  children: React.ReactNode;
  className?: string;
  onClick?: () => void;
}

export const Card: React.FC<CardProps> = ({ children, className = "", onClick }) => (
  <div 
    onClick={onClick} 
    className={cn(
      "bg-white rounded-xl shadow-sm border border-slate-200/60 p-4 sm:p-6 transition-all duration-200",
      onClick ? 'cursor-pointer hover:shadow-md hover:-translate-y-0.5 hover:border-slate-300' : '',
      className
    )}
  >
    {children}
  </div>
);
[Card.tsx: end]

File: components/common/Header.tsx
[Header.tsx: start]
import React from 'react';
import { Bell, MessageSquare, CircleDollarSign, LayoutDashboard, ShoppingCart } from 'lucide-react';
import { useAppStore } from '../../state/store';
import { Persona } from '../../state/types';
import { useNavigate, useLocation } from 'react-router-dom';

const SmartGrantLogo = () => (
  <svg width="28" height="28" viewBox="0 0 54 52" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M27 51.5L0.5 0.5H53.5L27 51.5Z" fill="black" stroke="#FBBF24"/>
    <path d="M27 51.5L0.5 0.5H27V51.5Z" fill="#FBBF24"/>
    <path d="M27 26L53.5 0.5H27V26Z" fill="#D97706"/>
    <path d="M13.5 26L27 0.5H0.5L13.5 26Z" fill="#111827"/>
    <path d="M40.5 26L27 51.5L53.5 0.5L40.5 26Z" fill="#111827"/>
  </svg>
);

const RoleButton: React.FC<{ role: Persona; isActive: boolean; onClick: () => void }> = ({ role, isActive, onClick }) => (
  <button 
    onClick={onClick} 
    className={`px-3 py-1.5 sm:px-4 sm:py-2 text-xs sm:text-sm font-medium rounded-lg transition-all duration-200 ${
      isActive 
        ? 'bg-blue-600 text-white shadow-sm' 
        : 'bg-white text-slate-700 hover:bg-slate-100 border border-slate-200'
    }`}
  >
    {role.charAt(0) + role.slice(1).toLowerCase()}
  </button>
);

const NavTab: React.FC<{ tabId: string; label: string; icon: React.ElementType; isActive: boolean; onClick: () => void }> = ({ label, icon: Icon, isActive, onClick }) => (
  <button 
    onClick={onClick} 
    className={`flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-t-lg transition-colors border-b-2 ${
      isActive 
        ? 'border-blue-500 text-blue-600' 
        : 'border-transparent text-slate-500 hover:text-slate-700'
    }`}
  >
    <Icon size={16} />
    {label}
  </button>
);

export const Header: React.FC = () => {
  const { currentPersona, setCurrentPersona } = useAppStore();
  const navigate = useNavigate();
  const location = useLocation();
  const personas: Persona[] = ['SME', 'CONSULTANT', 'VENDOR'];

  return (
    <>
      <header className="bg-white sticky top-0 z-30 flex items-center justify-between h-16 px-4 md:px-6 border-b border-slate-200 shadow-sm">
        <div className="flex items-center gap-4">
          <SmartGrantLogo />
          <h1 className="hidden sm:block text-xl font-bold text-slate-800">
            SmartGrant.ai
          </h1>
        </div>
        
        <div className="flex items-center gap-1 bg-slate-100 p-1 rounded-lg">
          {personas.map(role => (
            <RoleButton
              key={role}
              role={role}
              isActive={currentPersona === role}
              onClick={() => setCurrentPersona(role)}
            />
          ))}
        </div>
        
        <div className="flex items-center gap-2 sm:gap-4">
          <button className="p-2 text-slate-500 rounded-full hover:bg-slate-200 transition-colors">
            <Bell size={20}/>
          </button>
          <button className="p-2 text-slate-500 rounded-full hover:bg-slate-200 transition-colors">
            <MessageSquare size={20}/>
          </button>
          <button className="p-2 text-slate-500 rounded-full hover:bg-slate-200 transition-colors">
            <CircleDollarSign size={20}/>
          </button>
          <img 
            src={`https://i.pravatar.cc/40?u=${currentPersona}`} 
            alt="User Avatar" 
            className="w-10 h-10 rounded-full border-2 border-transparent hover:border-indigo-500" 
          />
        </div>
      </header>
      
      {(currentPersona === 'CONSULTANT' || currentPersona === 'VENDOR') && (location.pathname === '/dashboard' || location.pathname === '/leads') && (
        <div className="flex items-center border-b border-slate-200">
          <NavTab 
            tabId="dashboard" 
            label="Dashboard" 
            icon={LayoutDashboard} 
            isActive={location.pathname === '/dashboard'} 
            onClick={() => navigate('/dashboard')} 
          />
          <NavTab 
            tabId="leads" 
            label="Lead Marketplace" 
            icon={ShoppingCart} 
            isActive={location.pathname === '/leads'} 
            onClick={() => navigate('/leads')} 
          />
        </div>
      )}
    </>
  );
};
[Header.tsx: end]

File: components/common/Launchpad.tsx
[Launchpad.tsx: start]
import React from 'react';
import { Card } from './Card';

interface LaunchpadProps {
  onStartNewOpportunity: () => void;
}

export const Launchpad: React.FC<LaunchpadProps> = ({ onStartNewOpportunity }) => {
  return (
    <Card className="text-center bg-gradient-to-r from-indigo-50 to-blue-50 border-indigo-200/50">
      <div className="flex items-center justify-center gap-2 mb-2">
        <span className="text-2xl">âœ¨</span>
        <h2 className="text-xl font-semibold text-slate-900">Launchpad</h2>
      </div>
      <p className="text-slate-600 mb-6">Turn your business goals into a live project.</p>
      <button 
        onClick={onStartNewOpportunity}
        className="bg-indigo-600 text-white font-medium px-8 py-3 rounded-lg hover:bg-indigo-700 transition-colors shadow-sm hover:shadow-md"
      >
        Start New Opportunity
      </button>
    </Card>
  );
};
[Launchpad.tsx: end]

File: components/common/LeadScoreBadge.tsx
[LeadScoreBadge.tsx: start]
import React from 'react';

interface LeadScoreBadgeProps {
  score?: number;
  statusText?: string;
}

export const LeadScoreBadge: React.FC<LeadScoreBadgeProps> = ({ score = 68, statusText }) => {
  const status = statusText || (score >= 80 ? "Hot" : score >= 60 ? "Warm" : "Cold");
  const color = status === "Hot" 
    ? "bg-red-50 text-red-700 border border-red-200"
    : status === "Warm" 
    ? "bg-amber-50 text-amber-700 border border-amber-200"
    : "bg-slate-50 text-slate-600 border border-slate-200";
    
  return (
    <div className="flex items-center gap-2">
      <span className={`px-2 py-1 rounded-md text-xs font-medium ${color}`}>
        {status}
      </span>
      <span className="text-xs text-slate-500 font-medium">Score {score}</span>
    </div>
  );
};
[LeadScoreBadge.tsx: end]

File: components/common/MetricTiles.tsx
[MetricTiles.tsx: start]
import React from 'react';
import { LucideIcon, ShieldCheck, Award, DollarSign, FileText } from 'lucide-react';
import { Card } from './Card';

interface KpiCardProps {
  icon: LucideIcon;
  title: string;
  value: string;
  gradient: string;
  iconColor: string;
}

const KpiCard: React.FC<KpiCardProps> = ({ icon: Icon, title, value, gradient, iconColor }) => (
  <Card className={`relative overflow-hidden ${gradient} border-0 shadow-sm`}>
    <div className="flex items-start justify-between">
      <div>
        <p className="font-medium text-slate-600 text-sm">{title}</p>
        <p className="text-3xl font-bold text-slate-900 mt-1">{value}</p>
      </div>
      <Icon className={`w-8 h-8 ${iconColor} opacity-80`} />
    </div>
  </Card>
);

export const MetricTiles: React.FC = () => {
  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      <KpiCard 
        title="Eligibility Score" 
        value="82%" 
        icon={ShieldCheck} 
        gradient="bg-gradient-to-br from-emerald-50 to-emerald-100" 
        iconColor="text-emerald-600" 
      />
      <KpiCard 
        title="Grants Matched" 
        value="6" 
        icon={Award} 
        gradient="bg-gradient-to-br from-blue-50 to-blue-100" 
        iconColor="text-blue-600" 
      />
      <KpiCard 
        title="Funding Potential" 
        value="S$ 250K" 
        icon={DollarSign} 
        gradient="bg-gradient-to-br from-amber-50 to-amber-100" 
        iconColor="text-amber-600" 
      />
      <KpiCard 
        title="Apps in Progress" 
        value="2" 
        icon={FileText} 
        gradient="bg-gradient-to-br from-violet-50 to-violet-100" 
        iconColor="text-violet-600" 
      />
    </div>
  );
};
[MetricTiles.tsx: end]

File: components/common/ModeCard.tsx
[ModeCard.tsx: start]
import React from 'react';
import { motion } from 'framer-motion';
import { 
  UserCheck, 
  ListChecks,
  FileCheck2,
  Hand, 
  Send,
  Users,
  UsersRound,
  ClipboardCheck,
  Layers,
  Store,
  Inbox,
  Heart,
  CheckCircle
} from 'lucide-react';
import { Card } from './Card';
import { MATCHING_MODES } from '../../state/matching/modes';

interface ModeCardProps {
  mode: keyof typeof MATCHING_MODES;
  isSelected: boolean;
  onSelect: () => void;
  isMobile?: boolean;
}

const iconMap = {
  UserCheck,
  ListChecks,
  FileCheck2,
  Hand,
  Send,
  Users,
  UsersRound,
  ClipboardCheck,
  Layers,
  Store,
  Inbox,
  Heart
};

const getIcon = (iconName: string) => {
  const IconComponent = iconMap[iconName as keyof typeof iconMap];
  return IconComponent || UserCheck;
};

const Badge: React.FC<{ 
  children: React.ReactNode; 
  variant?: 'default' | 'secondary' | 'outline';
  className?: string;
}> = ({ children, variant = 'default', className = "" }) => {
  const baseClasses = "px-2 py-1 rounded-full text-xs font-medium";
  const variantClasses = {
    default: "bg-indigo-100 text-indigo-700",
    secondary: "bg-slate-100 text-slate-700",
    outline: "bg-emerald-50 text-emerald-700 border border-emerald-200"
  };
  
  return (
    <span className={`${baseClasses} ${variantClasses[variant]} ${className}`}>
      {children}
    </span>
  );
};

export const ModeCard: React.FC<ModeCardProps> = ({ 
  mode, 
  isSelected, 
  onSelect, 
  isMobile = false 
}) => {
  const modeData = MATCHING_MODES[mode];
  
  return (
    <motion.div
      whileHover={{ scale: 1.02, transition: { duration: 0.2 } }}
      whileTap={{ scale: 0.98 }}
      onClick={onSelect}
      className="cursor-pointer"
    >
      <Card className={`p-6 rounded-2xl border shadow-sm hover:shadow-md transition-all ${
        isSelected ? 'ring-2 ring-indigo-500 bg-indigo-50/30' : 'bg-white'
      }`}>
        {/* Selection Badge */}
        {isSelected && (
          <motion.div
            initial={{ scale: 0 }}
            animate={{ scale: 1 }}
            className="absolute -top-2 -right-2 w-6 h-6 bg-indigo-600 rounded-full flex items-center justify-center shadow-lg"
          >
            <CheckCircle size={14} className="text-white" />
          </motion.div>
        )}

        {/* Header */}
        <div className="flex justify-between items-start mb-2">
          <h3 className="font-semibold text-slate-900 text-lg">{modeData.title}</h3>
          {modeData.recommended && (
            <Badge variant="outline">Recommended</Badge>
          )}
        </div>

        {/* Tags */}
        <div className="flex flex-wrap gap-2 mb-6">
          {modeData.badges.map((badge: string) => (
            <Badge key={badge} variant="secondary">{badge}</Badge>
          ))}
        </div>

        {/* Flow Row - Iconic */}
        <div className="mb-6">
          <div className="flex justify-between">
            {modeData.roles.map((role: any, index: number) => {
              const Icon = getIcon(role.icon);
              return (
                <motion.div
                  key={role.label}
                  initial={{ opacity: 0, y: 10 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: index * 0.1 }}
                  className="flex flex-col items-center flex-1"
                >
                  <div className="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center mb-2">
                    <Icon size={18} className="text-indigo-600" />
                  </div>
                  <span className="text-xs text-slate-600 text-center leading-tight">
                    {role.label}
                  </span>
                </motion.div>
              );
            })}
          </div>
        </div>

        {/* Outcome Strip */}
        <div className="py-3 border-t border-slate-200 mb-4">
          <p className="text-sm text-slate-600 text-center">{modeData.outcome}</p>
        </div>

        {/* Preview Next Step - Inline Timeline */}
        <div className="bg-slate-50 rounded-lg p-4">
          <p className="text-xs font-medium text-slate-500 mb-3 text-center">Preview next step</p>
          {isMobile ? (
            // Mobile: Horizontal scroll
            <div className="flex gap-4 overflow-x-auto pb-2">
              {modeData.timeline.map((step: any, index: number) => {
                const Icon = getIcon(step.icon);
                return (
                  <motion.div
                    key={index}
                    initial={{ opacity: 0, x: 20 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ delay: 0.2 + index * 0.1 }}
                    className="flex flex-col items-center flex-shrink-0 min-w-[80px]"
                  >
                    <div className="w-8 h-8 bg-white rounded-full flex items-center justify-center mb-2 shadow-sm">
                      <Icon size={14} className="text-indigo-600" />
                    </div>
                    <span className="text-[10px] text-center text-slate-600 leading-tight">
                      {step.step}
                    </span>
                  </motion.div>
                );
              })}
            </div>
          ) : (
            // Desktop: Full timeline
            <div className="flex justify-between">
              {modeData.timeline.map((step: any, index: number) => {
                const Icon = getIcon(step.icon);
                return (
                  <motion.div
                    key={index}
                    initial={{ opacity: 0, y: 10 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ delay: 0.2 + index * 0.1 }}
                    className="flex flex-col items-center flex-1"
                  >
                    <div className="w-8 h-8 bg-white rounded-full flex items-center justify-center mb-2 shadow-sm">
                      <Icon size={14} className="text-indigo-600" />
                    </div>
                    <span className="text-[10px] text-center text-slate-600 leading-tight">
                      {step.step}
                    </span>
                  </motion.div>
                );
              })}
            </div>
          )}
        </div>
      </Card>
    </motion.div>
  );
};
[ModeCard.tsx: end]

File: components/common/PageHeader.tsx
[PageHeader.tsx: start]
import React from 'react';

interface PageHeaderProps {
  title: string;
  subtitle?: string;
  children?: React.ReactNode;
}

export const PageHeader: React.FC<PageHeaderProps> = ({ title, subtitle, children }) => (
  <div className="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-6">
    <div>
      <h2 className="text-2xl md:text-3xl font-bold text-slate-900">
        {title}
      </h2>
      {subtitle && (
        <p className="text-slate-600 mt-1 max-w-2xl">
          {subtitle}
        </p>
      )}
    </div>
    <div className="mt-4 lg:mt-0 w-full lg:w-auto">
      {children}
    </div>
  </div>
);
[PageHeader.tsx: end]

File: components/common/PeekNextStep.tsx
[PeekNextStep.tsx: start]
import React from 'react';
import { motion } from 'framer-motion';
import { X, Users, FileText, CheckCircle, ArrowRight } from 'lucide-react';

interface PeekNextStepProps {
  isOpen: boolean;
  onClose: () => void;
  selectedMode: 'CONSULTANT_MANAGED' | 'SME_SELF_MANAGED';
}

const StepCard: React.FC<{ 
  step: number; 
  title: string; 
  description: string; 
  icon: React.ElementType;
  index: number;
}> = ({ step, title, description, icon: Icon, index }) => (
  <motion.div
    initial={{ opacity: 0, y: 20 }}
    animate={{ opacity: 1, y: 0 }}
    transition={{ delay: index * 0.1 }}
    className="flex items-start gap-4 p-4 bg-slate-50 rounded-lg"
  >
    <div className="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center flex-shrink-0">
      <span className="text-sm font-bold text-indigo-600">{step}</span>
    </div>
    <div className="flex-1">
      <div className="flex items-center gap-2 mb-1">
        <Icon size={16} className="text-slate-600" />
        <h4 className="font-medium text-slate-900 text-sm">{title}</h4>
      </div>
      <p className="text-xs text-slate-600">{description}</p>
    </div>
  </motion.div>
);

export const PeekNextStep: React.FC<PeekNextStepProps> = ({ 
  isOpen, 
  onClose, 
  selectedMode 
}) => {
  const isConsultant = selectedMode === 'CONSULTANT_MANAGED';

  const consultantSteps = [
    {
      step: 1,
      title: "We invite top consultants",
      description: "SmartGrant identifies and invites 3-5 qualified consultants based on your project scope and grant requirements.",
      icon: Users
    },
    {
      step: 2,
      title: "You review proposals",
      description: "Consultants submit detailed proposals with vendor recommendations, timelines, and grant application strategies.",
      icon: FileText
    },
    {
      step: 3,
      title: "Consultant shortlists vendors",
      description: "Your chosen consultant creates a curated shortlist of vendors and manages the invitation process.",
      icon: CheckCircle
    }
  ];

  const selfManagedSteps = [
    {
      step: 1,
      title: "We invite top vendors",
      description: "SmartGrant identifies and invites 5-8 qualified vendors based on your TRHLS selections and requirements.",
      icon: Users
    },
    {
      step: 2,
      title: "You review quotations",
      description: "Vendors submit detailed quotations with pricing, timelines, and implementation plans for your review.",
      icon: FileText
    },
    {
      step: 3,
      title: "We invite consultants (optional)",
      description: "If you need grant support, we can connect you with consultants to assist with applications.",
      icon: CheckCircle
    }
  ];

  const steps = isConsultant ? consultantSteps : selfManagedSteps;

  return (
    <motion.div
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      className="fixed inset-0 bg-black/50 z-50 flex items-end md:items-center justify-center p-4"
      onClick={onClose}
    >
      <motion.div
        initial={{ y: '100%', opacity: 0 }}
        animate={{ y: 0, opacity: 1 }}
        exit={{ y: '100%', opacity: 0 }}
        transition={{ duration: 0.3, ease: "easeOut" }}
        className="bg-white rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Header */}
        <div className="sticky top-0 bg-gradient-to-r from-indigo-50 to-sky-50 border-b border-slate-200 px-6 py-4">
          <div className="flex items-center justify-between">
            <div>
              <h2 className="text-lg font-semibold text-slate-900">What happens next</h2>
              <p className="text-sm text-slate-600">
                {isConsultant ? 'Consultant-Managed' : 'SME Self-Managed'} workflow
              </p>
            </div>
            <button
              onClick={onClose}
              className="p-2 text-slate-400 hover:text-slate-600 transition-colors"
            >
              <X size={20} />
            </button>
          </div>
        </div>

        {/* Content */}
        <div className="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
          <div className="space-y-4">
            {steps.map((step, index) => (
              <StepCard
                key={step.step}
                step={step.step}
                title={step.title}
                description={step.description}
                icon={step.icon}
                index={index}
              />
            ))}
          </div>

          {/* Reassurance */}
          <motion.div
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.4 }}
            className="mt-6 p-4 bg-emerald-50 rounded-lg border border-emerald-200"
          >
            <div className="flex items-center gap-2">
              <CheckCircle size={16} className="text-emerald-600" />
              <p className="text-sm text-emerald-800">
                You can switch modes before invitations are sent out.
              </p>
            </div>
          </motion.div>
        </div>

        {/* Footer */}
        <div className="sticky bottom-0 bg-white border-t border-slate-200 px-6 py-4">
          <div className="flex items-center justify-between">
            <p className="text-xs text-slate-500">
              Ready to proceed with {isConsultant ? 'consultant-guided' : 'self-managed'} workflow?
            </p>
            <motion.button
              onClick={onClose}
              className="bg-indigo-600 text-white font-medium px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors flex items-center gap-2 text-sm"
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
            >
              Got it
              <ArrowRight size={14} />
            </motion.button>
          </div>
        </div>
      </motion.div>
    </motion.div>
  );
};
[PeekNextStep.tsx: end]

File: components/common/Pipeline.tsx
[Pipeline.tsx: start]
import React from 'react';
import { Users, Briefcase, DollarSign } from 'lucide-react';
import { Card } from './Card';
import { LeadScoreBadge } from './LeadScoreBadge';

interface PipelineColumnProps {
  title: string;
  children: React.ReactNode;
}

const PipelineColumn: React.FC<PipelineColumnProps> = ({ title, children }) => (
  <div className="bg-slate-50 p-4 rounded-xl min-w-[250px] flex-shrink-0 border border-slate-200/60">
    <h4 className="font-medium text-slate-700 mb-4 px-1 text-sm uppercase tracking-wide">{title}</h4>
    <div className="space-y-3">{children}</div>
  </div>
);

interface PipelineItemCardProps {
  title: string;
  badge: React.ReactNode;
  vendors: string;
  consultants: string;
  budget: string;
}

const PipelineItemCard: React.FC<PipelineItemCardProps> = ({ title, badge, vendors, consultants, budget }) => (
  <Card className="!p-4 !bg-white border-slate-200/60">
    <div className="flex justify-between items-start mb-3">
      <p className="font-medium text-slate-900 pr-2 text-sm">{title}</p>
      {badge}
    </div>
    <div className="flex items-center gap-4 text-xs text-slate-500 mt-3 pt-3 border-t border-slate-100">
      <span className="flex items-center gap-1"><Users size={12}/>{vendors}</span>
      <span className="flex items-center gap-1"><Briefcase size={12}/>{consultants}</span>
      <span className="flex items-center gap-1"><DollarSign size={12}/>{budget}</span>
    </div>
  </Card>
);

export const Pipeline: React.FC = () => {
  return (
    <div className="flex gap-4 pb-4 overflow-x-auto">
      <PipelineColumn title="Drafting">
        <PipelineItemCard 
          title="Upgrade ERP System" 
          badge={<LeadScoreBadge score={85} />} 
          vendors="3" 
          consultants="2" 
          budget="S$40k" 
        />
      </PipelineColumn>
      <PipelineColumn title="In Matching">
        <PipelineItemCard 
          title="Marketing Automation Tool" 
          badge={<LeadScoreBadge score={76} />} 
          vendors="5" 
          consultants="1" 
          budget="S$25k" 
        />
      </PipelineColumn>
      <PipelineColumn title="In Q&A">
        <PipelineItemCard 
          title="Cybersecurity Upgrade" 
          badge={<LeadScoreBadge score={68} />} 
          vendors="2" 
          consultants="1" 
          budget="S$30k" 
        />
      </PipelineColumn>
      <PipelineColumn title="Decisioned">
        <PipelineItemCard 
          title="E-Commerce Revamp" 
          badge={
            <span className="px-2 py-0.5 rounded-full text-xs font-bold bg-green-100 text-green-700 dark:bg-green-500/20 dark:text-green-300">
              Accepted âœ”ï¸
            </span>
          } 
          vendors="1" 
          consultants="1" 
          budget="S$50k" 
        />
      </PipelineColumn>
      <PipelineColumn title="In Delivery">
        <PipelineItemCard 
          title="POS System Installation" 
          badge={
            <span className="px-2 py-0.5 rounded-full text-xs font-bold bg-blue-100 text-blue-700 dark:bg-blue-500/20 dark:text-blue-300">
              Ongoing ğŸš€
            </span>
          } 
          vendors="1" 
          consultants="0" 
          budget="S$15k" 
        />
      </PipelineColumn>
    </div>
  );
};
[Pipeline.tsx: end]

File: components/common/StatusBadge.tsx
[StatusBadge.tsx: start]
import React from 'react';

interface StatusBadgeProps {
  status: string;
  type?: 'application' | 'task' | 'quote' | 'user';
}

export const StatusBadge: React.FC<StatusBadgeProps> = ({ status, type = 'application' }) => {
  const styles = {
    application: { 
      "Approved": "bg-emerald-50 text-emerald-700 border border-emerald-200", 
      "In Review": "bg-amber-50 text-amber-700 border border-amber-200", 
      "Drafting": "bg-blue-50 text-blue-700 border border-blue-200" 
    },
    task: { 
      "High": "bg-red-50 text-red-700 border border-red-200", 
      "Medium": "bg-amber-50 text-amber-700 border border-amber-200", 
      "Low": "bg-slate-50 text-slate-600 border border-slate-200" 
    },
    quote: { 
      "Pending": "bg-blue-50 text-blue-700 border border-blue-200", 
      "Submitted": "bg-amber-50 text-amber-700 border border-amber-200", 
      "Accepted": "bg-emerald-50 text-emerald-700 border border-emerald-200" 
    },
    user: { 
      "Active": "bg-emerald-50 text-emerald-700 border border-emerald-200", 
      "Pending Approval": "bg-amber-50 text-amber-700 border border-amber-200" 
    },
  };
  
  const statusClass = (styles[type] as any)?.[status] || 'bg-slate-100 text-slate-700 border border-slate-200';
  
  return (
    <span className={`px-3 py-1 text-xs sm:text-sm font-medium rounded-full whitespace-nowrap ${statusClass}`}>
      {status}
    </span>
  );
};
[StatusBadge.tsx: end]

File: components/matching/IndicativeSubmissionModal.tsx
[IndicativeSubmissionModal.tsx: start]
import React, { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { 
  X, 
  DollarSign, 
  Calendar, 
  CheckCircle, 
  ArrowRight,
  Star,
  Clock,
  User,
  Building2,
  BadgePercent,
  FileCheck2,
  Settings,
  Search
} from 'lucide-react';
import { LeadResponse } from '../../state/matching/types';

interface IndicativeSubmissionModalProps {
  response: LeadResponse | null;
  onClose: () => void;
}

export const IndicativeSubmissionModal: React.FC<IndicativeSubmissionModalProps> = ({ 
  response, 
  onClose 
}) => {
  if (!response || !response.indicativeSubmission) return null;

  const submission = response.indicativeSubmission;
  const isConsultant = response.type === 'CONSULTANT';

  const Section: React.FC<{ title: string; children: React.ReactNode; defaultOpen?: boolean }>
    = ({ title, children, defaultOpen = true }) => {
    const [open, setOpen] = useState(defaultOpen);
    return (
      <div className="mb-6">
        <button
          onClick={() => setOpen(!open)}
          className="w-full flex items-center justify-between text-left"
        >
          <span className="text-lg font-semibold text-slate-900">{title}</span>
          <span className="text-sm text-slate-500">{open ? 'Hide' : 'Show'}</span>
        </button>
        <AnimatePresence initial={false}>
          {open && (
            <motion.div
              initial={{ opacity: 0, y: 8 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: 8 }}
              className="mt-3"
            >
              {children}
            </motion.div>
          )}
        </AnimatePresence>
      </div>
    );
  };

  return (
    <AnimatePresence>
      <motion.div
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        exit={{ opacity: 0 }}
        className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"
        onClick={onClose}
      >
        <motion.div
          initial={{ opacity: 0, scale: 0.95, y: 20 }}
          animate={{ opacity: 1, scale: 1, y: 0 }}
          exit={{ opacity: 0, scale: 0.95, y: 20 }}
          className="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden"
          onClick={(e) => e.stopPropagation()}
        >
          {/* Header */}
          <div className="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white">
            <div className="flex items-center justify-between mb-4">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                  <User size={20} />
                </div>
                <div>
                  <h2 className="text-xl font-semibold">{response.name}</h2>
                  <p className="text-indigo-100 text-sm">
                    {response.type === 'VENDOR' ? 'Vendor' : 'Consultant'} Submission
                  </p>
                </div>
              </div>
              <motion.button
                onClick={onClose}
                className="p-2 hover:bg-white/20 rounded-lg transition-colors"
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.9 }}
              >
                <X size={20} />
              </motion.button>
            </div>
            
            <div className="flex items-center gap-4">
              <div className="flex items-center gap-2">
                <Star size={16} className="text-amber-300" />
                <span className="text-sm font-medium">{response.qualificationScore}% Match</span>
              </div>
              <div className="flex items-center gap-2">
                <Clock size={16} className="text-indigo-200" />
                <span className="text-sm">
                  Responded in {response.responseTime?.toFixed(1)}h
                </span>
              </div>
            </div>
          </div>

          {/* Content */}
          <div className="p-6 overflow-y-auto max-h-[calc(90vh-200px)]">
            {/* Header Summary strip */}
            <div className="mb-6 flex flex-wrap items-center gap-2">
              {response.type === 'VENDOR' ? (
                <div className="px-2 py-1 bg-green-50 text-green-700 text-xs rounded-full border border-green-200 flex items-center gap-1">
                  <Building2 size={14} /> Grant-Applicable
                </div>
              ) : (
                <div className="px-2 py-1 bg-blue-50 text-blue-700 text-xs rounded-full border border-blue-200 flex items-center gap-1">
                  <BadgePercent size={14} /> Grant Fit
                </div>
              )}
              <div className="px-2 py-1 bg-slate-100 text-slate-700 text-xs rounded-full flex items-center gap-1">
                <Star size={12} className="text-amber-500" /> {response.qualificationScore}% Match
              </div>
              {submission.tags?.map((t) => (
                <span key={t} className="px-2 py-1 bg-slate-100 text-slate-700 text-xs rounded-full">{t}</span>
              ))}
            </div>

            {/* Title */}
            <h3 className="text-2xl font-bold text-slate-900 mb-2">{submission.title}</h3>
            <p className="text-slate-600 mb-4">{submission.summary}</p>
            
            {/* Consultant vs Vendor sections */}
            {isConsultant ? (
              <>
                {submission.understanding && (
                  <Section title="Understanding of Your Goal">
                    <p className="text-slate-700">{submission.understanding}</p>
                  </Section>
                )}

                {submission.approachPhases && submission.approachPhases.length > 0 && (
                  <Section title="Proposed Approach">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                      {submission.approachPhases.map((p, idx) => (
                        <div key={idx} className="p-3 bg-indigo-50 rounded-lg border border-indigo-100">
                          <div className="flex items-center gap-2 mb-1">
                            {p.icon === 'Search' && <Search size={14} className="text-indigo-600" />}
                            {p.icon === 'Settings' && <Settings size={14} className="text-indigo-600" />}
                            {p.icon === 'FileCheck2' && <FileCheck2 size={14} className="text-indigo-600" />}
                            <span className="font-medium text-slate-900">{p.label}</span>
                          </div>
                          <div className="text-xs text-slate-600">{p.weeks}</div>
                        </div>
                      ))}
                    </div>
                  </Section>
                )}

                <Section title="Estimated Timeline & Effort">
                  <div className="grid grid-cols-2 gap-4">
                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                      <div className="flex items-center gap-2 mb-2">
                        <Calendar size={16} className="text-blue-600" />
                        <span className="font-medium text-blue-800">Timeline</span>
                      </div>
                      <div className="text-xl font-bold text-blue-900">
                        {submission.timeline[0]} - {submission.timeline[1]} months
                      </div>
                    </div>
                    <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                      <div className="flex items-center gap-2 mb-2">
                        <DollarSign size={16} className="text-green-600" />
                        <span className="font-medium text-green-800">Indicative Fee Band</span>
                      </div>
                      <div className="text-xl font-bold text-green-900">
                        S$ {submission.estimatedCost[0].toLocaleString()}K - {submission.estimatedCost[1].toLocaleString()}K
                      </div>
                      <div className="text-xs text-green-700 mt-1">Advisory + Grant Paperwork</div>
                    </div>
                  </div>
                </Section>

                {submission.team && submission.team.length > 0 && (
                  <Section title="Consultant Team">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                      {submission.team.map((m, i) => (
                        <div key={i} className="flex items-center gap-3 p-3 bg-slate-50 rounded-lg">
                          <div className="w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center text-slate-600">
                            {m.name.split(' ').map(s=>s[0]).join('').slice(0,2)}
                          </div>
                          <div>
                            <div className="font-medium text-slate-900">{m.name}</div>
                            <div className="text-xs text-slate-600">{m.role}</div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </Section>
                )}

                {submission.similarProjects && submission.similarProjects.length > 0 && (
                  <Section title="Similar Projects Delivered">
                    <div className="space-y-2">
                      {submission.similarProjects.map((sp, i) => (
                        <div key={i} className="p-3 bg-slate-50 rounded-lg text-sm text-slate-700">
                          <span className="font-medium">{sp.sector}</span> â€” {sp.result}
                        </div>
                      ))}
                    </div>
                  </Section>
                )}

                {submission.assumptions && submission.assumptions.length > 0 && (
                  <Section title="Dependencies & Assumptions">
                    <ul className="list-disc ml-5 text-slate-700 space-y-1">
                      {submission.assumptions.map((a, i) => <li key={i}>{a}</li>)}
                    </ul>
                  </Section>
                )}
              </>
            ) : (
              <>
                <Section title="Solution Overview">
                  <p className="text-slate-700">{submission.summary}</p>
                </Section>

                {submission.keyFeatures?.length > 0 && (
                  <Section title="Why This Fits Your Goal">
                    <div className="flex flex-wrap gap-2">
                      {submission.keyFeatures.slice(0,4).map((f, i) => (
                        <span key={i} className="px-2 py-1 bg-indigo-50 text-indigo-700 text-xs rounded-full">{f}</span>
                      ))}
                    </div>
                  </Section>
                )}

                {submission.breakdown && (
                  <Section title="Product / Service Breakdown">
                    <div className="space-y-2">
                      {submission.breakdown.map((b, i) => (
                        <div key={i} className="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                          <span className="text-slate-700">{b.item}</span>
                          {b.costBand && (
                            <span className="text-sm font-medium text-slate-900">S$ {b.costBand[0].toLocaleString()}K - {b.costBand[1].toLocaleString()}K</span>
                          )}
                        </div>
                      ))}
                    </div>
                  </Section>
                )}

                <Section title="Indicative Cost & Timeline">
                  <div className="grid grid-cols-2 gap-4">
                    <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                      <div className="flex items-center gap-2 mb-2">
                        <DollarSign size={16} className="text-green-600" />
                        <span className="font-medium text-green-800">Total Cost (non-binding)</span>
                      </div>
                      <div className="text-xl font-bold text-green-900">
                        S$ {submission.estimatedCost[0].toLocaleString()}K - {submission.estimatedCost[1].toLocaleString()}K
                      </div>
                    </div>
                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                      <div className="flex items-center gap-2 mb-2">
                        <Calendar size={16} className="text-blue-600" />
                        <span className="font-medium text-blue-800">Implementation Timeline</span>
                      </div>
                      <div className="text-xl font-bold text-blue-900">
                        {submission.timeline[0]} - {submission.timeline[1]} months
                      </div>
                    </div>
                  </div>
                </Section>

                {(submission.grantEligible || submission.grantTag) && (
                  <Section title="Grant Eligibility / Status">
                    <div className="px-3 py-2 bg-green-50 border border-green-200 rounded-lg inline-flex items-center gap-2 text-green-700">
                      <Building2 size={14} />
                      <span>
                        {submission.grantEligible ? 'Eligible' : 'Potentially eligible'} {submission.grantTag ? `(${submission.grantTag})` : ''}
                      </span>
                    </div>
                    <p className="text-xs text-slate-600 mt-2">Eligible for up to 50% support, subject to approval.</p>
                  </Section>
                )}

                {(submission.support || submission.addOns) && (
                  <Section title="Support & Add-Ons">
                    {submission.support && (
                      <p className="text-slate-700 mb-2">{submission.support}</p>
                    )}
                    {submission.addOns && (
                      <div className="flex flex-wrap gap-2">
                        {submission.addOns.map((a, i) => (
                          <span key={i} className="px-2 py-1 bg-slate-100 text-slate-700 text-xs rounded-full">{a}</span>
                        ))}
                      </div>
                    )}
                  </Section>
                )}
              </>
            )}

            {/* Next Steps (shared) */}
            {submission.nextSteps?.length > 0 && (
              <div className="mb-6">
                <h4 className="text-lg font-semibold text-slate-900 mb-3">Next Steps</h4>
                <div className="space-y-3">
                  {submission.nextSteps.map((step, index) => (
                    <motion.div
                      key={index}
                      initial={{ opacity: 0, x: -20 }}
                      animate={{ opacity: 1, x: 0 }}
                      transition={{ delay: index * 0.1 }}
                      className="flex items-start gap-3 p-3 bg-slate-50 rounded-lg"
                    >
                      <div className="w-6 h-6 bg-indigo-600 text-white rounded-full flex items-center justify-center text-sm font-semibold flex-shrink-0">
                        {index + 1}
                      </div>
                      <span className="text-slate-700">{step}</span>
                    </motion.div>
                  ))}
                </div>
              </div>
            )}
          </div>

          {/* Footer with sticky mobile CTA */}
          <div className="bg-slate-50 border-t border-slate-200 p-6 sticky bottom-0">
            <div className="flex items-center justify-between">
              <div className="text-sm text-slate-600">
                This is an indicative submission. Contact {response.name} for detailed discussions.
              </div>
              <div className="flex items-center gap-3">
                <motion.button
                  onClick={onClose}
                  className="px-4 py-2 text-slate-600 hover:text-slate-800 transition-colors"
                  whileHover={{ scale: 1.02 }}
                  whileTap={{ scale: 0.98 }}
                >
                  Close
                </motion.button>
                <motion.button
                  className="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors flex items-center gap-2"
                  whileHover={{ scale: 1.02 }}
                  whileTap={{ scale: 0.98 }}
                >
                  Contact {response.name}
                  <ArrowRight size={16} />
                </motion.button>
              </div>
            </div>
          </div>
        </motion.div>
      </motion.div>
    </AnimatePresence>
  );
};
[IndicativeSubmissionModal.tsx: end]

File: components/matching/LiveResponseCard.tsx
[LiveResponseCard.tsx: start]
import React from 'react';
import { motion } from 'framer-motion';
import { 
  CheckCircle, 
  Clock, 
  Eye,
  Star,
  ArrowRight,
  Building2,
  Users
} from 'lucide-react';
import { LeadResponse } from '../../state/matching/types';

interface LiveResponseCardProps {
  response: LeadResponse;
  onViewSubmission: (response: LeadResponse) => void;
  // Add new props:
  onCompareSelect?: (response: LeadResponse) => void;
  isCompareSelected?: boolean;
  isCompareDisabled?: boolean;
}

const getStatusConfig = (status: LeadResponse['status']) => {
  switch (status) {
    case 'ACCEPTED':
      return {
        icon: CheckCircle,
        color: 'text-green-600',
        bgColor: 'bg-green-50',
        label: 'Accepted',
        dotColor: 'bg-green-500'
      };
    case 'PENDING':
      return {
        icon: Clock,
        color: 'text-amber-600',
        bgColor: 'bg-amber-50',
        label: 'Pending',
        dotColor: 'bg-amber-500'
      };
    default:
      return {
        icon: Clock,
        color: 'text-slate-600',
        bgColor: 'bg-slate-50',
        label: status,
        dotColor: 'bg-slate-500'
      };
  }
};

const getTypeConfig = (type: LeadResponse['type']) => {
  switch (type) {
    case 'VENDOR':
      return {
        icon: Building2,
        label: 'Vendor',
        color: 'text-blue-600'
      };
    case 'CONSULTANT':
      return {
        icon: Users,
        label: 'Consultant',
        color: 'text-purple-600'
      };
  }
};

export const LiveResponseCard: React.FC<LiveResponseCardProps> = ({ 
  response, 
  onViewSubmission, 
  onCompareSelect,
  isCompareSelected = false,
  isCompareDisabled = false,
}) => {
  const statusConfig = getStatusConfig(response.status);
  const typeConfig = getTypeConfig(response.type);
  const StatusIcon = statusConfig.icon;

  const formatTimeRemaining = (expiresAt: Date) => {
    const now = new Date();
    const diff = expiresAt.getTime() - now.getTime();
    const hours = Math.max(0, Math.floor(diff / (1000 * 60 * 60)));
    const minutes = Math.max(0, Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60)));
    
    if (hours > 0) {
      return `${hours}h ${minutes}m`;
    } else if (minutes > 0) {
      return `${minutes}m`;
    } else {
      return 'Expired';
    }
  };

  const formatResponseTime = (responseTime?: number) => {
    if (!responseTime) return null;
    if (responseTime < 1) {
      return `${Math.round(responseTime * 60)}m`;
    }
    return `${responseTime.toFixed(1)}h`;
  };

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      whileHover={{ scale: 1.01 }}
      className={`bg-white border border-slate-200 rounded-xl p-5 hover:border-slate-300 transition-all duration-200 relative`}
    >
      {/* --- NEW: Compare Select Pill --- */}
      <div className="absolute top-3 right-4 z-10 flex gap-2 items-center">
        <button
          type="button"
          onClick={e => { e.stopPropagation(); onCompareSelect && onCompareSelect(response); }}
          disabled={isCompareDisabled}
          className={
            `transition-all text-xs font-semibold px-3 py-1 rounded-full
            border-2 ${isCompareSelected ? 'border-blue-600 bg-blue-50 text-blue-700' : 'border-slate-200 bg-slate-50 text-slate-600'}
            ${isCompareDisabled ? 'opacity-60 pointer-events-none' : 'hover:border-blue-400'}
            shadow-sm`
          }
        >
          {isCompareSelected ? 'âœ“ Selected' : 'â˜‘ï¸ Select to compare'}
        </button>
      </div>
      {/* --- END NEW --- */}
      {/* Header */}
      <div className="flex items-start justify-between mb-4">
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 bg-slate-100 rounded-lg flex items-center justify-center">
            <typeConfig.icon size={18} className={typeConfig.color} />
          </div>
          <div>
            <h3 className="font-semibold text-slate-900">{response.name}</h3>
            <div className="flex items-center gap-2 mt-1">
              <span className="text-xs text-slate-500">{typeConfig.label}</span>
              <span className="text-xs text-slate-400">â€¢</span>
              <div className="flex items-center gap-1">
                <Star size={12} className="text-amber-500" />
                <span className="text-xs font-medium text-slate-600">
                  {response.qualificationScore}% match
                </span>
              </div>
            </div>
          </div>
        </div>
        
        {/* Status Dot */}
        <div className="flex items-center gap-2">
          <div className={`w-2 h-2 rounded-full ${statusConfig.dotColor}`} />
          <span className="text-sm font-medium text-slate-700">{statusConfig.label}</span>
        </div>
      </div>

      {/* Response Info */}
      {response.responseTime && (
        <div className="text-sm text-slate-600 mb-3">
          Responded in {formatResponseTime(response.responseTime)}
        </div>
      )}

      {/* Time Remaining */}
      <div className="text-sm text-slate-500 mb-4">
        {response.status === 'PENDING' 
          ? `Response due in ${formatTimeRemaining(response.expiresAt)}`
          : `Expires in ${formatTimeRemaining(response.expiresAt)}`
        }
      </div>

      {/* Action Button */}
      {response.status === 'ACCEPTED' && response.indicativeSubmission && (
        <motion.button
          onClick={() => onViewSubmission(response)}
          className="w-full flex items-center justify-center gap-2 px-4 py-2 bg-slate-50 text-slate-700 rounded-lg hover:bg-slate-100 transition-colors text-sm font-medium"
          whileHover={{ scale: 1.02 }}
          whileTap={{ scale: 0.98 }}
        >
          <Eye size={16} />
          View Indicative Submission
          <ArrowRight size={14} />
        </motion.button>
      )}

      {response.status === 'PENDING' && (
        <div className="w-full flex items-center justify-center gap-2 px-4 py-2 bg-amber-50 text-amber-700 rounded-lg text-sm font-medium">
          <Clock size={16} />
          Awaiting Response
        </div>
      )}
    </motion.div>
  );
};
[LiveResponseCard.tsx: end]

File: components/matching/StatsOverview.tsx
[StatsOverview.tsx: start]
import React from 'react';
import { motion } from 'framer-motion';
import { 
  CheckCircle, 
  XCircle, 
  Clock, 
  AlertCircle, 
  TrendingUp, 
  Timer,
  Users,
  Target
} from 'lucide-react';
import { MatchingStats, ResponseWindow } from '../../state/matching/types';

interface StatsOverviewProps {
  stats: MatchingStats;
  responseWindow: ResponseWindow;
}

const StatCard: React.FC<{
  icon: React.ReactNode;
  label: string;
  value: string | number;
  color: string;
  bgColor: string;
  trend?: string;
}> = ({ icon, label, value, color, bgColor, trend }) => (
  <motion.div
    initial={{ opacity: 0, scale: 0.95 }}
    animate={{ opacity: 1, scale: 1 }}
    className={`${bgColor} rounded-xl p-4 border border-slate-200`}
  >
    <div className="flex items-center justify-between mb-2">
      <div className={`w-8 h-8 rounded-lg flex items-center justify-center ${color}`}>
        {icon}
      </div>
      {trend && (
        <span className="text-xs font-medium text-green-600 bg-green-100 px-2 py-1 rounded-full">
          {trend}
        </span>
      )}
    </div>
    <div className="text-2xl font-bold text-slate-900 mb-1">{value}</div>
    <div className="text-sm text-slate-600">{label}</div>
  </motion.div>
);

const ResponseWindowCard: React.FC<{ responseWindow: ResponseWindow }> = ({ responseWindow }) => {
  const getUrgencyColor = (hours: number) => {
    if (hours <= 2) return 'text-red-600 bg-red-50 border-red-200';
    if (hours <= 6) return 'text-amber-600 bg-amber-50 border-amber-200';
    return 'text-blue-600 bg-blue-50 border-blue-200';
  };

  const urgencyConfig = getUrgencyColor(responseWindow.hoursRemaining);

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      className={`${urgencyConfig.split(' ')[1]} border-2 ${urgencyConfig.split(' ')[2]} rounded-xl p-4`}
    >
      <div className="flex items-center gap-3 mb-2">
        <Timer size={20} className={urgencyConfig.split(' ')[0]} />
        <span className={`font-semibold ${urgencyConfig.split(' ')[0]}`}>
          Response Window
        </span>
      </div>
      <div className="text-lg font-bold text-slate-900 mb-1">
        {responseWindow.hoursRemaining}h remaining
      </div>
      <div className="text-sm text-slate-600">
        {responseWindow.isUrgent ? 'Urgent - Responses closing soon' : 'Responses still being accepted'}
      </div>
    </motion.div>
  );
};

export const StatsOverview: React.FC<StatsOverviewProps> = ({ stats, responseWindow }) => {
  const responseRate = stats.responseRate;
  const isGoodResponseRate = responseRate >= 70;
  const isUrgent = responseWindow.hoursRemaining <= 6;

  return (
    <div className="space-y-6">
      {/* Response Window Alert */}
      <ResponseWindowCard responseWindow={responseWindow} />

      {/* Main Stats Grid */}
      <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
        <StatCard
          icon={<CheckCircle size={16} className="text-green-600" />}
          label="Accepted"
          value={stats.accepted}
          color="bg-green-100"
          bgColor="bg-white"
          trend={stats.accepted > 0 ? `+${stats.accepted}` : undefined}
        />
        
        <StatCard
          icon={<XCircle size={16} className="text-red-600" />}
          label="Declined"
          value={stats.declined}
          color="bg-red-100"
          bgColor="bg-white"
        />
        
        <StatCard
          icon={<Clock size={16} className="text-amber-600" />}
          label="Pending"
          value={stats.pending}
          color="bg-amber-100"
          bgColor="bg-white"
        />
        
        <StatCard
          icon={<AlertCircle size={16} className="text-slate-600" />}
          label="Expired"
          value={stats.expired}
          color="bg-slate-100"
          bgColor="bg-white"
        />
      </div>

      {/* Performance Metrics */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-4">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="bg-gradient-to-r from-indigo-50 to-purple-50 border border-indigo-200 rounded-xl p-4"
        >
          <div className="flex items-center gap-3 mb-2">
            <TrendingUp size={20} className="text-indigo-600" />
            <span className="font-semibold text-indigo-700">Response Rate</span>
          </div>
          <div className="text-2xl font-bold text-slate-900 mb-1">{responseRate}%</div>
          <div className="text-sm text-slate-600">
            {isGoodResponseRate ? 'Excellent response rate' : 'Good response rate'}
          </div>
        </motion.div>

        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl p-4"
        >
          <div className="flex items-center gap-3 mb-2">
            <Timer size={20} className="text-green-600" />
            <span className="font-semibold text-green-700">Avg Response Time</span>
          </div>
          <div className="text-2xl font-bold text-slate-900 mb-1">{stats.avgResponseTime}h</div>
          <div className="text-sm text-slate-600">Average time to respond</div>
        </motion.div>

        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-xl p-4"
        >
          <div className="flex items-center gap-3 mb-2">
            <Users size={20} className="text-purple-600" />
            <span className="font-semibold text-purple-700">Total Sent</span>
          </div>
          <div className="text-2xl font-bold text-slate-900 mb-1">{stats.totalSent}</div>
          <div className="text-sm text-slate-600">Invitations dispatched</div>
        </motion.div>
      </div>
    </div>
  );
};
[StatsOverview.tsx: end]

File: components/matching/StatusCard.tsx
[StatusCard.tsx: start]
import React from 'react';
import { motion } from 'framer-motion';
import { 
  CheckCircle, 
  XCircle, 
  Clock, 
  AlertCircle, 
  Eye, 
  Star,
  DollarSign,
  Calendar,
  ArrowRight
} from 'lucide-react';
import { LeadResponse } from '../../state/matching/types';

interface StatusCardProps {
  response: LeadResponse;
  onViewSubmission: (response: LeadResponse) => void;
}

const getStatusConfig = (status: LeadResponse['status']) => {
  switch (status) {
    case 'ACCEPTED':
      return {
        icon: CheckCircle,
        color: 'text-green-600',
        bgColor: 'bg-green-50',
        borderColor: 'border-green-200',
        label: 'Accepted',
        labelColor: 'text-green-700'
      };
    case 'DECLINED':
      return {
        icon: XCircle,
        color: 'text-red-600',
        bgColor: 'bg-red-50',
        borderColor: 'border-red-200',
        label: 'Declined',
        labelColor: 'text-red-700'
      };
    case 'PENDING':
      return {
        icon: Clock,
        color: 'text-amber-600',
        bgColor: 'bg-amber-50',
        borderColor: 'border-amber-200',
        label: 'Pending',
        labelColor: 'text-amber-700'
      };
    case 'EXPIRED':
      return {
        icon: AlertCircle,
        color: 'text-slate-600',
        bgColor: 'bg-slate-50',
        borderColor: 'border-slate-200',
        label: 'Expired',
        labelColor: 'text-slate-700'
      };
  }
};

const getTypeConfig = (type: LeadResponse['type']) => {
  switch (type) {
    case 'VENDOR':
      return {
        icon: 'ğŸ¢',
        label: 'Vendor',
        color: 'text-blue-600',
        bgColor: 'bg-blue-50'
      };
    case 'CONSULTANT':
      return {
        icon: 'ğŸ‘¥',
        label: 'Consultant',
        color: 'text-purple-600',
        bgColor: 'bg-purple-50'
      };
  }
};

export const StatusCard: React.FC<StatusCardProps> = ({ response, onViewSubmission }) => {
  const statusConfig = getStatusConfig(response.status);
  const typeConfig = getTypeConfig(response.type);
  const StatusIcon = statusConfig.icon;

  const formatTimeRemaining = (expiresAt: Date) => {
    const now = new Date();
    const diff = expiresAt.getTime() - now.getTime();
    const hours = Math.max(0, Math.floor(diff / (1000 * 60 * 60)));
    const minutes = Math.max(0, Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60)));
    
    if (hours > 0) {
      return `${hours}h ${minutes}m`;
    } else if (minutes > 0) {
      return `${minutes}m`;
    } else {
      return 'Expired';
    }
  };

  const formatResponseTime = (responseTime?: number) => {
    if (!responseTime) return null;
    if (responseTime < 1) {
      return `${Math.round(responseTime * 60)}m`;
    }
    return `${responseTime.toFixed(1)}h`;
  };

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      whileHover={{ scale: 1.02 }}
      className={`relative bg-white rounded-xl border-2 ${statusConfig.borderColor} shadow-sm hover:shadow-md transition-all duration-200`}
    >
      {/* Status Badge */}
      <div className={`absolute -top-2 -right-2 w-8 h-8 ${statusConfig.bgColor} rounded-full flex items-center justify-center shadow-lg`}>
        <StatusIcon size={16} className={statusConfig.color} />
      </div>

      {/* Qualification Score */}
      <div className="absolute top-4 left-4">
        <div className="flex items-center gap-1 px-2 py-1 bg-slate-100 rounded-full">
          <Star size={12} className="text-amber-500" />
          <span className="text-xs font-semibold text-slate-700">{response.qualificationScore}%</span>
        </div>
      </div>

      <div className="p-6">
        {/* Header */}
        <div className="flex items-start gap-4 mb-4">
          <div className="w-12 h-12 bg-gradient-to-br from-slate-100 to-slate-200 rounded-xl flex items-center justify-center text-2xl">
            {typeConfig.icon}
          </div>
          <div className="flex-1">
            <h3 className="font-semibold text-slate-900 mb-1">{response.name}</h3>
            <div className="flex items-center gap-2">
              <span className={`px-2 py-1 rounded-full text-xs font-medium ${typeConfig.bgColor} ${typeConfig.color}`}>
                {typeConfig.label}
              </span>
              <span className={`px-2 py-1 rounded-full text-xs font-medium ${statusConfig.bgColor} ${statusConfig.labelColor}`}>
                {statusConfig.label}
              </span>
            </div>
          </div>
        </div>

        {/* Response Time */}
        {response.responseTime && (
          <div className="flex items-center gap-2 mb-4 text-sm text-slate-600">
            <Clock size={14} />
            <span>Responded in {formatResponseTime(response.responseTime)}</span>
          </div>
        )}

        {/* Time Remaining */}
        <div className="flex items-center gap-2 mb-4 text-sm text-slate-600">
          <Calendar size={14} />
          <span>
            {response.status === 'PENDING' 
              ? `Response due in ${formatTimeRemaining(response.expiresAt)}`
              : `Expires in ${formatTimeRemaining(response.expiresAt)}`
            }
          </span>
        </div>

        {/* Indicative Submission Preview */}
        {response.indicativeSubmission && (
          <div className="bg-slate-50 rounded-lg p-4 mb-4">
            <h4 className="font-medium text-slate-900 mb-2 text-sm">
              {response.indicativeSubmission.title}
            </h4>
            <p className="text-xs text-slate-600 mb-3">
              {response.indicativeSubmission.summary}
            </p>
            
            <div className="grid grid-cols-2 gap-3 mb-3">
              <div className="flex items-center gap-1">
                <DollarSign size={12} className="text-green-600" />
                <span className="text-xs text-slate-700">
                  S$ {response.indicativeSubmission.estimatedCost[0].toLocaleString()}K - {response.indicativeSubmission.estimatedCost[1].toLocaleString()}K
                </span>
              </div>
              <div className="flex items-center gap-1">
                <Calendar size={12} className="text-blue-600" />
                <span className="text-xs text-slate-700">
                  {response.indicativeSubmission.timeline[0]} - {response.indicativeSubmission.timeline[1]} months
                </span>
              </div>
            </div>

            <div className="flex flex-wrap gap-1">
              {response.indicativeSubmission.keyFeatures.slice(0, 2).map((feature, index) => (
                <span
                  key={index}
                  className="px-2 py-1 bg-indigo-100 text-indigo-700 text-xs rounded-full"
                >
                  {feature}
                </span>
              ))}
              {response.indicativeSubmission.keyFeatures.length > 2 && (
                <span className="px-2 py-1 bg-slate-200 text-slate-600 text-xs rounded-full">
                  +{response.indicativeSubmission.keyFeatures.length - 2} more
                </span>
              )}
            </div>
          </div>
        )}

        {/* Action Button */}
        {response.status === 'ACCEPTED' && response.indicativeSubmission && (
          <motion.button
            onClick={() => onViewSubmission(response)}
            className="w-full flex items-center justify-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-sm font-medium"
            whileHover={{ scale: 1.02 }}
            whileTap={{ scale: 0.98 }}
          >
            <Eye size={16} />
            View Indicative Submission
            <ArrowRight size={14} />
          </motion.button>
        )}

        {response.status === 'PENDING' && (
          <div className="w-full flex items-center justify-center gap-2 px-4 py-2 bg-slate-100 text-slate-600 rounded-lg text-sm font-medium">
            <Clock size={16} />
            Awaiting Response
          </div>
        )}

        {response.status === 'DECLINED' && (
          <div className="w-full flex items-center justify-center gap-2 px-4 py-2 bg-red-50 text-red-600 rounded-lg text-sm font-medium">
            <XCircle size={16} />
            Declined
          </div>
        )}

        {response.status === 'EXPIRED' && (
          <div className="w-full flex items-center justify-center gap-2 px-4 py-2 bg-slate-100 text-slate-500 rounded-lg text-sm font-medium">
            <AlertCircle size={16} />
            Response Window Closed
          </div>
        )}
      </div>
    </motion.div>
  );
};
[StatusCard.tsx: end]

File: components/preview/ConsultantCard.tsx
[ConsultantCard.tsx: start]
import React from 'react';
import { motion } from 'framer-motion';
import { Check, Plus, Info, Star, Clock, Award, User } from 'lucide-react';
import { Consultant } from '../../state/preview/types';

interface ConsultantCardProps {
  consultant: Consultant;
  isRecommended: boolean;
  onToggle: (id: string) => void;
  onAdd?: (id: string) => void;
  onInfo?: (consultant: Consultant) => void;
}

const getMatchColor = (match: number) => {
  if (match >= 85) return 'from-green-500 to-emerald-500';
  if (match >= 70) return 'from-blue-500 to-indigo-500';
  return 'from-slate-400 to-slate-500';
};

const getMatchBadge = (match: number) => {
  if (match >= 85) return 'Top Match';
  if (match >= 70) return 'Good Match';
  return 'Fair Match';
};

const getHighlightBadges = (consultant: Consultant) => {
  const badges = [];
  if (consultant.match >= 85) badges.push('Top Match');
  if (consultant.avgTurnaround <= 14) badges.push('Fast Turnaround');
  if (consultant.successRate >= 90) badges.push('High Success Rate');
  return badges;
};

export const ConsultantCard: React.FC<ConsultantCardProps> = ({
  consultant,
  isRecommended,
  onToggle,
  onAdd,
  onInfo
}) => {
  const matchColor = getMatchColor(consultant.match);
  const matchBadge = getMatchBadge(consultant.match);
  const highlightBadges = getHighlightBadges(consultant);

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      whileHover={{ scale: 1.02 }}
      className={`relative rounded-xl border shadow-sm hover:shadow-md transition-all duration-200 ${
        consultant.selected ? 'ring-2 ring-indigo-500 bg-indigo-50/30' : 'bg-white'
      }`}
    >
      {/* Match % Gradient Bar */}
      <div className={`h-1 rounded-t-xl bg-gradient-to-r ${matchColor}`} />
      
      <div className="p-5">
        {/* Header */}
        <div className="flex items-start justify-between mb-3">
          <div className="flex items-center gap-3">
            <div className="w-12 h-12 bg-slate-100 rounded-lg flex items-center justify-center">
              <User size={20} className="text-slate-600" />
            </div>
            <div>
              <h3 className="font-semibold text-slate-900">{consultant.name}</h3>
              <p className="text-sm text-slate-600 mt-1">
                "{consultant.specialty} Â· {consultant.experience} Â· {consultant.successRate}% win rate"
              </p>
            </div>
          </div>
          
          <div className="text-right">
            <div className="flex items-center gap-1 mb-1">
              <Award size={14} className="text-indigo-600" />
              <span className="text-sm font-medium text-slate-900">{matchBadge}</span>
            </div>
            <span className="text-lg font-bold text-indigo-600">{consultant.match}%</span>
          </div>
        </div>

        {/* Core Focus */}
        <div className="mb-3">
          <p className="text-xs font-medium text-slate-500 mb-2">Core Focus:</p>
          <div className="flex flex-wrap gap-1">
            {consultant.coreFocus.map((focus, index) => (
              <span
                key={index}
                className="px-2 py-1 bg-indigo-50 text-indigo-700 text-xs rounded-full"
              >
                {focus}
              </span>
            ))}
          </div>
        </div>

        {/* Stats */}
        <div className="flex items-center gap-4 mb-4 text-sm text-slate-600">
          <div className="flex items-center gap-1">
            <Star size={14} className="text-amber-500" />
            <span>{consultant.rating} / 5</span>
          </div>
          <div className="flex items-center gap-1">
            <Clock size={14} />
            <span>Avg Turnaround: {consultant.avgTurnaround} days</span>
          </div>
        </div>

        {/* Highlight Badges */}
        {highlightBadges.length > 0 && (
          <div className="flex flex-wrap gap-2 mb-4">
            {highlightBadges.map((badge, index) => (
              <span
                key={index}
                className="px-2 py-1 bg-emerald-100 text-emerald-700 text-xs font-medium rounded-full"
              >
                {badge}
              </span>
            ))}
          </div>
        )}

        {/* Actions */}
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-2">
            <motion.button
              onClick={() => onToggle(consultant.id)}
              className={`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all ${
                consultant.selected
                  ? 'bg-indigo-600 text-white'
                  : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
              }`}
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
            >
              <Check size={14} />
              {consultant.selected ? 'Selected' : 'Select'}
            </motion.button>

            {!isRecommended && onAdd && (
              <motion.button
                onClick={() => onAdd(consultant.id)}
                className="flex items-center gap-2 px-3 py-2 text-slate-600 hover:text-slate-800 transition-colors"
                whileHover={{ scale: 1.02 }}
                whileTap={{ scale: 0.98 }}
              >
                <Plus size={14} />
                Add
              </motion.button>
            )}
          </div>

          {onInfo && (
            <motion.button
              onClick={() => onInfo(consultant)}
              className="p-2 text-slate-400 hover:text-slate-600 transition-colors"
              whileHover={{ scale: 1.1 }}
              whileTap={{ scale: 0.9 }}
            >
              <Info size={16} />
            </motion.button>
          )}
        </div>
      </div>
    </motion.div>
  );
};
[ConsultantCard.tsx: end]

File: components/preview/DispatchSummary.tsx
[DispatchSummary.tsx: start]
import React, { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { CheckCircle, Lock, ChevronDown, ChevronUp } from 'lucide-react';

interface DispatchSummaryProps {
  vendorCount: number;
  consultantCount: number;
  visibility: 'PRIVATE' | 'LIMITED' | 'PUBLIC';
  onVisibilityChange: (visibility: 'PRIVATE' | 'LIMITED' | 'PUBLIC') => void;
}

const getVisibilityText = (visibility: 'PRIVATE' | 'LIMITED' | 'PUBLIC') => {
  switch (visibility) {
    case 'PRIVATE': return 'Private (Only you can see)';
    case 'LIMITED': return 'Limited (Only matched vendors/consultants can view lead preview)';
    case 'PUBLIC': return 'Public (Visible to all SmartGrant users)';
  }
};

const getVisibilityColor = (visibility: 'PRIVATE' | 'LIMITED' | 'PUBLIC') => {
  switch (visibility) {
    case 'PRIVATE': return 'text-slate-600';
    case 'LIMITED': return 'text-blue-600';
    case 'PUBLIC': return 'text-green-600';
  }
};

export const DispatchSummary: React.FC<DispatchSummaryProps> = ({
  vendorCount,
  consultantCount,
  visibility,
  onVisibilityChange
}) => {
  const [showVisibilityOptions, setShowVisibilityOptions] = useState(false);

  const totalSelected = vendorCount + consultantCount;
  const canDispatch = vendorCount > 0;

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      className="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl p-6"
    >
      <div className="flex items-start gap-3 mb-4">
        <div className="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0">
          <CheckCircle size={16} className="text-green-600" />
        </div>
        <div className="flex-1">
          <h3 className="font-semibold text-green-900 mb-1">Ready to Dispatch</h3>
          <p className="text-sm text-green-700">
            You've selected {vendorCount} vendor{vendorCount !== 1 ? 's' : ''} and {consultantCount} consultant{consultantCount !== 1 ? 's' : ''}.<br />
            They'll receive masked lead previews (valid 72h) and can accept for 1 credit each.
          </p>
        </div>
      </div>

      {/* Visibility Settings */}
      <div className="border-t border-green-200 pt-4">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-2">
            <Lock size={16} className="text-slate-500" />
            <span className="text-sm font-medium text-slate-700">Visibility:</span>
            <span className={`text-sm ${getVisibilityColor(visibility)}`}>
              {getVisibilityText(visibility)}
            </span>
          </div>
          
          <motion.button
            onClick={() => setShowVisibilityOptions(!showVisibilityOptions)}
            className="flex items-center gap-1 text-sm text-indigo-600 hover:text-indigo-700 transition-colors"
            whileHover={{ scale: 1.02 }}
            whileTap={{ scale: 0.98 }}
          >
            <span>Change visibility</span>
            {showVisibilityOptions ? <ChevronUp size={14} /> : <ChevronDown size={14} />}
          </motion.button>
        </div>

        <AnimatePresence>
          {showVisibilityOptions && (
            <motion.div
              initial={{ opacity: 0, height: 0 }}
              animate={{ opacity: 1, height: 'auto' }}
              exit={{ opacity: 0, height: 0 }}
              className="mt-3 space-y-2"
            >
              {[
                { value: 'PRIVATE', label: 'Private', desc: 'Only you can see this lead' },
                { value: 'LIMITED', label: 'Limited', desc: 'Only matched vendors/consultants' },
                { value: 'PUBLIC', label: 'Public', desc: 'Visible to all SmartGrant users' }
              ].map((option) => (
                <motion.button
                  key={option.value}
                  onClick={() => {
                    onVisibilityChange(option.value as 'PRIVATE' | 'LIMITED' | 'PUBLIC');
                    setShowVisibilityOptions(false);
                  }}
                  className={`w-full text-left p-3 rounded-lg border transition-all ${
                    visibility === option.value
                      ? 'border-indigo-500 bg-indigo-50'
                      : 'border-slate-200 hover:border-slate-300'
                  }`}
                  whileHover={{ scale: 1.01 }}
                  whileTap={{ scale: 0.99 }}
                >
                  <div className="font-medium text-slate-900">{option.label}</div>
                  <div className="text-sm text-slate-600">{option.desc}</div>
                </motion.button>
              ))}
            </motion.div>
          )}
        </AnimatePresence>
      </div>

      {/* Warning Messages */}
      {!canDispatch && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          className="mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg"
        >
          <p className="text-sm text-amber-800">
            Select at least 1 vendor to proceed.
          </p>
        </motion.div>
      )}

      {vendorCount > 5 && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          className="mt-4 p-3 bg-orange-50 border border-orange-200 rounded-lg"
        >
          <p className="text-sm text-orange-800">
            SmartGrant suggests â‰¤ 5 vendors for optimal response rates.
          </p>
        </motion.div>
      )}

      {consultantCount > 3 && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          className="mt-4 p-3 bg-orange-50 border border-orange-200 rounded-lg"
        >
          <p className="text-sm text-orange-800">
            SmartGrant suggests â‰¤ 3 consultants for optimal response rates.
          </p>
        </motion.div>
      )}
    </motion.div>
  );
};
[DispatchSummary.tsx: end]

File: components/preview/VendorCard.tsx
[VendorCard.tsx: start]
import React from 'react';
import { motion } from 'framer-motion';
import { Check, Plus, Info, Zap, DollarSign, Clock, Tag } from 'lucide-react';
import { Vendor } from '../../state/preview/types';

interface VendorCardProps {
  vendor: Vendor;
  isRecommended: boolean;
  onToggle: (id: string) => void;
  onAdd?: (id: string) => void;
  onInfo?: (vendor: Vendor) => void;
}

const getMatchColor = (match: number) => {
  if (match >= 85) return 'from-green-500 to-emerald-500';
  if (match >= 70) return 'from-blue-500 to-indigo-500';
  return 'from-slate-400 to-slate-500';
};

const getMatchBadge = (match: number) => {
  if (match >= 85) return 'High AI Match';
  if (match >= 70) return 'Good Match';
  return 'Fair Match';
};

const getGrantBadge = (grantTag: string) => {
  switch (grantTag) {
    case 'PSG': return { text: 'PSG Pre-Approved', color: 'bg-blue-100 text-blue-700' };
    case 'EDG': return { text: 'EDG Eligible', color: 'bg-purple-100 text-purple-700' };
    default: return { text: 'Direct Purchase', color: 'bg-slate-100 text-slate-700' };
  }
};

export const VendorCard: React.FC<VendorCardProps> = ({
  vendor,
  isRecommended,
  onToggle,
  onAdd,
  onInfo
}) => {
  const grantBadge = getGrantBadge(vendor.grantTag);
  const matchColor = getMatchColor(vendor.match);
  const matchBadge = getMatchBadge(vendor.match);

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      whileHover={{ scale: 1.02 }}
      className={`relative rounded-xl border shadow-sm hover:shadow-md transition-all duration-200 ${
        vendor.selected ? 'ring-2 ring-indigo-500 bg-indigo-50/30' : 'bg-white'
      }`}
    >
      {/* Match % Gradient Bar */}
      <div className={`h-1 rounded-t-xl bg-gradient-to-r ${matchColor}`} />
      
      <div className="p-5">
        {/* Header */}
        <div className="flex items-start justify-between mb-3">
          <div className="flex items-center gap-3">
            <div className="w-12 h-12 bg-slate-100 rounded-lg flex items-center justify-center">
              <Zap size={20} className="text-slate-600" />
            </div>
            <div>
              <h3 className="font-semibold text-slate-900">{vendor.name}</h3>
              <div className="flex items-center gap-2 mt-1">
                <span className={`px-2 py-1 rounded-full text-xs font-medium ${grantBadge.color}`}>
                  {grantBadge.text}
                </span>
                <span className="text-xs text-slate-500">â€¢ {vendor.sector} Sector</span>
              </div>
            </div>
          </div>
          
          <div className="text-right">
            <div className="flex items-center gap-1 mb-1">
              <Zap size={14} className="text-indigo-600" />
              <span className="text-sm font-medium text-slate-900">{matchBadge}</span>
            </div>
            <span className="text-lg font-bold text-indigo-600">{vendor.match}%</span>
          </div>
        </div>

        {/* Product Info */}
        <div className="mb-3">
          <p className="text-sm text-slate-600 mb-2">{vendor.product}</p>
          <div className="flex items-center gap-4 text-sm text-slate-500">
            <div className="flex items-center gap-1">
              <DollarSign size={14} />
              <span>Est. Cost S$ {vendor.costRange[0].toLocaleString()}â€“{vendor.costRange[1].toLocaleString()}K</span>
            </div>
            <div className="flex items-center gap-1">
              <Clock size={14} />
              <span>{vendor.duration[0]}â€“{vendor.duration[1]} months</span>
            </div>
          </div>
        </div>

        {/* Match Reason */}
        <div className="mb-4 p-3 bg-slate-50 rounded-lg">
          <div className="flex items-start gap-2">
            <Tag size={14} className="text-slate-400 mt-0.5 flex-shrink-0" />
            <div>
              <p className="text-xs font-medium text-slate-600 mb-1">Matched because:</p>
              <p className="text-sm text-slate-700">"{vendor.reason}"</p>
            </div>
          </div>
        </div>

        {/* Tags */}
        <div className="flex flex-wrap gap-2 mb-4">
          {vendor.tags.map((tag, index) => (
            <span
              key={index}
              className="px-2 py-1 bg-slate-100 text-slate-600 text-xs rounded-full"
            >
              {tag}
            </span>
          ))}
        </div>

        {/* Actions */}
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-2">
            <motion.button
              onClick={() => onToggle(vendor.id)}
              className={`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all ${
                vendor.selected
                  ? 'bg-indigo-600 text-white'
                  : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
              }`}
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
            >
              <Check size={14} />
              {vendor.selected ? 'Selected' : 'Select'}
            </motion.button>

            {!isRecommended && onAdd && (
              <motion.button
                onClick={() => onAdd(vendor.id)}
                className="flex items-center gap-2 px-3 py-2 text-slate-600 hover:text-slate-800 transition-colors"
                whileHover={{ scale: 1.02 }}
                whileTap={{ scale: 0.98 }}
              >
                <Plus size={14} />
                Add
              </motion.button>
            )}
          </div>

          {onInfo && (
            <motion.button
              onClick={() => onInfo(vendor)}
              className="p-2 text-slate-400 hover:text-slate-600 transition-colors"
              whileHover={{ scale: 1.1 }}
              whileTap={{ scale: 0.9 }}
            >
              <Info size={16} />
            </motion.button>
          )}
        </div>
      </div>
    </motion.div>
  );
};
[VendorCard.tsx: end]

File: features/dashboard/consultant/ConsultantDashboard.tsx
[ConsultantDashboard.tsx: start]
import React, { useState } from 'react';
import { Users, Award, Wallet, ShoppingCart, PlusCircle } from 'lucide-react';
import { Card } from '../../../components/common/Card';
import { PageHeader } from '../../../components/common/PageHeader';
import { LeadScoreBadge } from '../../../components/common/LeadScoreBadge';
import { useAppStore } from '../../../state/store';

interface ConsultantDashboardProps {
  onViewLead: (leadId: string) => void;
}

export const ConsultantDashboard: React.FC<ConsultantDashboardProps> = ({ onViewLead }) => {
  const { leads, wallets } = useAppStore();
  const [showAddLeadModal, setShowAddLeadModal] = useState(false);
  
  const consultantLeads = leads.filter(lead => lead.audience === 'CONSULTANT');
  const availableLeads = consultantLeads.filter(lead => !lead.acceptedByUserId);
  const acceptedLeads = consultantLeads.filter(lead => lead.acceptedByUserId);
  
  const wallet = wallets.find(w => w.userId === 'user-consultant-1') || { balance: 0 };
  
  const mockClients = [ 
    { id: 1, name: "Innovate Pte. Ltd.", grant: "EDG", status: "Proposal Review", deadline: "3 days", appId: 2, probability: 75 }, 
    { id: 2, name: "Global Exports Co.", grant: "MRA Grant", status: "Awaiting Docs", deadline: "5 days", appId: 4, probability: 45 }, 
  ];

  const performance = { 
    winRate: 92, 
    avgTimeToSubmit: 14, 
    totalFundingSecured: 1250000 
  };

  return (
    <div className="space-y-6 md:space-y-8 animate-fade-in">
      <PageHeader title="Consultant Dashboard" />
      
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <Card>
          <div className="flex items-center justify-between">
            <h3 className="font-semibold text-slate-600 dark:text-slate-300">Active Clients</h3>
            <Users className="text-purple-500" />
          </div>
          <p className="text-4xl font-bold text-purple-600 dark:text-purple-400 mt-4">
            {mockClients.length}
          </p>
        </Card>
        
        <Card>
          <div className="flex items-center justify-between">
            <h3 className="font-semibold text-slate-600 dark:text-slate-300">Win Rate</h3>
            <Award className="text-teal-500" />
          </div>
          <p className="text-4xl font-bold text-teal-600 dark:text-teal-400 mt-4">
            {performance.winRate}%
          </p>
        </Card>
        
        <Card>
          <div className="flex items-center justify-between">
            <h3 className="font-semibold text-slate-600 dark:text-slate-300">Lead Credits</h3>
            <Wallet className="text-green-500" />
          </div>
          <p className="text-4xl font-bold text-green-600 dark:text-green-400 mt-4">
            {wallet.balance}
          </p>
        </Card>
        
        <Card 
          onClick={() => onViewLead('marketplace')} 
          className="bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-800/50 cursor-pointer"
        >
          <div className="flex items-center justify-between">
            <h3 className="font-bold text-blue-800 dark:text-blue-200">Lead Marketplace</h3>
            <ShoppingCart className="text-blue-500" />
          </div>
          <p className="text-4xl font-bold text-blue-600 dark:text-blue-400 mt-4">
            {availableLeads.length}
          </p>
          <p className="text-sm text-blue-500 dark:text-blue-400 hover:underline mt-1">
            New Leads Available â†’
          </p>
        </Card>
      </div>
      
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <Card>
          <div className="flex justify-between items-center mb-4">
            <h3 className="text-lg font-bold text-slate-800 dark:text-slate-200">Client Pipeline</h3>
            <button 
              onClick={() => setShowAddLeadModal(true)} 
              className="flex items-center gap-2 bg-indigo-600 text-white px-3 py-2 rounded-lg text-sm font-semibold hover:bg-indigo-700"
            >
              <PlusCircle size={16} /> Add Lead
            </button>
          </div>
          <div className="space-y-2">
            {mockClients.map(client => (
              <div 
                key={client.id} 
                onClick={() => onViewLead(client.appId.toString())} 
                className="p-4 rounded-lg border border-slate-200 dark:border-slate-700/80 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors cursor-pointer flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"
              >
                <div>
                  <p className="font-semibold text-slate-700 dark:text-slate-200">
                    {client.name} ({client.grant})
                  </p>
                  <div className="mt-1">
                    <LeadScoreBadge score={client.probability ?? 55} />
                  </div>
                </div>
                <div className="flex items-center gap-4">
                  <span className="text-sm font-medium text-red-500">
                    {client.deadline || 'N/A'}
                  </span>
                  <button className="font-semibold text-indigo-600 dark:text-indigo-400 hover:underline text-sm">
                    Manage
                  </button>
                </div>
              </div>
            ))}
          </div>
        </Card>
        
        <Card>
          <h3 className="text-lg font-bold text-slate-800 dark:text-slate-200 mb-4">My Performance</h3>
          <div className="space-y-3">
            <div className="flex justify-between items-center">
              <p className="text-slate-600 dark:text-slate-300">Avg. Time to Submit</p>
              <p className="font-bold text-slate-800 dark:text-slate-100">
                {performance.avgTimeToSubmit} days
              </p>
            </div>
            <div className="flex justify-between items-center">
              <p className="text-slate-600 dark:text-slate-300">Total Funding Secured</p>
              <p className="font-bold text-slate-800 dark:text-slate-100">
                ${performance.totalFundingSecured.toLocaleString()}
              </p>
            </div>
          </div>
        </Card>
      </div>
    </div>
  );
};
[ConsultantDashboard.tsx: end]

File: features/dashboard/sme/SmeDashboard.tsx
[SmeDashboard.tsx: start]
import React from 'react';
import { CheckCircle, Circle, BrainCircuit, ArrowRight } from 'lucide-react';
import { useNavigate } from 'react-router-dom';
import { Card } from '../../../components/common/Card';
import { MetricTiles } from '../../../components/common/MetricTiles';
import { Pipeline } from '../../../components/common/Pipeline';
import { Launchpad } from '../../../components/common/Launchpad';

interface SmeDashboardProps {
  onStartNewOpportunity: () => void;
}

const ReadinessStep: React.FC<{ text: string; status: 'complete' | 'in_progress' | 'incomplete' }> = ({ text, status }) => {
  const statusMap = {
    complete: { icon: <CheckCircle size={16} className="text-emerald-500" /> },
    in_progress: { icon: <Circle size={16} className="text-amber-500 fill-amber-500" /> },
    incomplete: { icon: <Circle size={16} className="text-slate-400 fill-slate-400" /> },
  };
  
  return (
    <div className="flex items-center gap-3 text-sm text-slate-600">
      {statusMap[status].icon} {text}
    </div>
  );
};

export const SmeDashboard: React.FC<SmeDashboardProps> = ({ onStartNewOpportunity }) => {
  const navigate = useNavigate();
  
  const handleStartNewOpportunity = () => {
    navigate('/sme/builder');
  };
  return (
    <div className="space-y-6 animate-fade-in">
      <section>
        <h2 className="text-lg font-semibold text-slate-900 mb-4">My Business Snapshot</h2>
        <MetricTiles />
      </section>
      
      <section>
        <h2 className="text-lg font-semibold text-slate-900 mb-4">Tailored to your company's DNA</h2>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          {[
            {name: "Enterprise Development Grant (EDG)", reason: "Your revenue band & industry qualify for 80% support."}, 
            {name: "Productivity Solutions Grant (PSG)", reason: "Pre-approved IT solutions match your sector."}, 
            {name: "Market Readiness Assistance (MRA)", reason: "Perfect for your planned overseas expansion."}
          ].map(opp => (
            <Card key={opp.name} className="bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200/50 hover:border-blue-300/50">
              <h3 className="font-semibold text-slate-900 text-sm">{opp.name}</h3>
              <p className="text-sm text-slate-600 mt-2 leading-relaxed">{opp.reason}</p>
              <button className="mt-4 text-sm font-medium text-blue-600 hover:text-blue-700 hover:underline flex items-center gap-1 transition-colors">
                Launch Opportunity <ArrowRight size={14}/>
              </button>
            </Card>
          ))}
        </div>
      </section>

      <section>
        <Launchpad onStartNewOpportunity={handleStartNewOpportunity} />
      </section>
      
      <div className="grid grid-cols-1 xl:grid-cols-3 gap-6 items-start">
        <main className="xl:col-span-2">
          <h2 className="text-lg font-semibold text-slate-900 mb-4">Opportunity Pipeline</h2>
          <Pipeline />
        </main>
        
        <aside className="xl:col-span-1 space-y-6">
          <Card>
            <h3 className="text-lg font-semibold text-slate-900 mb-4">Active Tasks</h3>
            <div className="space-y-3">
              <p className="text-sm text-slate-600">Vendor A awaiting reply <span className="font-medium text-red-600">(2 days left)</span></p>
              <p className="text-sm text-slate-600">Consultant proposal ready for review</p>
              <p className="text-sm text-slate-600">Grant checklist 60% complete</p>
            </div>
            <button className="mt-4 text-sm font-medium text-blue-600 hover:text-blue-700 hover:underline w-full text-left transition-colors">View All Tasks â†’</button>
          </Card>
          
          <Card>
            <h3 className="text-lg font-semibold text-slate-900 mb-4">Grant Readiness</h3>
            <div className="w-full bg-slate-200 rounded-full h-2 mb-4">
              <div className="bg-emerald-500 h-2 rounded-full transition-all duration-300" style={{width: "60%"}}></div>
            </div>
            <div className="space-y-2">
              <ReadinessStep text="Company Profile" status="complete"/>
              <ReadinessStep text="Quotations" status="complete"/>
              <ReadinessStep text="Implementation Plan" status="in_progress"/>
              <ReadinessStep text="Evidence" status="incomplete"/>
            </div>
            <button className="mt-4 bg-slate-100 w-full py-2 rounded-lg font-medium text-slate-700 hover:bg-slate-200 transition-colors">Open Checklist</button>
          </Card>
          
          <Card>
            <h3 className="text-lg font-semibold text-slate-900 mb-2">Credits & Plan</h3>
            <p className="text-slate-600"><span className="text-2xl font-bold text-slate-900">12</span> credits remaining</p>
            <p className="text-xs text-slate-500">Next renewal: Nov 30 2025</p>
            <button className="mt-4 bg-blue-50 w-full py-2 rounded-lg font-medium text-blue-700 hover:bg-blue-100 transition-colors">Buy More Credits</button>
          </Card>
        </aside>
      </div>
      
      <footer className="bg-slate-50 p-6 rounded-xl flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 border border-slate-200/60">
        <div className="flex items-start gap-3">
          <BrainCircuit className="w-6 h-6 text-indigo-600 flex-shrink-0 mt-1" />
          <p className="text-sm text-slate-600">
            <span className="font-semibold text-slate-900">SmartAI Insight:</span> Based on similar SMEs, projects between S$50Kâ€“100K saw 3Ã— faster approval.
          </p>
        </div>
        <button className="font-medium text-indigo-600 hover:text-indigo-700 hover:underline text-sm flex-shrink-0 transition-colors">View Insights</button>
      </footer>
    </div>
  );
};
[SmeDashboard.tsx: end]

File: features/dashboard/vendor/VendorDashboard.tsx
[VendorDashboard.tsx: start]
import React, { useState } from 'react';
import { Users, Award, Wallet, ShoppingCart, PlusCircle } from 'lucide-react';
import { Card } from '../../../components/common/Card';
import { PageHeader } from '../../../components/common/PageHeader';
import { StatusBadge } from '../../../components/common/StatusBadge';
import { useAppStore } from '../../../state/store';

interface VendorDashboardProps {
  onViewLead: (leadId: string) => void;
}

export const VendorDashboard: React.FC<VendorDashboardProps> = ({ onViewLead }) => {
  const { leads, wallets, currentPersona } = useAppStore();
  const [showAddLeadModal, setShowAddLeadModal] = useState(false);
  
  const vendorLeads = leads.filter(lead => lead.audience === 'VENDOR');
  const availableLeads = vendorLeads.filter(lead => !lead.acceptedByUserId);
  const acceptedLeads = vendorLeads.filter(lead => lead.acceptedByUserId);
  
  const wallet = wallets.find(w => w.userId === 'user-vendor-1') || { balance: 0 };
  
  const mockQuoteRequests = [
    { id: 1, sme: "Innovate Pte. Ltd.", grant: "EDG", service: "Digital Marketing Campaign", status: "Pending", amount: 15000, feedback: null },
    { id: 2, sme: "Tech Solutions Inc.", grant: "EDG", service: "Digital Marketing Campaign", status: "Submitted", amount: 14500, feedback: null },
    { id: 3, sme: "Creative Minds Agency", grant: "EDG", service: "Digital Marketing Campaign", status: "Accepted", amount: 15200, feedback: "Great value and clear deliverables." }
  ];

  const performance = { 
    engagementRate: 25, 
    avgQuoteTime: 2, 
    totalContractsValue: 250000 
  };

  return (
    <div className="space-y-6 md:space-y-8 animate-fade-in">
      <PageHeader title="Vendor Dashboard" />
      
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <Card>
          <div className="flex items-center justify-between">
            <h3 className="font-semibold text-slate-600 dark:text-slate-300">Quote Requests</h3>
            <Users className="text-green-500" />
          </div>
          <p className="text-4xl font-bold text-green-600 dark:text-green-400 mt-4">
            {mockQuoteRequests.length}
          </p>
        </Card>
        
        <Card>
          <div className="flex items-center justify-between">
            <h3 className="font-semibold text-slate-600 dark:text-slate-300">Engagement Rate</h3>
            <Award className="text-teal-500" />
          </div>
          <p className="text-4xl font-bold text-teal-600 dark:text-teal-400 mt-4">
            {performance.engagementRate}%
          </p>
        </Card>
        
        <Card>
          <div className="flex items-center justify-between">
            <h3 className="font-semibold text-slate-600 dark:text-slate-300">Lead Credits</h3>
            <Wallet className="text-green-500" />
          </div>
          <p className="text-4xl font-bold text-green-600 dark:text-green-400 mt-4">
            {wallet.balance}
          </p>
        </Card>
        
        <Card 
          onClick={() => onViewLead('marketplace')} 
          className="bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-800/50 cursor-pointer"
        >
          <div className="flex items-center justify-between">
            <h3 className="font-bold text-blue-800 dark:text-blue-200">Lead Marketplace</h3>
            <ShoppingCart className="text-blue-500" />
          </div>
          <p className="text-4xl font-bold text-blue-600 dark:text-blue-400 mt-4">
            {availableLeads.length}
          </p>
          <p className="text-sm text-blue-500 dark:text-blue-400 hover:underline mt-1">
            New Leads Available â†’
          </p>
        </Card>
      </div>
      
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <Card>
          <div className="flex justify-between items-center mb-4">
            <h3 className="text-lg font-bold text-slate-800 dark:text-slate-200">Quote Pipeline</h3>
            <button 
              onClick={() => setShowAddLeadModal(true)} 
              className="flex items-center gap-2 bg-indigo-600 text-white px-3 py-2 rounded-lg text-sm font-semibold hover:bg-indigo-700"
            >
              <PlusCircle size={16} /> Add Lead
            </button>
          </div>
          <div className="overflow-x-auto">
            <table className="w-full text-sm text-left">
              <thead className="text-xs text-slate-500 dark:text-slate-400 uppercase bg-slate-50 dark:bg-slate-700/50">
                <tr>
                  <th className="px-4 py-3 font-medium">SME</th>
                  <th className="px-4 py-3 font-medium">Service</th>
                  <th className="px-4 py-3 font-medium">Status</th>
                  <th className="px-4 py-3 font-medium">Feedback</th>
                  <th className="px-4 py-3 font-medium">Action</th>
                </tr>
              </thead>
              <tbody>
                {mockQuoteRequests.map(req => (
                  <tr key={req.id} className="border-b border-slate-200 dark:border-slate-700">
                    <td className="px-4 py-3 font-medium text-slate-800 dark:text-white">
                      {req.sme}
                    </td>
                    <td className="px-4 py-3 text-slate-600 dark:text-slate-300">
                      {req.service}
                    </td>
                    <td className="px-4 py-3">
                      <StatusBadge status={req.status} type="quote"/>
                    </td>
                    <td className="px-4 py-3 text-slate-500 dark:text-slate-400 italic">
                      {req.feedback || 'N/A'}
                    </td>
                    <td className="px-4 py-3">
                      <button 
                        onClick={() => onViewLead(req.id.toString())} 
                        className="font-semibold text-indigo-600 dark:text-indigo-400 hover:underline"
                      >
                        View
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </Card>
        
        <Card>
          <h3 className="text-lg font-bold text-slate-800 dark:text-slate-200 mb-4">My Performance</h3>
          <div className="space-y-3">
            <div className="flex justify-between items-center">
              <p className="text-slate-600 dark:text-slate-300">Avg. Quote Time</p>
              <p className="font-bold text-slate-800 dark:text-slate-100">
                {performance.avgQuoteTime} days
              </p>
            </div>
            <div className="flex justify-between items-center">
              <p className="text-slate-600 dark:text-slate-300">Total Contracts Value</p>
              <p className="font-bold text-slate-800 dark:text-slate-100">
                ${performance.totalContractsValue.toLocaleString()}
              </p>
            </div>
          </div>
        </Card>
      </div>
    </div>
  );
};
[VendorDashboard.tsx: end]

File: features/leads/ConsultantLeadInbox.tsx
[ConsultantLeadInbox.tsx: start]
import React, { useState } from 'react';
import { Wallet, Filter, ShoppingCart } from 'lucide-react';
import { Card } from '../../components/common/Card';
import { PageHeader } from '../../components/common/PageHeader';
import { LeadScoreBadge } from '../../components/common/LeadScoreBadge';
import { useAppStore } from '../../state/store';
import { mockApi } from '../../mocks/api';

export const ConsultantLeadInbox: React.FC = () => {
  const { leads, wallets } = useAppStore();
  const [unlockingId, setUnlockingId] = useState<string | null>(null);
  
  const consultantLeads = leads.filter(lead => lead.audience === 'CONSULTANT');
  const availableLeads = consultantLeads.filter(lead => !lead.acceptedByUserId);
  const acceptedLeads = consultantLeads.filter(lead => lead.acceptedByUserId);
  
  const wallet = wallets.find(w => w.userId === 'user-consultant-1') || { balance: 0 };

  const unlockContact = async (leadId: string) => {
    setUnlockingId(leadId);
    try {
      await mockApi.acceptLead(leadId, 'user-consultant-1');
    } catch (error) {
      console.error('Failed to accept lead:', error);
    } finally {
      setUnlockingId(null);
    }
  };

  return (
    <div className="animate-fade-in">
      <PageHeader 
        title="Lead Marketplace" 
        subtitle="Purchase qualified leads to grow your business."
      >
        <div className="mt-4 md:mt-0 flex items-center gap-4 p-3 rounded-lg bg-green-100 dark:bg-green-500/20">
          <Wallet className="text-green-700 dark:text-green-300" />
          <span className="font-bold text-green-800 dark:text-green-200">
            {wallet.balance} Credits Available
          </span>
          <button className="bg-green-600 text-white px-3 py-1 text-sm rounded-md hover:bg-green-700">
            +
          </button>
        </div>
      </PageHeader>
      
      <div className="mb-6 p-4 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 flex flex-wrap items-center gap-4">
        <h3 className="font-semibold text-slate-700 dark:text-slate-200 flex items-center gap-2">
          <Filter size={18}/> Filters:
        </h3>
        <select className="bg-slate-100 dark:bg-slate-700 p-2 rounded-md text-sm border border-slate-200 dark:border-slate-600">
          <option>Sector: All</option>
          <option>F&B</option>
          <option>Logistics</option>
        </select>
        <select className="bg-slate-100 dark:bg-slate-700 p-2 rounded-md text-sm border border-slate-200 dark:border-slate-600">
          <option>Type: All</option>
          <option>Grant</option>
          <option>Non-grant</option>
        </select>
        <select className="bg-slate-100 dark:bg-slate-700 p-2 rounded-md text-sm border border-slate-200 dark:border-slate-600">
          <option>Budget: All</option>
          <option>$10k-20k</option>
          <option>$20k+</option>
        </select>
      </div>
      
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {availableLeads.length > 0 ? availableLeads.map(lead => (
          <Card key={lead.id} className="flex flex-col">
            <div className="flex-grow">
              <div className="flex justify-between items-center">
                <h3 className="text-lg font-bold text-slate-800 dark:text-slate-100">
                  F&B Company Opportunity
                </h3>
                <LeadScoreBadge score={lead.qualificationScore} />
              </div>
              <p className="text-sm text-slate-500 dark:text-slate-400 mt-1">
                Interest: {lead.maskedPreview.grantTag || 'General'}
              </p>
              <p className="mt-3 text-slate-600 dark:text-slate-300">
                {lead.maskedPreview.summary}
              </p>
              <div className="mt-3 text-sm text-slate-500 dark:text-slate-400">
                <p>Budget: S${lead.maskedPreview.budgetBand[0].toLocaleString()} - S${lead.maskedPreview.budgetBand[1].toLocaleString()}</p>
                <p>Urgency: {lead.maskedPreview.urgency}</p>
              </div>
            </div>
            <button
              disabled={unlockingId === lead.id || wallet.balance < lead.priceCredits}
              onClick={() => unlockContact(lead.id)}
              className={`w-full mt-4 px-4 py-2 rounded-lg font-semibold transition-colors flex items-center justify-center gap-2
                ${unlockingId === lead.id 
                  ? 'bg-slate-300 dark:bg-slate-700 text-slate-500 cursor-wait' 
                  : wallet.balance < lead.priceCredits
                  ? 'bg-red-300 dark:bg-red-700 text-red-500 cursor-not-allowed'
                  : 'bg-indigo-600 text-white hover:bg-indigo-700'
                }`}
            >
              <ShoppingCart size={18} />
              {unlockingId === lead.id 
                ? 'Processingâ€¦' 
                : wallet.balance < lead.priceCredits
                ? 'Insufficient Credits'
                : `Accept Lead (${lead.priceCredits} credit${lead.priceCredits > 1 ? 's' : ''})`
              }
            </button>
          </Card>
        )) : (
          <Card className="md:col-span-2 lg:col-span-3 text-center">
            <h3 className="text-lg font-bold text-slate-700 dark:text-slate-200">No Leads Available</h3>
            <p className="text-slate-500 dark:text-slate-400 mt-1">Please check back later for new opportunities.</p>
          </Card>
        )}
      </div>
    </div>
  );
};
[ConsultantLeadInbox.tsx: end]

File: features/leads/VendorLeadInbox.tsx
[VendorLeadInbox.tsx: start]
import React, { useState } from 'react';
import { Wallet, Filter, ShoppingCart } from 'lucide-react';
import { Card } from '../../components/common/Card';
import { PageHeader } from '../../components/common/PageHeader';
import { LeadScoreBadge } from '../../components/common/LeadScoreBadge';
import { useAppStore } from '../../state/store';
import { mockApi } from '../../mocks/api';

export const VendorLeadInbox: React.FC = () => {
  const { leads, wallets, currentPersona } = useAppStore();
  const [unlockingId, setUnlockingId] = useState<string | null>(null);
  
  const vendorLeads = leads.filter(lead => lead.audience === 'VENDOR');
  const availableLeads = vendorLeads.filter(lead => !lead.acceptedByUserId);
  const acceptedLeads = vendorLeads.filter(lead => lead.acceptedByUserId);
  
  const wallet = wallets.find(w => w.userId === 'user-vendor-1') || { balance: 0 };

  const unlockContact = async (leadId: string) => {
    setUnlockingId(leadId);
    try {
      await mockApi.acceptLead(leadId, 'user-vendor-1');
    } catch (error) {
      console.error('Failed to accept lead:', error);
    } finally {
      setUnlockingId(null);
    }
  };

  return (
    <div className="animate-fade-in">
      <PageHeader 
        title="Lead Marketplace" 
        subtitle="Purchase qualified leads to grow your business."
      >
        <div className="mt-4 md:mt-0 flex items-center gap-4 p-3 rounded-lg bg-green-100 dark:bg-green-500/20">
          <Wallet className="text-green-700 dark:text-green-300" />
          <span className="font-bold text-green-800 dark:text-green-200">
            {wallet.balance} Credits Available
          </span>
          <button className="bg-green-600 text-white px-3 py-1 text-sm rounded-md hover:bg-green-700">
            +
          </button>
        </div>
      </PageHeader>
      
      <div className="mb-6 p-4 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 flex flex-wrap items-center gap-4">
        <h3 className="font-semibold text-slate-700 dark:text-slate-200 flex items-center gap-2">
          <Filter size={18}/> Filters:
        </h3>
        <select className="bg-slate-100 dark:bg-slate-700 p-2 rounded-md text-sm border border-slate-200 dark:border-slate-600">
          <option>Sector: All</option>
          <option>F&B</option>
          <option>Logistics</option>
        </select>
        <select className="bg-slate-100 dark:bg-slate-700 p-2 rounded-md text-sm border border-slate-200 dark:border-slate-600">
          <option>Type: All</option>
          <option>Grant</option>
          <option>Non-grant</option>
        </select>
        <select className="bg-slate-100 dark:bg-slate-700 p-2 rounded-md text-sm border border-slate-200 dark:border-slate-600">
          <option>Budget: All</option>
          <option>$10k-20k</option>
          <option>$20k+</option>
        </select>
      </div>
      
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {availableLeads.length > 0 ? availableLeads.map(lead => (
          <Card key={lead.id} className="flex flex-col">
            <div className="flex-grow">
              <div className="flex justify-between items-center">
                <h3 className="text-lg font-bold text-slate-800 dark:text-slate-100">
                  F&B Company Opportunity
                </h3>
                <LeadScoreBadge score={lead.qualificationScore} />
              </div>
              <p className="text-sm text-slate-500 dark:text-slate-400 mt-1">
                Interest: {lead.maskedPreview.grantTag || 'General'}
              </p>
              <p className="mt-3 text-slate-600 dark:text-slate-300">
                {lead.maskedPreview.summary}
              </p>
              <div className="mt-3 text-sm text-slate-500 dark:text-slate-400">
                <p>Budget: S${lead.maskedPreview.budgetBand[0].toLocaleString()} - S${lead.maskedPreview.budgetBand[1].toLocaleString()}</p>
                <p>Urgency: {lead.maskedPreview.urgency}</p>
              </div>
            </div>
            <button
              disabled={unlockingId === lead.id || wallet.balance < lead.priceCredits}
              onClick={() => unlockContact(lead.id)}
              className={`w-full mt-4 px-4 py-2 rounded-lg font-semibold transition-colors flex items-center justify-center gap-2
                ${unlockingId === lead.id 
                  ? 'bg-slate-300 dark:bg-slate-700 text-slate-500 cursor-wait' 
                  : wallet.balance < lead.priceCredits
                  ? 'bg-red-300 dark:bg-red-700 text-red-500 cursor-not-allowed'
                  : 'bg-indigo-600 text-white hover:bg-indigo-700'
                }`}
            >
              <ShoppingCart size={18} />
              {unlockingId === lead.id 
                ? 'Processingâ€¦' 
                : wallet.balance < lead.priceCredits
                ? 'Insufficient Credits'
                : `Accept Lead (${lead.priceCredits} credit${lead.priceCredits > 1 ? 's' : ''})`
              }
            </button>
          </Card>
        )) : (
          <Card className="md:col-span-2 lg:col-span-3 text-center">
            <h3 className="text-lg font-bold text-slate-700 dark:text-slate-200">No Leads Available</h3>
            <p className="text-slate-500 dark:text-slate-400 mt-1">Please check back later for new opportunities.</p>
          </Card>
        )}
      </div>
    </div>
  );
};
[VendorLeadInbox.tsx: end]

File: features/opportunityBuilder/comparison/ComparisonView.tsx
[ComparisonView.tsx: start]
import React, { useState } from 'react';
import { ArrowLeft, Check, Star, Award } from 'lucide-react';
import { Card } from '../../../components/common/Card';
import { PageHeader } from '../../../components/common/PageHeader';
import { useAppStore } from '../../../state/store';
import { mockApi } from '../../../mocks/api';

interface ComparisonViewProps {
  reqDocId: string;
  onBack: () => void;
}

const ProposalCard: React.FC<{
  proposal: any;
  isSelected: boolean;
  onSelect: () => void;
  onAward: () => void;
}> = ({ proposal, isSelected, onSelect, onAward }) => (
  <Card className={`cursor-pointer transition-all ${isSelected ? 'border-indigo-500 bg-indigo-50 dark:bg-indigo-900/30' : 'hover:border-slate-300 dark:hover:border-slate-600'}`}>
    <div className="flex items-start justify-between mb-4">
      <div className="flex-1">
        <h3 className="text-lg font-semibold text-slate-800 dark:text-slate-200">{proposal.name}</h3>
        <p className="text-sm text-slate-600 dark:text-slate-400 mt-1">{proposal.type}</p>
      </div>
      <div className="flex items-center gap-2">
        {proposal.isTopMatch && (
          <span className="px-2 py-1 text-xs font-bold bg-green-100 text-green-700 dark:bg-green-500/20 dark:text-green-300 rounded-full">
            Top Match
          </span>
        )}
        {isSelected && (
          <div className="bg-indigo-600 text-white rounded-full p-1">
            <Check size={16} />
          </div>
        )}
      </div>
    </div>
    
    <div className="space-y-3">
      <div>
        <h4 className="text-sm font-medium text-slate-700 dark:text-slate-300">Scope Summary</h4>
        <p className="text-sm text-slate-600 dark:text-slate-400 mt-1">{proposal.summary}</p>
      </div>
      
      <div className="grid grid-cols-2 gap-4 text-sm">
        <div>
          <span className="text-slate-500 dark:text-slate-400">Timeline:</span>
          <p className="font-semibold text-slate-800 dark:text-slate-200">{proposal.timeline}</p>
        </div>
        <div>
          <span className="text-slate-500 dark:text-slate-400">Price:</span>
          <p className="font-semibold text-slate-800 dark:text-slate-200">{proposal.price}</p>
        </div>
      </div>
      
      <div>
        <h4 className="text-sm font-medium text-slate-700 dark:text-slate-300">Key Features</h4>
        <ul className="text-sm text-slate-600 dark:text-slate-400 mt-1 space-y-1">
          {proposal.features.map((feature: string, index: number) => (
            <li key={index} className="flex items-center gap-2">
              <Check size={12} className="text-green-500 flex-shrink-0" />
              {feature}
            </li>
          ))}
        </ul>
      </div>
      
      <div className="flex gap-2 pt-4 border-t border-slate-200 dark:border-slate-700">
        <button
          onClick={onSelect}
          className={`flex-1 px-3 py-2 text-sm font-semibold rounded-lg transition-colors ${
            isSelected
              ? 'bg-indigo-100 text-indigo-700 dark:bg-indigo-500/20 dark:text-indigo-300'
              : 'bg-slate-100 text-slate-700 dark:bg-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600'
          }`}
        >
          {isSelected ? 'Selected' : 'Select'}
        </button>
        <button
          onClick={onAward}
          className="flex-1 px-3 py-2 text-sm font-semibold bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-1"
        >
          <Award size={14} />
          Award
        </button>
      </div>
    </div>
  </Card>
);

export const ComparisonView: React.FC<ComparisonViewProps> = ({ reqDocId, onBack }) => {
  const { reqDocs, currentPersona } = useAppStore();
  const [selectedProposals, setSelectedProposals] = useState<string[]>([]);
  
  const reqDoc = reqDocs.find(rd => rd.id === reqDocId);
  
  // Mock data for comparison
  const mockProposals = [
    {
      id: 'prop-1',
      name: 'Acme ERP Solutions',
      type: 'Vendor Submission',
      summary: `Imagine having every part of your F&B businessâ€”inventory, finance, reporting and moreâ€”connected in one place. This cloud ERP solution isnâ€™t just about software, itâ€™s about simplifying and elevating your day-to-day so you can focus on growth. We guide you every step, ensuring PSG grant optimization and a successful roll-out, with a dedicated support team that understands the F&B sector inside out.`,
      timeline: '3-4 months',
      price: 'S$22,000 - S$25,000',
      features: ['PSG Pre-approved', 'F&B Industry Experience', '24/7 Support', 'Training Included'],
      isTopMatch: true
    },
    {
      id: 'prop-2',
      name: 'Nova Cloud Systems',
      type: 'Vendor Submission',
      summary: 'Modern cloud-native ERP with advanced analytics and mobile access.',
      timeline: '2-3 months',
      price: 'S$18,000 - S$22,000',
      features: ['Cloud-Native', 'Advanced Analytics', 'Mobile App', 'API Integration'],
      isTopMatch: false
    },
    {
      id: 'prop-3',
      name: 'Carter Advisory Group',
      type: 'Consultant Submission',
      summary: `Our team provides hands-on support through your grant journeyâ€”clarifying requirements, preparing documentation, liaising with vendors, and ensuring nothing falls through the cracks. Weâ€™re here to give you confidence, insight and clarity on your F&B digitalization initiatives, from eligibility to claimâ€”so you always know whatâ€™s next and how to maximise grant outcomes for your business.`,
      timeline: '4-6 months',
      price: 'S$8,000 - S$12,000',
      features: ['Grant Application', 'Vendor Management', 'Compliance Support', '92% Success Rate'],
      isTopMatch: true
    }
  ];

  const toggleProposal = (proposalId: string) => {
    setSelectedProposals(prev => 
      prev.includes(proposalId) 
        ? prev.filter(id => id !== proposalId)
        : [...prev, proposalId]
    );
  };

  const handleAward = async (proposalId: string) => {
    const proposal = mockProposals.find(p => p.id === proposalId);
    if (proposal) {
      if (proposal.type === 'Vendor Proposal') {
        await mockApi.awardVendor(reqDocId, 'user-vendor-1');
      } else {
        await mockApi.awardConsultant(reqDocId, 'user-consultant-1');
      }
    }
  };

  if (!reqDoc) {
    return (
      <div className="max-w-6xl mx-auto animate-fade-in">
        <Card className="text-center py-12">
          <h2 className="text-xl font-bold text-slate-800 dark:text-slate-200 mb-2">Opportunity Not Found</h2>
          <p className="text-slate-600 dark:text-slate-400 mb-4">The requested opportunity could not be found.</p>
          <button
            onClick={onBack}
            className="bg-indigo-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-indigo-700"
          >
            Back to Dashboard
          </button>
        </Card>
      </div>
    );
  }

  return (
    <div className="max-w-6xl mx-auto animate-fade-in">
      <button 
        onClick={onBack} 
        className="flex items-center gap-2 mb-6 text-sm font-semibold text-indigo-600 dark:text-indigo-400 hover:underline"
      >
        <ArrowLeft size={16} />Back to Dashboard
      </button>
      
      <PageHeader 
        title="Compare Proposals" 
        subtitle={`Review and compare proposals for: ${reqDoc.goal}`}
      />

      <div className="mb-6 p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg border border-blue-200 dark:border-blue-800">
        <div className="flex items-center gap-2">
          <Star className="text-blue-600 dark:text-blue-400" size={20} />
          <p className="text-sm text-blue-700 dark:text-blue-300">
            <span className="font-semibold">Tip:</span> Compare proposals side-by-side and select the best match for your project. 
            You can select multiple proposals for detailed comparison.
          </p>
        </div>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
        {mockProposals.map(proposal => (
          <ProposalCard
            key={proposal.id}
            proposal={proposal}
            isSelected={selectedProposals.includes(proposal.id)}
            onSelect={() => toggleProposal(proposal.id)}
            onAward={() => handleAward(proposal.id)}
          />
        ))}
      </div>

      {selectedProposals.length > 0 && (
        <Card className="mt-8 bg-green-50 dark:bg-green-900/30 border-green-200 dark:border-green-800">
          <h3 className="font-semibold text-green-800 dark:text-green-200 mb-2">
            Selected for Comparison ({selectedProposals.length})
          </h3>
          <p className="text-sm text-green-700 dark:text-green-300">
            You have selected {selectedProposals.length} proposal(s) for detailed comparison. 
            Use the "Award" button on individual proposals to make your final decision.
          </p>
        </Card>
      )}
    </div>
  );
};
[ComparisonView.tsx: end]

File: features/opportunityBuilder/sme/CompareDrawer.tsx
[CompareDrawer.tsx: start]
import React from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { X, CheckCircle, TrendingUp, Users, DollarSign, Clock, ArrowRight } from 'lucide-react';
import { TRHLSOption } from '../../../state/types';
import { formatImpact, getGrantBadgeColor, getImpactColor } from '../../../state/trhls/impact';
import { LeadResponse } from '../../../state/matching/types';

interface CompareDrawerProps {
  isOpen: boolean;
  onClose: () => void;
  selected: TRHLSOption[];
  onProceed: () => void;
}

const ImpactMetric: React.FC<{ 
  label: string; 
  value: string; 
  icon: React.ElementType;
  color: string;
  index: number;
}> = ({ label, value, icon: Icon, color, index }) => (
  <motion.div
    initial={{ opacity: 0, y: 10 }}
    animate={{ opacity: 1, y: 0 }}
    transition={{ delay: index * 0.1 }}
    className="bg-white rounded-lg p-3 border border-slate-200"
  >
    <div className="flex items-center gap-2 mb-1">
      <Icon size={14} className={color} />
      <span className="text-xs font-medium text-slate-600">{label}</span>
    </div>
    <div className={`text-lg font-bold ${color}`}>{value}</div>
  </motion.div>
);

const SolutionCard: React.FC<{ 
  solution: TRHLSOption; 
  index: number;
}> = ({ solution, index }) => {
  const impactMetrics = formatImpact(solution);
  const grantBadgeColor = getGrantBadgeColor(solution.grantTag);
  
  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ delay: index * 0.1 }}
      className="bg-white rounded-xl border border-slate-200 p-6 shadow-sm"
    >
      {/* Header */}
      <div className="mb-4">
        <div className="flex items-start justify-between mb-2">
          <h3 className="font-semibold text-slate-900 text-sm leading-tight">{solution.name}</h3>
          <span className={`px-2 py-1 rounded-full text-xs font-medium border ${grantBadgeColor}`}>
            {solution.grantTag === 'NON_GRANT' ? 'Self-Funded' : solution.grantTag}
          </span>
        </div>
        <p className="text-xs text-slate-600 mb-3">{solution.whyFit}</p>
      </div>

      {/* Why Recommended */}
      <div className="mb-4">
        <h4 className="text-xs font-medium text-slate-700 mb-2">Why you're seeing this:</h4>
        <div className="flex flex-wrap gap-1">
          {solution.rationaleSignals?.map((signal: string, idx: number) => (
            <motion.span
              key={idx}
              initial={{ opacity: 0, scale: 0.8 }}
              animate={{ opacity: 1, scale: 1 }}
              transition={{ delay: 0.2 + idx * 0.05 }}
              className="px-2 py-1 bg-slate-100 text-slate-600 text-xs rounded-full"
            >
              {signal}
            </motion.span>
          )) || []}
        </div>
      </div>

      {/* Business Impact */}
      <div className="mb-4">
        <h4 className="text-xs font-medium text-slate-700 mb-3">Business Impact:</h4>
        <div className="grid grid-cols-2 gap-2">
          {impactMetrics.map((metric, idx) => {
            const iconMap = {
              'Revenue Lift': TrendingUp,
              'New Leads / mo': Users,
              'CAC Change': DollarSign,
              'Time to First Lead': Clock
            };
            const Icon = iconMap[metric.label as keyof typeof iconMap] || TrendingUp;
            const color = getImpactColor(
              parseFloat(metric.value.replace('%', '').replace(' wks', '')),
              metric.label.includes('CAC') ? 'cac' : 
              metric.label.includes('Time') ? 'time' :
              metric.label.includes('Revenue') ? 'revenue' : 'leads'
            );
            
            return (
              <ImpactMetric
                key={metric.label}
                label={metric.label}
                value={metric.value}
                icon={Icon}
                color={color}
                index={idx}
              />
            );
          })}
        </div>
      </div>

      {/* Grant Support */}
      {solution.grantTag !== 'NON_GRANT' && (
        <div className="bg-blue-50 rounded-lg p-3 border border-blue-200">
          <h4 className="text-xs font-medium text-blue-800 mb-1">Grant Support:</h4>
          <p className="text-xs text-blue-700">{solution.grantWhy}</p>
        </div>
      )}

      {/* Cost & Duration */}
      <div className="mt-4 pt-3 border-t border-slate-200">
        <div className="flex justify-between text-xs text-slate-600">
          <span>Cost: S${solution.estCostBand[0].toLocaleString()} - S${solution.estCostBand[1].toLocaleString()}</span>
          <span>Duration: {solution.estDurationMonths[0]}-{solution.estDurationMonths[1]} months</span>
        </div>
      </div>
    </motion.div>
  );
};

export const CompareDrawer: React.FC<CompareDrawerProps> = ({ 
  isOpen, 
  onClose, 
  selected, 
  onProceed 
}) => {
  const getGridCols = () => {
    if (selected.length === 1) return 'grid-cols-1';
    if (selected.length === 2) return 'grid-cols-1 md:grid-cols-2';
    return 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3';
  };

  return (
    <AnimatePresence>
      {isOpen && (
        <>
          {/* Backdrop */}
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="fixed inset-0 bg-black/50 z-40"
            onClick={onClose}
          />
          
          {/* Drawer */}
          <motion.div
            initial={{ opacity: 0, y: '100%' }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: '100%' }}
            transition={{ duration: 0.4, ease: "easeOut" }}
            className="fixed bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-2xl z-50 max-h-[90vh] overflow-hidden"
          >
            {/* Header */}
            <div className="sticky top-0 bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-slate-200 px-6 py-4">
              <div className="flex items-center justify-between">
                <div>
                  <h2 className="text-lg font-semibold text-slate-900">Compare Solutions</h2>
                  <p className="text-sm text-slate-600">
                    {selected.length} solution{selected.length > 1 ? 's' : ''} selected
                  </p>
                </div>
                <button
                  onClick={onClose}
                  className="p-2 text-slate-400 hover:text-slate-600 transition-colors"
                >
                  <X size={20} />
                </button>
              </div>
            </div>

            {/* Content */}
            <div className="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
              <div className={`grid ${getGridCols()} gap-6`}>
                {selected.map((solution, index) => (
                  <SolutionCard
                    key={solution.id}
                    solution={solution}
                    index={index}
                  />
                ))}
              </div>
            </div>

            {/* Footer */}
            <div className="sticky bottom-0 bg-white border-t border-slate-200 px-6 py-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-2 text-sm text-slate-600">
                  <CheckCircle size={16} className="text-emerald-600" />
                  <span>Ready to proceed with selected solutions</span>
                </div>
                <motion.button
                  onClick={onProceed}
                  className="bg-blue-600 text-white font-medium px-6 py-3 rounded-lg hover:bg-blue-700 transition-all duration-200 flex items-center gap-2 shadow-md hover:shadow-lg"
                  whileHover={{ scale: 1.02 }}
                  whileTap={{ scale: 0.98 }}
                >
                  Use these for my ReqDoc
                  <ArrowRight size={16} />
                </motion.button>
              </div>
            </div>
          </motion.div>
        </>
      )}
    </AnimatePresence>
  );
};

interface Step6CompareDrawerProps {
  isOpen: boolean;
  onClose: () => void;
  selected: LeadResponse[];
  onProceed: () => void;
}

export const Step6CompareDrawer: React.FC<Step6CompareDrawerProps> = ({ isOpen, onClose, selected, onProceed }) => {
  // Identify types
  const isVendor = selected.every(s => s.type === 'VENDOR');
  const isConsultant = selected.every(s => s.type === 'CONSULTANT');
  const isMixed = !isVendor && !isConsultant;
  const [roleTab, setRoleTab] = React.useState<'VENDOR' | 'CONSULTANT'>(isVendor ? 'VENDOR' : 'CONSULTANT');

  // Content helper: render row for each attribute/field
  // ... content functions (omitted for brevity; see original spec for field breakdown by type) ...

  // Placeholder/empty column helpers
  // ... placeholderCol ...

  // Top row with badges, etc.
  // ... badgeRow ...

  // CTA: Ready for clarification
  // ... buttonRow ...

  return (
    <AnimatePresence>
      {isOpen && (
        <motion.div
          initial={{ opacity: 0, y: '100%' }}
          animate={{ opacity: 1, y: 0 }}
          exit={{ opacity: 0, y: '100%' }}
          transition={{ duration: 0.15, ease: "easeOut" }}
          className="fixed bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-2xl z-50 max-h-[92vh] overflow-hidden animate-fadeUp"
        >
          {/* Header */}
          <div className="sticky top-0 bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-slate-200 px-6 py-4 flex justify-between items-center">
            <div>
              <h2 className="text-lg font-semibold text-slate-900">Compare: {selected.length} selected</h2>
              {isMixed && (
                <div className="mt-2 flex gap-2">
                  <button className={`chip ${roleTab === 'VENDOR' ? 'chip-active' : ''}`} onClick={() => setRoleTab('VENDOR')}>Vendor</button>
                  <button className={`chip ${roleTab === 'CONSULTANT' ? 'chip-active' : ''}`} onClick={() => setRoleTab('CONSULTANT')}>Consultant</button>
                </div>
              )}
            </div>
            <button onClick={onClose} className="p-2 text-slate-400 hover:text-slate-600 transition-colors">
              <X size={20} />
            </button>
          </div>
          {/* Content: Grid/Rows */}
          <div className="p-6 overflow-y-auto">
            {/* Table with rows for attributes: role-specific or mixed/placeholder */}
            {/* ... implement row rendering for each content group based on role spec ... */}
          </div>
          {/* Footer CTA */}
          <div className="sticky bottom-0 bg-white border-t border-slate-200 px-6 py-4 flex justify-end">
            <button
              onClick={onProceed}
              className="bg-green-600 text-white font-medium px-6 py-3 rounded-lg hover:bg-green-700 transition-all duration-150 flex items-center gap-2 shadow-md hover:shadow-lg"
            >
              Ready for clarification
            </button>
          </div>
        </motion.div>
      )}
    </AnimatePresence>
  );
};
[CompareDrawer.tsx: end]

File: features/opportunityBuilder/sme/Step1_GoalCapture.tsx
[Step1_GoalCapture.tsx: start]
import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { ArrowLeft, ArrowRight, Target, TrendingUp, Globe, Zap, Sparkles, Megaphone, Activity } from 'lucide-react';
import { Card } from '../../../components/common/Card';
import { PageHeader } from '../../../components/common/PageHeader';
import { ChatWindow } from '../../../components/coach/ChatWindow';
import { Alert } from '../../../components/common/Alert';
import { useAppStore } from '../../../state/store';
import { mockApi } from '../../../mocks/api';
import { COACH_CONFIG } from '../../../state/coach/coachConfig';
import { coachActions, initialCoachState, type CoachState } from '../../../state/coach/coachMachine';

interface Step1_GoalCaptureProps {
  onNext: () => void;
  onBack: () => void;
}

// Helper function to detect domain from input
const detectDomain = (input: string): "GROWTH" | "OPERATIONS" | "CAPABILITY" | "SUPPLY" | null => {
  const lowerInput = input.toLowerCase();
  for (const mapping of COACH_CONFIG.keywordMap) {
    if (mapping.keys.some(keyword => lowerInput.includes(keyword))) {
      return mapping.domain as any;
    }
  }
  return null;
};

// Helper function to get clarifier label
const getClarifierLabel = (domain: string, clarifierId: string): string => {
  const clarifiers = COACH_CONFIG.clarifiers[domain as keyof typeof COACH_CONFIG.clarifiers];
  return clarifiers?.find(c => c.id === clarifierId)?.label || clarifierId;
};

const ProgressBar: React.FC<{ currentStep: number; totalSteps: number }> = ({ currentStep, totalSteps }) => (
  <div className="mb-8">
    <div className="flex items-center justify-between mb-2">
      <span className="text-sm font-medium text-slate-600">Step {currentStep} of {totalSteps}</span>
      <span className="text-sm text-slate-500">
        {currentStep === 1 && 'Describe Your Goal'}
        {currentStep === 2 && 'Add Context & Constraints'}
        {currentStep === 3 && 'Grant Relevance & Confidence'}
      </span>
    </div>
    <div className="w-full bg-slate-200 rounded-full h-2">
      <div 
        className="progress-bar h-2 rounded-full transition-all duration-500 ease-out"
        style={{ width: `${(currentStep / totalSteps) * 100}%` }}
      />
    </div>
  </div>
);

const CategoryChip: React.FC<{ 
  label: string; 
  icon: React.ElementType; 
  color: string;
  index: number;
}> = ({ label, icon: Icon, color, index }) => {
  const colorClasses = {
    blue: 'bg-blue-100 text-blue-700 border-blue-200 hover:bg-blue-200',
    green: 'bg-green-100 text-green-700 border-green-200 hover:bg-green-200',
    purple: 'bg-purple-100 text-purple-700 border-purple-200 hover:bg-purple-200'
  };
  
  return (
    <motion.div
      initial={{ opacity: 0, scale: 0.8, y: 10 }}
      animate={{ opacity: 1, scale: 1, y: 0 }}
      transition={{ 
        duration: 0.3, 
        delay: index * 0.1,
        ease: "easeOut"
      }}
      whileHover={{ 
        scale: 1.05, 
        boxShadow: "0 4px 12px rgba(0,0,0,0.1)",
        y: -2
      }}
      className={`flex items-center gap-2 px-3 py-1.5 rounded-full border text-sm font-medium transition-all duration-200 cursor-pointer ${colorClasses[color as keyof typeof colorClasses]}`}
    >
      <Icon size={14} />
      {label}
    </motion.div>
  );
};

const ClarityMeter: React.FC<{ score: number }> = ({ score }) => {
  const [displayScore, setDisplayScore] = useState(0);

  useEffect(() => {
    const timer = setTimeout(() => {
      setDisplayScore(score);
    }, 300);
    return () => clearTimeout(timer);
  }, [score]);

  const getScoreMessage = () => {
    if (score < 50) return 'Low clarity â€” let\'s refine this together';
    if (score < 80) return 'Good clarity â€” almost there';
    return 'Excellent clarity â€” ready for matching';
  };

  return (
    <motion.div 
      className="space-y-2"
      initial={{ opacity: 0, y: 10 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.4, ease: "easeOut" }}
    >
      <div className="flex justify-between items-center">
        <span className="text-sm font-medium text-slate-700">Clarity Score</span>
        <motion.span 
          className="text-sm font-semibold text-blue-600"
          initial={{ scale: 0.8 }}
          animate={{ scale: 1 }}
          transition={{ duration: 0.3, delay: 0.2 }}
        >
          {displayScore}/100
        </motion.span>
      </div>
      <div className="w-full bg-slate-200 rounded-full h-2 overflow-hidden">
        <motion.div 
          className="bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full"
          initial={{ width: 0 }}
          animate={{ width: `${displayScore}%` }}
          transition={{ duration: 0.8, ease: "easeOut", delay: 0.1 }}
        />
      </div>
      <motion.p 
        className="text-xs text-slate-500"
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        transition={{ delay: 0.5 }}
      >
        {getScoreMessage()}
      </motion.p>
    </motion.div>
  );
};

// ReqDoc Preview Component - Commented out as not needed at this stage
// const ReqDocPreview: React.FC<{ data: typeof COACH_CONFIG.reqDocPreview }> = ({ data }) => (
//   <Card className="bg-slate-50 border-slate-200">
//     <h4 className="font-semibold text-slate-900 mb-4 flex items-center gap-2">
//       <Target size={16} />
//       SmartGrant will normalise your input like this (ReqDoc v1).
//     </h4>
//     <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
//       <div>
//         <span className="font-medium text-slate-600">Problem:</span>
//         <p className="text-slate-800 mt-1">{data.problem}</p>
//       </div>
//       <div>
//         <span className="font-medium text-slate-600">Goal:</span>
//         <p className="text-slate-800 mt-1">{data.goal}</p>
//       </div>
//       <div>
//         <span className="font-medium text-slate-600">Domain:</span>
//         <p className="text-slate-800 mt-1">{data.domain}</p>
//       </div>
//       <div>
//         <span className="font-medium text-slate-600">Complexity:</span>
//         <p className="text-slate-800 mt-1">{data.complexity}</p>
//       </div>
//       <div>
//         <span className="font-medium text-slate-600">Industry:</span>
//         <p className="text-slate-800 mt-1">{data.industry}</p>
//       </div>
//       <div>
//         <span className="font-medium text-slate-600">Budget Band:</span>
//         <p className="text-slate-800 mt-1">S${data.budgetBand[0].toLocaleString()} - S${data.budgetBand[1].toLocaleString()}</p>
//       </div>
//       <div>
//         <span className="font-medium text-slate-600">Timeline:</span>
//         <p className="text-slate-800 mt-1">{data.timelineMonths[0]}-{data.timelineMonths[1]} months</p>
//       </div>
//       <div>
//         <span className="font-medium text-slate-600">Qualification Score:</span>
//         <p className="text-slate-800 mt-1">{data.qualificationScore}%</p>
//       </div>
//     </div>
//     
//     <div className="mt-4 pt-4 border-t border-slate-200">
//       <h5 className="font-medium text-slate-700 mb-2">Grant Predictions:</h5>
//       <div className="space-y-2">
//         {data.grantPredictions.map((prediction, index) => (
//           <div key={index} className="flex items-center justify-between p-2 bg-white rounded-lg border border-slate-100">
//             <div className="flex items-center gap-2">
//               <span className="font-medium text-slate-800">{prediction.grant}</span>
//               <span className="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full">
//                 {Math.round(prediction.confidence * 100)}% match
//               </span>
//             </div>
//             <button className="p-1 text-slate-400 hover:text-slate-600 transition-colors" title={prediction.reason}>
//               <Target size={14} />
//             </button>
//           </div>
//         ))}
//       </div>
//     </div>
//   </Card>
// );

export const Step1_GoalCapture: React.FC<Step1_GoalCaptureProps> = ({ onNext, onBack }) => {
  const [coachState, setCoachState] = useState<CoachState>(initialCoachState);
  const [isTyping, setIsTyping] = useState(false);
  const [showChat, setShowChat] = useState(false);

  const handleDiagnose = async () => {
    const domain = detectDomain(coachState.input);
    if (domain) {
      setIsTyping(true);
      setShowChat(true);
      
      // Simulate typing delay
      await new Promise(resolve => setTimeout(resolve, 800));
      
      setCoachState(prev => coachActions.diagnose(prev, domain));
      setIsTyping(false);
    }
  };

  const handleChatAction = async (actionId: string) => {
    switch (actionId) {
      case 'acquisition':
      case 'retention':
      case 'visibility':
        setIsTyping(true);
        await new Promise(resolve => setTimeout(resolve, 600));
        const label = getClarifierLabel(coachState.domain!, actionId);
        setCoachState(prev => coachActions.chooseClarifier(prev, actionId, label));
        setIsTyping(false);
        break;
      case 'apply':
        setIsTyping(true);
        await new Promise(resolve => setTimeout(resolve, 500));
        const template = COACH_CONFIG.suggestionTemplates[coachState.domain! as keyof typeof COACH_CONFIG.suggestionTemplates];
        const categories = [...COACH_CONFIG.categoryMap[coachState.domain! as keyof typeof COACH_CONFIG.categoryMap]];
        setCoachState(prev => coachActions.applySuggestion(prev, template.text, categories));
        setIsTyping(false);
        break;
      case 'back':
        setCoachState(prev => coachActions.backToClarifiers(prev));
        break;
    }
  };

  const handleShowPreview = () => {
    setCoachState(prev => coachActions.showPreview(prev));
  };

  const handleSubmit = async () => {
    const reqDocId = await mockApi.createReqDoc({
      companyId: 'sme-001',
      problem: COACH_CONFIG.reqDocPreview.problem,
      goal: COACH_CONFIG.reqDocPreview.goal,
      domain: COACH_CONFIG.reqDocPreview.domain,
      complexity: 'LOW',
      budgetBand: COACH_CONFIG.reqDocPreview.budgetBand as [number, number],
      timelineMonths: COACH_CONFIG.reqDocPreview.timelineMonths as [number, number],
      grantRelevant: true,
      trhlsSelectedIds: [],
      visibility: 'PUBLIC',
      qualificationScore: COACH_CONFIG.reqDocPreview.qualificationScore,
      status: 'NEW'
    });
    
    onNext();
  };

  return (
    <div className="max-w-6xl mx-auto animate-fade-in">
      <button 
        onClick={onBack} 
        className="flex items-center gap-2 mb-6 text-sm font-medium text-blue-600 hover:text-blue-700 hover:underline transition-colors"
      >
        <ArrowLeft size={16} />Back to Dashboard
      </button>
      
      <PageHeader 
        title="Requirement Capture" 
        subtitle="Help us understand your business goals so we can find the perfect solutions and grants for you." 
      />

      <ProgressBar currentStep={1} totalSteps={3} />

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* Main Content Area */}
        <div className="lg:col-span-2 space-y-6">
          {/* Textbox - Always visible at top */}
          <Card>
            <div className="space-y-4">
              <div>
                <label className="text-lg font-semibold text-slate-900 mb-2 block">
                  Describe what you're trying to achieve
                </label>
                <div className="relative">
                  <textarea
                    value={coachState.input}
                    readOnly
                    className="goal-textarea w-full p-4 rounded-xl text-slate-900 resize-none"
                    rows={4}
                  />
                  <div className="character-counter absolute top-2 right-2 text-xs text-slate-400 bg-white px-2 py-1 rounded-full shadow-sm">
                    {coachState.input.length} characters
                  </div>
                </div>
              </div>

              {coachState.stage === "INPUT" && (
                <div className="text-right">
                  <motion.button
                    onClick={handleDiagnose}
                    className="bg-blue-600 text-white font-medium px-6 py-3 rounded-lg hover:bg-blue-700 transition-all duration-200 flex items-center gap-2 ml-auto shadow-md hover:shadow-lg"
                    whileHover={{ scale: 1.02 }}
                    whileTap={{ scale: 0.98 }}
                  >
                    <Sparkles size={16} className="text-blue-200" />
                    Diagnose
                    <ArrowRight size={18} />
                  </motion.button>
                </div>
              )}

              {coachState.stage === "INPUT" && (
                <div className="bg-slate-50 rounded-lg p-4 border border-slate-200">
                  <p className="text-sm text-slate-600">
                    Tell us your goal in plain language. We'll help refine it.
                  </p>
                </div>
              )}
            </div>
          </Card>

          {/* Chat Window - Appears after Diagnose */}
          <AnimatePresence>
            {showChat && (
              <motion.div
                initial={{ opacity: 0, height: 0 }}
                animate={{ opacity: 1, height: "auto" }}
                exit={{ opacity: 0, height: 0 }}
                transition={{ duration: 0.4, ease: "easeOut" }}
              >
                <ChatWindow 
                  messages={coachState.messages} 
                  onAction={handleChatAction}
                  isTyping={isTyping}
                />
              </motion.div>
            )}
          </AnimatePresence>

          {/* Applied Suggestion Alert */}
          {coachState.stage === "APPLIED" && (
            <Alert variant="success">
              <div className="flex items-center justify-between w-full">
                <span>Applied suggested improvement to your goal.</span>
                <button
                  onClick={() => setShowChat(!showChat)}
                  className="text-blue-600 hover:text-blue-800 text-sm font-medium transition-colors"
                >
                  {showChat ? 'Hide Chat' : 'Retry Coaching'}
                </button>
              </div>
            </Alert>
          )}

          {/* Preview Section - Shows when applied */}
          {/* ReqDoc Preview commented out as not needed at this stage */}
          {/* {coachState.stage === "PREVIEW_READY" && (
            <ReqDocPreview data={COACH_CONFIG.reqDocPreview} />
          )} */}
        </div>

        {/* Sidebar - Categories and Clarity */}
        <div className="space-y-6">
          {/* Identified Categories */}
          {coachState.categories.length > 0 && (
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.4, ease: "easeOut" }}
            >
              <Card>
                <h4 className="font-semibold text-slate-900 mb-3">Identified Categories</h4>
                <div className="flex flex-wrap gap-2">
                  {coachState.categories.map((category, index) => {
                    const iconMap = {
                      'Growth': TrendingUp,
                      'Marketing': Megaphone,
                      'Digital Transformation': Activity
                    };
                    const colorMap = {
                      'Growth': 'green',
                      'Marketing': 'blue',
                      'Digital Transformation': 'purple'
                    };
                    const Icon = iconMap[category as keyof typeof iconMap] || Target;
                    const color = colorMap[category as keyof typeof colorMap] || 'blue';
                    
                    return (
                      <CategoryChip
                        key={index}
                        label={category}
                        icon={Icon}
                        color={color}
                        index={index}
                      />
                    );
                  })}
                </div>
              </Card>
            </motion.div>
          )}

          {/* Clarity Score */}
          <Card>
            <h4 className="font-semibold text-slate-900 mb-3">Clarity Score</h4>
            <ClarityMeter score={coachState.clarity} />
          </Card>
        </div>
      </div>

      {/* Footer Actions */}
      <motion.div 
        className="mt-8 flex justify-between"
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.4, delay: 0.2 }}
      >
        <motion.button
          onClick={onBack}
          className="px-6 py-2 text-slate-600 hover:text-slate-800 transition-colors"
          whileHover={{ scale: 1.02 }}
          whileTap={{ scale: 0.98 }}
        >
          Cancel
        </motion.button>
        
        <div className="flex gap-3">
          {/* Preview Structured Fields button commented out as ReqDoc preview is not needed */}
          {/* <AnimatePresence>
            {coachState.stage === "APPLIED" && (
              <motion.button
                key="preview"
                initial={{ opacity: 0, scale: 0.8 }}
                animate={{ opacity: 1, scale: 1 }}
                exit={{ opacity: 0, scale: 0.8 }}
                onClick={handleShowPreview}
                className="bg-slate-100 text-slate-700 font-medium px-6 py-3 rounded-lg hover:bg-slate-200 transition-all duration-200 shadow-sm hover:shadow-md"
                whileHover={{ scale: 1.02 }}
                whileTap={{ scale: 0.98 }}
              >
                Preview Structured Fields
              </motion.button>
            )}
          </AnimatePresence> */}
          
          <AnimatePresence>
            {(coachState.stage === "APPLIED" || coachState.stage === "PREVIEW_READY") && (
              <motion.button
                key="continue"
                initial={{ opacity: 0, scale: 0.8, x: 20 }}
                animate={{ opacity: 1, scale: 1, x: 0 }}
                exit={{ opacity: 0, scale: 0.8, x: 20 }}
                onClick={handleSubmit}
                className="bg-blue-600 text-white font-medium px-8 py-3 rounded-lg hover:bg-blue-700 transition-all duration-200 flex items-center gap-2 shadow-md hover:shadow-lg"
                whileHover={{ scale: 1.02 }}
                whileTap={{ scale: 0.98 }}
              >
                Continue â†’ SmartAI Recommends
                <ArrowRight size={18} />
              </motion.button>
            )}
          </AnimatePresence>
        </div>
      </motion.div>
    </div>
  );
};
[Step1_GoalCapture.tsx: end]

File: features/opportunityBuilder/sme/Step2_TRHLS.tsx
[Step2_TRHLS.tsx: start]
import React, { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { ArrowLeft, ArrowRight, CheckCircle, TrendingUp, Users, DollarSign, Clock, BarChart3 } from 'lucide-react';
import { Card } from '../../../components/common/Card';
import { PageHeader } from '../../../components/common/PageHeader';
import { CompareDrawer } from './CompareDrawer';
import { useTrhlsStore } from '../../../state/trhls/store';
import { getGrantBadgeColor, getImpactColor } from '../../../state/trhls/impact';
import { useAppStore } from '../../../state/store';
import { mockApi } from '../../../mocks/api';

interface Step2_TRHLSProps {
  onNext: () => void;
  onBack: () => void;
}

const ProgressBar: React.FC<{ currentStep: number; totalSteps: number }> = ({ currentStep, totalSteps }) => (
  <div className="mb-8">
    <div className="flex items-center justify-between mb-2">
      <span className="text-sm font-medium text-slate-600">Step {currentStep} of {totalSteps}</span>
      <span className="text-sm text-slate-500">
        {currentStep === 1 && 'Describe Your Goal'}
        {currentStep === 2 && 'AI Recommendations'}
        {currentStep === 3 && 'Grant Relevance & Confidence'}
      </span>
    </div>
    <div className="w-full bg-slate-200 rounded-full h-2">
      <div 
        className="progress-bar h-2 rounded-full transition-all duration-500 ease-out"
        style={{ width: `${(currentStep / totalSteps) * 100}%` }}
      />
    </div>
  </div>
);

const SolutionCard: React.FC<{ 
  solution: any; 
  isSelected: boolean; 
  onToggle: () => void;
  index: number;
}> = ({ solution, isSelected, onToggle, index }) => {
  const grantBadgeColor = getGrantBadgeColor(solution.grantTag);
  
  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ delay: index * 0.1 }}
      className={`relative cursor-pointer group ${isSelected ? 'ring-2 ring-blue-500' : ''}`}
      onClick={onToggle}
    >
      <Card className={`h-full transition-all duration-200 ${
        isSelected 
          ? 'bg-blue-50 border-blue-200 shadow-lg' 
          : 'hover:shadow-md hover:scale-[1.02]'
      }`}>
        {/* Selection Badge */}
        {isSelected && (
          <motion.div
            initial={{ scale: 0 }}
            animate={{ scale: 1 }}
            className="absolute -top-2 -right-2 w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center shadow-lg"
          >
            <CheckCircle size={14} className="text-white" />
          </motion.div>
        )}

        {/* Header */}
        <div className="mb-4">
          <div className="flex items-start justify-between mb-2">
            <h3 className="font-semibold text-slate-900 text-lg leading-tight">{solution.name}</h3>
            <span className={`px-2 py-1 rounded-full text-xs font-medium border ${grantBadgeColor}`}>
              {solution.grantTag === 'NON_GRANT' ? 'Self-Funded' : solution.grantTag}
            </span>
          </div>
          <p className="text-sm text-slate-600 mb-3">{solution.whyFit}</p>
        </div>

        {/* Business Impact Preview */}
        <div className="mb-4">
          <h4 className="text-xs font-medium text-slate-700 mb-2 flex items-center gap-1">
            <BarChart3 size={12} />
            Expected Impact
          </h4>
          <div className="grid grid-cols-2 gap-2">
            <div className="text-center p-2 bg-slate-50 rounded-lg">
              <div className={`text-lg font-bold ${getImpactColor(solution.businessImpact.revenueLiftPct, 'revenue')}`}>
                +{solution.businessImpact.revenueLiftPct}%
              </div>
              <div className="text-xs text-slate-600">Revenue Lift</div>
            </div>
            <div className="text-center p-2 bg-slate-50 rounded-lg">
              <div className={`text-lg font-bold ${getImpactColor(solution.businessImpact.leadDeltaPerMonth, 'leads')}`}>
                +{solution.businessImpact.leadDeltaPerMonth}
              </div>
              <div className="text-xs text-slate-600">Leads/mo</div>
            </div>
          </div>
        </div>

        {/* Cost & Duration */}
        <div className="pt-3 border-t border-slate-200">
          <div className="flex justify-between text-sm text-slate-600 mb-2">
            <span>Cost: S${solution.estCostBand[0].toLocaleString()}</span>
            <span>{solution.estDurationMonths[0]}-{solution.estDurationMonths[1]} months</span>
          </div>
          <div className="text-xs text-slate-500">
            {solution.grantTag !== 'NON_GRANT' ? 'Grant-supported' : 'Self-funded'}
          </div>
        </div>

        {/* Hover Effect */}
        <motion.div
          className="absolute inset-0 bg-gradient-to-br from-blue-500/5 to-indigo-500/5 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-200"
          initial={false}
        />
      </Card>
    </motion.div>
  );
};

const CompareBar: React.FC<{ 
  selectedCount: number; 
  onCompare: () => void;
  onClear: () => void;
}> = ({ selectedCount, onCompare, onClear }) => (
  <motion.div
    initial={{ opacity: 0, y: 20 }}
    animate={{ opacity: 1, y: 0 }}
    exit={{ opacity: 0, y: 20 }}
    className="fixed bottom-6 left-1/2 transform -translate-x-1/2 z-30"
  >
    <Card className="bg-white shadow-xl border border-slate-200 px-6 py-4">
      <div className="flex items-center gap-4">
        <div className="flex items-center gap-2">
          <div className="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
            <span className="text-sm font-bold text-blue-600">{selectedCount}</span>
          </div>
          <span className="text-sm font-medium text-slate-700">
            {selectedCount} solution{selectedCount > 1 ? 's' : ''} selected
          </span>
        </div>
        
        <div className="flex gap-2">
          <button
            onClick={onCompare}
            className="bg-blue-600 text-white font-medium px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm"
          >
            Compare Solutions
          </button>
          <button
            onClick={onClear}
            className="bg-slate-100 text-slate-700 font-medium px-4 py-2 rounded-lg hover:bg-slate-200 transition-colors text-sm"
          >
            Clear All
          </button>
        </div>
      </div>
    </Card>
  </motion.div>
);

export const Step2_TRHLS: React.FC<Step2_TRHLSProps> = ({ onNext, onBack }) => {
  const { all, selected, toggleSelect, clear } = useTrhlsStore();
  const [showCompare, setShowCompare] = useState(false);

  const handleToggle = (id: string) => {
    toggleSelect(id);
  };

  const handleCompare = () => {
    setShowCompare(true);
  };

  const handleProceed = async () => {
    // Update ReqDoc with selected TRHLS IDs
    const selectedIds = selected.map(s => s.id);
    
    // For now, we'll just proceed to next step
    // In a real app, you'd update the ReqDoc with the selected TRHLS IDs
    console.log('Selected TRHLS IDs:', selectedIds);
    
    onNext();
  };

  const handleClear = () => {
    clear();
  };

  return (
    <div className="max-w-7xl mx-auto animate-fade-in">
      <button 
        onClick={onBack} 
        className="flex items-center gap-2 mb-6 text-sm font-medium text-blue-600 hover:text-blue-700 hover:underline transition-colors"
      >
        <ArrowLeft size={16} />Back to Goal Capture
      </button>
      
      <PageHeader 
        title="AI Recommendations" 
        subtitle="Based on your goal, here are 5 tailored solutions that could help improve your online visibility and customer acquisition." 
      />

      <ProgressBar currentStep={2} totalSteps={3} />

      {/* Solutions Grid */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
        {all.map((solution, index) => (
          <SolutionCard
            key={solution.id}
            solution={solution}
            isSelected={selected.some(s => s.id === solution.id)}
            onToggle={() => handleToggle(solution.id)}
            index={index}
          />
        ))}
      </div>

      {/* Selection Instructions */}
      <Card className="bg-blue-50 border-blue-200 mb-8">
        <div className="flex items-start gap-3">
          <div className="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0">
            <TrendingUp size={16} className="text-blue-600" />
          </div>
          <div>
            <h3 className="font-semibold text-blue-900 mb-1">How to proceed</h3>
            <p className="text-sm text-blue-800">
              Select 1-3 solutions that interest you. You can compare them side-by-side to see detailed impact metrics and grant support information.
            </p>
          </div>
        </div>
      </Card>

      {/* Compare Bar */}
      <AnimatePresence>
        {selected.length > 0 && (
          <CompareBar
            selectedCount={selected.length}
            onCompare={handleCompare}
            onClear={handleClear}
          />
        )}
      </AnimatePresence>

      {/* Compare Drawer */}
      <CompareDrawer
        isOpen={showCompare}
        onClose={() => setShowCompare(false)}
        selected={selected}
        onProceed={handleProceed}
      />

      {/* Footer Actions */}
      <motion.div 
        className="mt-8 flex justify-between"
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.4, delay: 0.2 }}
      >
        <motion.button
          onClick={onBack}
          className="px-6 py-2 text-slate-600 hover:text-slate-800 transition-colors"
          whileHover={{ scale: 1.02 }}
          whileTap={{ scale: 0.98 }}
        >
          Cancel
        </motion.button>
        
        <div className="flex gap-3">
          <AnimatePresence>
            {selected.length > 0 && (
              <motion.button
                key="continue"
                initial={{ opacity: 0, scale: 0.8, x: 20 }}
                animate={{ opacity: 1, scale: 1, x: 0 }}
                exit={{ opacity: 0, scale: 0.8, x: 20 }}
                onClick={handleProceed}
                className="bg-blue-600 text-white font-medium px-8 py-3 rounded-lg hover:bg-blue-700 transition-all duration-200 flex items-center gap-2 shadow-md hover:shadow-lg"
                whileHover={{ scale: 1.02 }}
                whileTap={{ scale: 0.98 }}
              >
                Continue with Selected Solutions
                <ArrowRight size={18} />
              </motion.button>
            )}
          </AnimatePresence>
        </div>
      </motion.div>
    </div>
  );
};
[Step2_TRHLS.tsx: end]

File: features/opportunityBuilder/sme/Step3_PrivacyAndConsent.tsx
[Step3_PrivacyAndConsent.tsx: start]
import React, { useState } from 'react';
import { ArrowLeft, ArrowRight, Check } from 'lucide-react';
import { Card } from '../../../components/common/Card';
import { PageHeader } from '../../../components/common/PageHeader';
import { useAppStore } from '../../../state/store';
import { mockApi } from '../../../mocks/api';

interface Step3_PrivacyAndConsentProps {
  onNext: () => void;
  onBack: () => void;
}

export const Step3_PrivacyAndConsent: React.FC<Step3_PrivacyAndConsentProps> = ({ onNext, onBack }) => {
  const { currentReqDocId } = useAppStore();
  const [visibility, setVisibility] = useState<'PRIVATE' | 'LIMITED' | 'PUBLIC'>('PRIVATE');
  const [allowMatching, setAllowMatching] = useState(false);

  const handleNext = async () => {
    if (currentReqDocId) {
      await mockApi.setVisibility(currentReqDocId, visibility);
    }
    onNext();
  };

  const visibilityOptions = [
    {
      value: 'PRIVATE' as const,
      title: 'Private',
      description: 'Only you can see this opportunity',
      details: 'Perfect for confidential projects or when you want to work with specific partners only.'
    },
    {
      value: 'LIMITED' as const,
      title: 'Limited',
      description: 'Visible to pre-qualified partners',
      details: 'SmartGrant will match you with verified vendors and consultants based on your criteria.'
    },
    {
      value: 'PUBLIC' as const,
      title: 'Public',
      description: 'Visible to all registered partners',
      details: 'Maximum visibility for competitive bidding and finding the best match for your project.'
    }
  ];

  return (
    <div className="max-w-4xl mx-auto animate-fade-in">
      <button 
        onClick={onBack} 
        className="flex items-center gap-2 mb-6 text-sm font-medium text-blue-600 hover:text-blue-700 hover:underline transition-colors"
      >
        <ArrowLeft size={16} />Back to Recommendations
      </button>
      
      <PageHeader 
        title="Privacy & Consent" 
        subtitle="Step 3: Set Your Visibility Preferences. Choose how much information to share with potential partners." 
      />

      <Card className="space-y-6">
        <div>
          <h3 className="text-lg font-semibold text-slate-900 mb-4">Visibility Level</h3>
          <div className="space-y-4">
            {visibilityOptions.map(option => (
              <div
                key={option.value}
                onClick={() => setVisibility(option.value)}
                className={`p-4 rounded-lg border-2 cursor-pointer transition-all ${
                  visibility === option.value
                    ? 'border-blue-500 bg-blue-50'
                    : 'border-slate-200 hover:border-slate-300'
                }`}
              >
                <div className="flex items-start justify-between">
                  <div className="flex-1">
                    <h4 className="font-semibold text-slate-900">{option.title}</h4>
                    <p className="text-sm text-slate-600 mt-1">{option.description}</p>
                    <p className="text-xs text-slate-500 mt-2">{option.details}</p>
                  </div>
                  {visibility === option.value && (
                    <div className="ml-4 bg-blue-600 text-white rounded-full p-1">
                      <Check size={16} />
                    </div>
                  )}
                </div>
              </div>
            ))}
          </div>
        </div>

        <div className="border-t border-slate-200 pt-6">
          <div className="flex items-center justify-between p-4 bg-slate-50 rounded-lg border border-slate-200">
            <div>
              <label htmlFor="matching-toggle" className="font-medium text-slate-700">
                Allow Smart Matching
              </label>
              <p className="text-sm text-slate-500 mt-1">
                Let SmartGrant automatically match you with suitable vendors and consultants
              </p>
            </div>
            <button
              id="matching-toggle"
              type="button"
              role="switch"
              aria-checked={allowMatching}
              onClick={() => setAllowMatching(!allowMatching)}
              className={`${allowMatching ? 'bg-blue-600' : 'bg-slate-300'} relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2`}
            >
              <span
                aria-hidden="true"
                className={`${allowMatching ? 'translate-x-5' : 'translate-x-0'} inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out`}
              />
            </button>
          </div>
        </div>

        <div className="text-right pt-4 border-t border-slate-200">
          <button
            onClick={handleNext}
            disabled={!allowMatching}
            className="bg-blue-600 text-white font-medium px-8 py-3 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 ml-auto disabled:bg-slate-300 disabled:text-slate-500 disabled:cursor-not-allowed"
          >
            Continue to Matching Mode
            <ArrowRight size={18} />
          </button>
        </div>
      </Card>
    </div>
  );
};
[Step3_PrivacyAndConsent.tsx: end]

File: features/opportunityBuilder/sme/Step4_MatchingMode.tsx
[Step4_MatchingMode.tsx: start]
import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { ArrowLeft, ArrowRight, Zap, Info } from 'lucide-react';
import { PageHeader } from '../../../components/common/PageHeader';
import { ModeCard } from '../../../components/common/ModeCard';
import { getSmartRecommendation } from '../../../state/matching/recommendation';
import { useAppStore } from '../../../state/store';

interface Step4_MatchingModeProps {
  onNext: () => void;
  onBack: () => void;
}

const ProgressBar: React.FC<{ currentStep: number; totalSteps: number }> = ({ currentStep, totalSteps }) => (
  <div className="mb-8">
    <div className="flex items-center justify-between mb-2">
      <span className="text-sm font-medium text-slate-600">Step {currentStep} of {totalSteps}</span>
      <span className="text-sm text-slate-500">
        {currentStep === 1 && 'Describe Your Goal'}
        {currentStep === 2 && 'AI Recommendations'}
        {currentStep === 3 && 'Grant Relevance & Confidence'}
        {currentStep === 4 && 'Matching Setup'}
      </span>
    </div>
    <div className="w-full bg-slate-200 rounded-full h-2">
      <div 
        className="progress-bar h-2 rounded-full transition-all duration-500 ease-out"
        style={{ width: `${(currentStep / totalSteps) * 100}%` }}
      />
    </div>
  </div>
);

const RecommendationBanner: React.FC<{ 
  recommended: 'CONSULTANT_MANAGED' | 'SME_SELF_MANAGED';
  bannerText: string;
  tooltipText: string;
  isMobile?: boolean;
}> = ({ recommended, bannerText, tooltipText, isMobile = false }) => (
  <motion.div
    initial={{ opacity: 0, scale: 0.95 }}
    animate={{ opacity: 1, scale: 1 }}
    transition={{ duration: 0.4, ease: "easeOut" }}
    className="bg-gradient-to-r from-indigo-50 to-sky-50 rounded-xl border border-indigo-200 p-4 mb-6"
  >
    <div className="flex items-start gap-3">
      <div className="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center flex-shrink-0">
        <Zap size={16} className="text-indigo-600" />
      </div>
      <div className="flex-1">
        <div className="flex items-center gap-2 mb-1">
          <span className="px-2 py-1 bg-indigo-100 text-indigo-700 text-xs font-medium rounded-full">
            Recommended
          </span>
          <div className="group relative">
            <Info size={14} className="text-slate-400 cursor-help" />
            <div className="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-slate-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap z-10">
              {tooltipText}
              <div className="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-slate-900" />
            </div>
          </div>
        </div>
        <p className={`text-slate-700 ${isMobile ? 'text-sm' : 'text-sm'}`}>
          {bannerText}
        </p>
      </div>
    </div>
  </motion.div>
);

const MobileFooter: React.FC<{
  onBack: () => void;
  onContinue: () => void;
  hasSelection: boolean;
  selectedMode: string;
}> = ({ onBack, onContinue, hasSelection, selectedMode }) => (
  <motion.div
    initial={{ opacity: 0, y: 20 }}
    animate={{ opacity: 1, y: 0 }}
    className="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 px-4 py-3 z-40 md:hidden"
  >
    <div className="flex items-center justify-between">
      <button
        onClick={onBack}
        className="px-4 py-2 text-slate-600 hover:text-slate-800 transition-colors text-sm"
      >
        â—€ Back
      </button>
      
      <motion.button
        onClick={onContinue}
        disabled={!hasSelection}
        className={`px-6 py-2 rounded-lg font-medium transition-all duration-200 flex items-center gap-2 text-sm ${
          hasSelection
            ? 'bg-indigo-600 text-white hover:bg-indigo-700'
            : 'bg-slate-100 text-slate-400 cursor-not-allowed'
        }`}
        whileHover={hasSelection ? { scale: 1.02 } : {}}
        whileTap={hasSelection ? { scale: 0.98 } : {}}
        aria-label={`Continue with ${selectedMode === 'CONSULTANT_MANAGED' ? 'Consultant-Managed' : 'Self-Managed'} Mode`}
      >
        Continue {selectedMode === 'CONSULTANT_MANAGED' ? 'with Consultant-Managed' : 'with Self-Managed'} â†’
      </motion.button>
    </div>
  </motion.div>
);

const DesktopFooter: React.FC<{
  onBack: () => void;
  onContinue: () => void;
  hasSelection: boolean;
  selectedMode: string;
}> = ({ onBack, onContinue, hasSelection, selectedMode }) => (
  <motion.div
    initial={{ opacity: 0, y: 20 }}
    animate={{ opacity: 1, y: 0 }}
    transition={{ duration: 0.4, delay: 0.2 }}
    className="hidden md:flex items-center justify-between mt-8 pt-6 border-t border-slate-200"
  >
    <motion.button
      onClick={onBack}
      className="px-6 py-2 text-slate-600 hover:text-slate-800 transition-colors"
      whileHover={{ scale: 1.02 }}
      whileTap={{ scale: 0.98 }}
    >
      Back
    </motion.button>
    
    <motion.button
      onClick={onContinue}
      disabled={!hasSelection}
      className={`px-8 py-3 rounded-lg font-medium transition-all duration-200 flex items-center gap-2 ${
        hasSelection
          ? 'bg-indigo-600 text-white hover:bg-indigo-700 shadow-md hover:shadow-lg'
          : 'bg-slate-100 text-slate-400 cursor-not-allowed'
      }`}
      whileHover={hasSelection ? { scale: 1.02 } : {}}
      whileTap={hasSelection ? { scale: 0.98 } : {}}
      aria-label={`Continue with ${selectedMode === 'CONSULTANT_MANAGED' ? 'Consultant-Managed' : 'Self-Managed'} Mode`}
    >
      Continue {selectedMode === 'CONSULTANT_MANAGED' ? 'with Consultant-Managed' : 'with Self-Managed'} Mode
      <ArrowRight size={18} />
    </motion.button>
  </motion.div>
);

export const Step4_MatchingMode: React.FC<Step4_MatchingModeProps> = ({ onNext, onBack }) => {
  const { reqDocs } = useAppStore();
  const [selectedMode, setSelectedMode] = useState<'CONSULTANT_MANAGED' | 'SME_SELF_MANAGED' | null>(null);
  const [isMobile, setIsMobile] = useState(false);

  // Get the most recent ReqDoc (in a real app, this would be the current one)
  const currentReqDoc = reqDocs[reqDocs.length - 1] || null;
  const recommendation = getSmartRecommendation(currentReqDoc);

  useEffect(() => {
    // Set default selection to recommended mode
    setSelectedMode(recommendation.recommended);
  }, [recommendation.recommended]);

  useEffect(() => {
    const checkMobile = () => {
      setIsMobile(window.innerWidth < 768);
    };
    
    checkMobile();
    window.addEventListener('resize', checkMobile);
    return () => window.removeEventListener('resize', checkMobile);
  }, []);

  const handleModeSelect = (mode: 'CONSULTANT_MANAGED' | 'SME_SELF_MANAGED') => {
    setSelectedMode(mode);
  };

  const handleContinue = () => {
    if (selectedMode) {
      // In a real app, you'd update the ReqDoc with the selected matching mode
      console.log('Selected matching mode:', selectedMode);
      onNext();
    }
  };

  return (
    <div className="max-w-6xl mx-auto animate-fade-in pb-20 md:pb-0">
      <button 
        onClick={onBack} 
        className="flex items-center gap-2 mb-6 text-sm font-medium text-indigo-600 hover:text-indigo-700 hover:underline transition-colors"
      >
        <ArrowLeft size={16} />Back to Recommendations
      </button>
      
      <PageHeader 
        title="Matching Setup" 
        subtitle="Choose your workflow. You can switch before invitations go out." 
      />

      <ProgressBar currentStep={4} totalSteps={4} />

      {/* Recommendation Banner */}
      <RecommendationBanner
        recommended={recommendation.recommended}
        bannerText={recommendation.bannerText}
        tooltipText={recommendation.tooltipText}
        isMobile={isMobile}
      />

      {/* Mode Selection */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <ModeCard
          mode="CONSULTANT_MANAGED"
          isSelected={selectedMode === 'CONSULTANT_MANAGED'}
          onSelect={() => handleModeSelect('CONSULTANT_MANAGED')}
          isMobile={isMobile}
        />
        
        <ModeCard
          mode="SME_SELF_MANAGED"
          isSelected={selectedMode === 'SME_SELF_MANAGED'}
          onSelect={() => handleModeSelect('SME_SELF_MANAGED')}
          isMobile={isMobile}
        />
      </div>

      {/* Mobile Footer */}
      <MobileFooter
        onBack={onBack}
        onContinue={handleContinue}
        hasSelection={!!selectedMode}
        selectedMode={selectedMode || ''}
      />

      {/* Desktop Footer */}
      <DesktopFooter
        onBack={onBack}
        onContinue={handleContinue}
        hasSelection={!!selectedMode}
        selectedMode={selectedMode || ''}
      />
    </div>
  );
};
[Step4_MatchingMode.tsx: end]

File: features/opportunityBuilder/sme/Step5_PreviewAndDispatch.tsx
[Step5_PreviewAndDispatch.tsx: start]
import React, { useState } from 'react';
import { ArrowLeft, ArrowRight, Check, Users, Briefcase } from 'lucide-react';
import { Card } from '../../../components/common/Card';
import { PageHeader } from '../../../components/common/PageHeader';
import { useAppStore } from '../../../state/store';
import { mockApi } from '../../../mocks/api';

interface Step5_PreviewAndDispatchProps {
  onNext: () => void;
  onBack: () => void;
}

const VENDOR_SHORTLIST = [
  { name: 'Acme ERP', badges: ['Top Match', 'Budget Fit'], whyMatched: 'PSG pre-approved â€¢ 3 F&B case studies â€¢ Fast deployment' },
  { name: 'Nova Cloud', badges: ['Fastest Deploy', 'Analytics'], whyMatched: 'Cloud native â€¢ Analytics â€¢ PSG Approved' },
  { name: 'TechFlow Systems', badges: ['Enterprise Grade'], whyMatched: 'Manufacturing/IoT specialist â€¢ EDG eligible' },
  { name: 'DataWise Analytics', badges: ['Cost Effective'], whyMatched: 'Affordable analytics â€¢ Self-service platform' },
  { name: 'CloudScale Solutions', badges: ['PSG Ready'], whyMatched: 'F&B inventory specialist â€¢ Quick ROI' },
];

const CONSULTANT_SHORTLIST = [
  { name: 'Carter Advisory', badges: ['Top Match', 'High Success Rate'], whyMatched: 'EDG specialist â€¢ 92% win rate' },
  { name: 'Aegis Partners', badges: ['Fast Turnaround'], whyMatched: 'Fast claims â€¢ PSG/EDG coverage' },
  { name: 'Strategic Insights', badges: ['Tech Strategy'], whyMatched: 'Digital strategy â€¢ Quick start' },
  { name: 'InsightWorks Consulting', badges: ['Retail & Service'], whyMatched: 'Industry ops experience â€¢ 91% success rate' },
];

const ShortlistCard: React.FC<{
  name: string;
  type: 'vendor' | 'consultant';
  badges: string[];
  whyMatched: string;
  isSelected: boolean;
  onToggle: () => void;
}> = ({ name, type, badges, whyMatched, isSelected, onToggle }) => (
  <Card 
    onClick={onToggle}
    className={`cursor-pointer transition-all ${
      isSelected 
        ? 'border-blue-500 bg-blue-50' 
        : 'hover:border-slate-300'
    }`}
  >
    <div className="flex items-start justify-between">
      <div className="flex-1">
        <div className="flex items-center gap-2 mb-2">
          {type === 'vendor' ? <Users size={16} className="text-blue-500" /> : <Briefcase size={16} className="text-green-500" />}
          <h4 className="font-semibold text-slate-900">{name}</h4>
        </div>
        <div className="flex flex-wrap gap-1 mb-2">
          {badges.map((badge, index) => (
            <span 
              key={index}
              className="px-2 py-0.5 text-xs font-medium rounded-full bg-slate-100 text-slate-700"
            >
              {badge}
            </span>
          ))}
        </div>
        <p className="text-sm text-slate-600">{whyMatched}</p>
      </div>
      {isSelected && (
        <div className="ml-4 bg-indigo-600 text-white rounded-full p-1">
          <Check size={16} />
        </div>
      )}
    </div>
  </Card>
);

export const Step5_PreviewAndDispatch: React.FC<Step5_PreviewAndDispatchProps> = ({ onNext, onBack }) => {
  const { currentReqDocId } = useAppStore();
  const [selectedVendors, setSelectedVendors] = useState<string[]>(() =>
    VENDOR_SHORTLIST.slice(0, 3).map(v => v.name)
  );
  const [selectedConsultants, setSelectedConsultants] = useState<string[]>(() =>
    CONSULTANT_SHORTLIST.slice(0, 3).map(c => c.name)
  );

  const toggleVendor = (name: string) => {
    setSelectedVendors(prev => 
      prev.includes(name) 
        ? prev.filter(n => n !== name)
        : [...prev, name]
    );
  };

  const toggleConsultant = (name: string) => {
    setSelectedConsultants(prev => 
      prev.includes(name) 
        ? prev.filter(n => n !== name)
        : [...prev, name]
    );
  };

  const handleDispatch = async () => {
    if (currentReqDocId) {
      await mockApi.seedMatching(currentReqDocId);
    }
    onNext();
  };

  return (
    <div className="max-w-6xl mx-auto animate-fade-in">
      <button 
        onClick={onBack} 
        className="flex items-center gap-2 mb-6 text-sm font-medium text-blue-600 hover:text-blue-700 hover:underline transition-colors"
      >
        <ArrowLeft size={16} />Back to Matching Mode
      </button>
      
      <PageHeader 
        title="Preview & Dispatch" 
        subtitle="Step 5: Review Your Shortlist. Select the vendors and consultants you'd like to invite to your opportunity." 
      />

      <div className="space-y-8">
        <div>
          <h3 className="text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2">
            <Users className="text-blue-500" size={20} />
            Recommended Vendors
          </h3>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {VENDOR_SHORTLIST.map(vendor => (
              <ShortlistCard
                key={vendor.name}
                name={vendor.name}
                type="vendor"
                badges={vendor.badges}
                whyMatched={vendor.whyMatched}
                isSelected={selectedVendors.includes(vendor.name)}
                onToggle={() => toggleVendor(vendor.name)}
              />
            ))}
          </div>
        </div>

        <div>
          <h3 className="text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2">
            <Briefcase className="text-green-500" size={20} />
            Recommended Consultants
          </h3>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            {CONSULTANT_SHORTLIST.map(consultant => (
              <ShortlistCard
                key={consultant.name}
                name={consultant.name}
                type="consultant"
                badges={consultant.badges}
                whyMatched={consultant.whyMatched}
                isSelected={selectedConsultants.includes(consultant.name)}
                onToggle={() => toggleConsultant(consultant.name)}
              />
            ))}
          </div>
        </div>

        <Card className="bg-emerald-50 border-emerald-200">
          <h4 className="font-semibold text-emerald-800 mb-2">Ready to Dispatch</h4>
          <p className="text-sm text-emerald-700">
            You've selected {selectedVendors.length} vendor(s) and {selectedConsultants.length} consultant(s). 
            They will receive masked lead previews and can choose to accept for 1 credit each.
          </p>
        </Card>
      </div>

      <div className="flex justify-between items-center mt-8 pt-6 border-t border-slate-200 dark:border-slate-700">
        <button 
          onClick={onBack} 
          className="bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-slate-200 px-6 py-3 rounded-lg font-semibold hover:bg-slate-300 dark:hover:bg-slate-600"
        >
          Back
        </button>
        <button 
          onClick={handleDispatch}
          disabled={selectedVendors.length<3 || selectedConsultants.length<3}
          className={"bg-indigo-600 text-white font-semibold px-8 py-3 rounded-lg hover:bg-indigo-700 transition-colors flex items-center gap-2 ml-auto "+(selectedVendors.length<3||selectedConsultants.length<3?' opacity-50 cursor-not-allowed':'')}
        >
          Dispatch Invitations
          <ArrowRight size={18} />
        </button>
        {(selectedVendors.length<3 || selectedConsultants.length<3)&&(
          <div className="text-red-500 mt-2 text-sm">Select at least 3 vendors and 3 consultants to proceed.</div>
        )}
      </div>
    </div>
  );
};
[Step5_PreviewAndDispatch.tsx: end]

File: features/opportunityBuilder/sme/Step5_PreviewDispatch.tsx
[Step5_PreviewDispatch.tsx: start]
import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { ArrowLeft, ArrowRight, CheckCircle, Users, Briefcase, Star, Clock, DollarSign, Shield, Eye, EyeOff, Settings } from 'lucide-react';
import { PageHeader } from '../../../components/common/PageHeader';
import { usePreviewStore } from '../../../state/preview/store';
import { Vendor, Consultant } from '../../../state/preview/types';

interface Step5_PreviewDispatchProps {
  onNext: () => void;
  onBack: () => void;
}

const ProgressBar: React.FC<{ currentStep: number; totalSteps: number }> = ({ currentStep, totalSteps }) => (
  <div className="mb-8">
    <div className="flex items-center justify-between mb-2">
      <span className="text-sm font-medium text-slate-600">Step {currentStep} of {totalSteps}</span>
      <span className="text-sm text-slate-500">Preview & Dispatch</span>
    </div>
    <div className="w-full bg-slate-200 rounded-full h-2">
      <div 
        className="bg-gradient-to-r from-indigo-500 to-purple-500 h-2 rounded-full transition-all duration-500 ease-out"
        style={{ width: `${(currentStep / totalSteps) * 100}%` }}
      />
    </div>
  </div>
);

const SummaryCard: React.FC<{
  vendorCount: number;
  consultantCount: number;
  totalSelected: number;
}> = ({ vendorCount, consultantCount, totalSelected }) => (
  <motion.div
    initial={{ opacity: 0, y: 20 }}
    animate={{ opacity: 1, y: 0 }}
    className="bg-gradient-to-r from-indigo-50 to-purple-50 border border-indigo-200 rounded-2xl p-6 mb-8"
  >
    <div className="flex items-center justify-between">
      <div className="flex items-center gap-4">
        <div className="w-12 h-12 bg-indigo-100 rounded-xl flex items-center justify-center">
          <CheckCircle size={24} className="text-indigo-600" />
        </div>
        <div>
          <h3 className="text-lg font-semibold text-slate-900">Ready to Send Invitations</h3>
          <p className="text-slate-600">Review your selections before dispatching</p>
        </div>
      </div>
      <div className="text-right">
        <div className="text-2xl font-bold text-indigo-600">{totalSelected}</div>
        <div className="text-sm text-slate-500">Total Selected</div>
      </div>
    </div>
    
    <div className="grid grid-cols-2 gap-4 mt-6">
      <div className="bg-white rounded-lg p-4 border border-slate-200">
        <div className="flex items-center gap-2 mb-2">
          <Briefcase size={16} className="text-blue-600" />
          <span className="text-sm font-medium text-slate-700">Vendors</span>
        </div>
        <div className="text-2xl font-bold text-blue-600">{vendorCount}</div>
      </div>
      <div className="bg-white rounded-lg p-4 border border-slate-200">
        <div className="flex items-center gap-2 mb-2">
          <Users size={16} className="text-purple-600" />
          <span className="text-sm font-medium text-slate-700">Consultants</span>
        </div>
        <div className="text-2xl font-bold text-purple-600">{consultantCount}</div>
      </div>
    </div>
  </motion.div>
);

const VendorCard: React.FC<{
  vendor: Vendor;
  onToggle: (id: string) => void;
}> = ({ vendor, onToggle }) => (
  <motion.div
    initial={{ opacity: 0, scale: 0.95 }}
    animate={{ opacity: 1, scale: 1 }}
    whileHover={{ scale: 1.02 }}
    className={`relative bg-white rounded-xl border-2 transition-all duration-200 cursor-pointer ${
      vendor.selected 
        ? 'border-indigo-500 bg-indigo-50/50 shadow-lg' 
        : 'border-slate-200 hover:border-slate-300 hover:shadow-md'
    }`}
    onClick={() => onToggle(vendor.id)}
  >
    {/* Selection Indicator */}
    {vendor.selected && (
      <div className="absolute -top-2 -right-2 w-6 h-6 bg-indigo-600 rounded-full flex items-center justify-center shadow-lg">
        <CheckCircle size={14} className="text-white" />
      </div>
    )}

    {/* Match Badge */}
    <div className="absolute top-4 right-4">
      <div className={`px-3 py-1 rounded-full text-xs font-semibold ${
        vendor.match >= 85 ? 'bg-green-100 text-green-700' :
        vendor.match >= 70 ? 'bg-blue-100 text-blue-700' :
        'bg-slate-100 text-slate-700'
      }`}>
        {vendor.match}% Match
      </div>
    </div>

    <div className="p-6">
      {/* Header */}
      <div className="flex items-start gap-4 mb-4">
        <div className="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center text-white font-bold text-xl">
          {vendor.name.charAt(0)}
        </div>
        <div className="flex-1">
          <h3 className="text-lg font-semibold text-slate-900 mb-1">{vendor.name}</h3>
          <p className="text-slate-600 text-sm">{vendor.product}</p>
          <div className="flex items-center gap-2 mt-2">
            <span className="px-2 py-1 bg-slate-100 text-slate-600 text-xs rounded-full">
              {vendor.grantTag} Approved
            </span>
            <span className="px-2 py-1 bg-slate-100 text-slate-600 text-xs rounded-full">
              {vendor.sector} Sector
            </span>
          </div>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-2 gap-4 mb-4">
        <div className="flex items-center gap-2">
          <DollarSign size={16} className="text-green-600" />
          <div>
            <div className="text-sm font-medium text-slate-900">
              S$ {vendor.costRange[0].toLocaleString()}K - {vendor.costRange[1].toLocaleString()}K
            </div>
            <div className="text-xs text-slate-500">Estimated Cost</div>
          </div>
        </div>
        <div className="flex items-center gap-2">
          <Clock size={16} className="text-blue-600" />
          <div>
            <div className="text-sm font-medium text-slate-900">
              {vendor.duration[0]} - {vendor.duration[1]} months
            </div>
            <div className="text-xs text-slate-500">Timeline</div>
          </div>
        </div>
      </div>

      {/* Match Reason */}
      <div className="bg-slate-50 rounded-lg p-3 mb-4">
        <p className="text-sm text-slate-700">
          <span className="font-medium">Why matched:</span> {vendor.reason}
        </p>
      </div>

      {/* Tags */}
      <div className="flex flex-wrap gap-2">
        {vendor.tags.map((tag, index) => (
          <span
            key={index}
            className="px-2 py-1 bg-indigo-100 text-indigo-700 text-xs rounded-full"
          >
            {tag}
          </span>
        ))}
      </div>
    </div>
  </motion.div>
);

const ConsultantCard: React.FC<{
  consultant: Consultant;
  onToggle: (id: string) => void;
}> = ({ consultant, onToggle }) => (
  <motion.div
    initial={{ opacity: 0, scale: 0.95 }}
    animate={{ opacity: 1, scale: 1 }}
    whileHover={{ scale: 1.02 }}
    className={`relative bg-white rounded-xl border-2 transition-all duration-200 cursor-pointer ${
      consultant.selected 
        ? 'border-purple-500 bg-purple-50/50 shadow-lg' 
        : 'border-slate-200 hover:border-slate-300 hover:shadow-md'
    }`}
    onClick={() => onToggle(consultant.id)}
  >
    {/* Selection Indicator */}
    {consultant.selected && (
      <div className="absolute -top-2 -right-2 w-6 h-6 bg-purple-600 rounded-full flex items-center justify-center shadow-lg">
        <CheckCircle size={14} className="text-white" />
      </div>
    )}

    {/* Match Badge */}
    <div className="absolute top-4 right-4">
      <div className={`px-3 py-1 rounded-full text-xs font-semibold ${
        consultant.match >= 85 ? 'bg-green-100 text-green-700' :
        consultant.match >= 70 ? 'bg-blue-100 text-blue-700' :
        'bg-slate-100 text-slate-700'
      }`}>
        {consultant.match}% Match
      </div>
    </div>

    <div className="p-6">
      {/* Header */}
      <div className="flex items-start gap-4 mb-4">
        <div className="w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl flex items-center justify-center text-white font-bold text-xl">
          {consultant.name.charAt(0)}
        </div>
        <div className="flex-1">
          <h3 className="text-lg font-semibold text-slate-900 mb-1">{consultant.name}</h3>
          <p className="text-slate-600 text-sm">{consultant.specialty}</p>
          <div className="flex items-center gap-2 mt-2">
            <span className="px-2 py-1 bg-slate-100 text-slate-600 text-xs rounded-full">
              {consultant.experience}
            </span>
            <span className="px-2 py-1 bg-slate-100 text-slate-600 text-xs rounded-full">
              {consultant.successRate}% Success Rate
            </span>
          </div>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-2 gap-4 mb-4">
        <div className="flex items-center gap-2">
          <Star size={16} className="text-amber-500" />
          <div>
            <div className="text-sm font-medium text-slate-900">{consultant.rating} / 5</div>
            <div className="text-xs text-slate-500">Rating</div>
          </div>
        </div>
        <div className="flex items-center gap-2">
          <Clock size={16} className="text-purple-600" />
          <div>
            <div className="text-sm font-medium text-slate-900">{consultant.avgTurnaround} days</div>
            <div className="text-xs text-slate-500">Avg Turnaround</div>
          </div>
        </div>
      </div>

      {/* Core Focus */}
      <div className="mb-4">
        <p className="text-xs font-medium text-slate-500 mb-2">Core Focus:</p>
        <div className="flex flex-wrap gap-1">
          {consultant.coreFocus.map((focus, index) => (
            <span
              key={index}
              className="px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded-full"
            >
              {focus}
            </span>
          ))}
        </div>
      </div>
    </div>
  </motion.div>
);

const VisibilitySettings: React.FC<{
  visibility: 'PRIVATE' | 'LIMITED' | 'PUBLIC';
  onVisibilityChange: (visibility: 'PRIVATE' | 'LIMITED' | 'PUBLIC') => void;
}> = ({ visibility, onVisibilityChange }) => {
  const [isOpen, setIsOpen] = useState(false);

  const options = [
    {
      value: 'PRIVATE' as const,
      label: 'Private',
      description: 'Only you can see this lead',
      icon: Shield
    },
    {
      value: 'LIMITED' as const,
      label: 'Limited',
      description: 'Only matched vendors/consultants',
      icon: Eye
    },
    {
      value: 'PUBLIC' as const,
      label: 'Public',
      description: 'Visible to all SmartGrant users',
      icon: EyeOff
    }
  ];

  const currentOption = options.find(opt => opt.value === visibility);

  return (
    <div className="relative">
      <motion.button
        onClick={() => setIsOpen(!isOpen)}
        className="flex items-center gap-2 px-4 py-2 bg-white border border-slate-300 rounded-lg hover:border-slate-400 transition-colors"
        whileHover={{ scale: 1.02 }}
        whileTap={{ scale: 0.98 }}
      >
        <Settings size={16} className="text-slate-600" />
        <span className="text-sm font-medium text-slate-700">
          Visibility: {currentOption?.label}
        </span>
      </motion.button>

      <AnimatePresence>
        {isOpen && (
          <motion.div
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: 10 }}
            className="absolute top-full left-0 mt-2 w-64 bg-white border border-slate-200 rounded-lg shadow-lg z-10"
          >
            {options.map((option) => {
              const Icon = option.icon;
              return (
                <motion.button
                  key={option.value}
                  onClick={() => {
                    onVisibilityChange(option.value);
                    setIsOpen(false);
                  }}
                  className={`w-full flex items-center gap-3 px-4 py-3 text-left hover:bg-slate-50 transition-colors ${
                    visibility === option.value ? 'bg-indigo-50' : ''
                  }`}
                  whileHover={{ scale: 1.01 }}
                >
                  <Icon size={16} className="text-slate-600" />
                  <div>
                    <div className="font-medium text-slate-900">{option.label}</div>
                    <div className="text-xs text-slate-500">{option.description}</div>
                  </div>
                </motion.button>
              );
            })}
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
};

export const Step5_PreviewDispatch: React.FC<Step5_PreviewDispatchProps> = ({ onNext, onBack }) => {
  const {
    vendors,
    consultants,
    visibility,
    vendorCount,
    consultantCount,
    toggleVendor,
    toggleConsultant,
    setVisibility
  } = usePreviewStore();

  const totalSelected = vendorCount + consultantCount;
  const canDispatch = vendorCount > 0;

  // Filter by match percentage
  const recommendedVendors = vendors.filter(v => v.match >= 80);
  const otherVendors = vendors.filter(v => v.match < 80);
  const recommendedConsultants = consultants.filter(c => c.match >= 80);
  const otherConsultants = consultants.filter(c => c.match < 80);

  return (
    <div className="max-w-7xl mx-auto animate-fade-in pb-20 md:pb-0">
      <button 
        onClick={onBack} 
        className="flex items-center gap-2 mb-6 text-sm font-medium text-indigo-600 hover:text-indigo-700 hover:underline transition-colors"
      >
        <ArrowLeft size={16} />Back to Matching Mode
      </button>
      
      <PageHeader 
        title="Preview & Dispatch" 
        subtitle="Review your selected vendors and consultants before sending invitations" 
      />

      <ProgressBar currentStep={5} totalSteps={5} />

      {/* Summary Card */}
      <SummaryCard
        vendorCount={vendorCount}
        consultantCount={consultantCount}
        totalSelected={totalSelected}
      />

      {/* Vendors Section */}
      <div className="mb-12">
        <div className="flex items-center justify-between mb-6">
          <div>
            <h2 className="text-xl font-semibold text-slate-900 mb-1">Vendors</h2>
            <p className="text-slate-600">Select vendors for your project</p>
          </div>
          <div className="text-sm text-slate-500">
            {vendorCount} of {vendors.length} selected
          </div>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {recommendedVendors.map((vendor) => (
            <VendorCard
              key={vendor.id}
              vendor={vendor}
              onToggle={toggleVendor}
            />
          ))}
        </div>

        {otherVendors.length > 0 && (
          <div className="mt-8">
            <h3 className="text-lg font-medium text-slate-900 mb-4">Other Options</h3>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {otherVendors.map((vendor) => (
                <VendorCard
                  key={vendor.id}
                  vendor={vendor}
                  onToggle={toggleVendor}
                />
              ))}
            </div>
          </div>
        )}
      </div>

      {/* Consultants Section */}
      <div className="mb-12">
        <div className="flex items-center justify-between mb-6">
          <div>
            <h2 className="text-xl font-semibold text-slate-900 mb-1">Consultants</h2>
            <p className="text-slate-600">Select consultants for advisory support</p>
          </div>
          <div className="text-sm text-slate-500">
            {consultantCount} of {consultants.length} selected
          </div>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {recommendedConsultants.map((consultant) => (
            <ConsultantCard
              key={consultant.id}
              consultant={consultant}
              onToggle={toggleConsultant}
            />
          ))}
        </div>

        {otherConsultants.length > 0 && (
          <div className="mt-8">
            <h3 className="text-lg font-medium text-slate-900 mb-4">Other Options</h3>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {otherConsultants.map((consultant) => (
                <ConsultantCard
                  key={consultant.id}
                  consultant={consultant}
                  onToggle={toggleConsultant}
                />
              ))}
            </div>
          </div>
        )}
      </div>

      {/* Footer Actions */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.4, delay: 0.2 }}
        className="bg-white border-t border-slate-200 p-6 rounded-t-2xl"
      >
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-4">
            <VisibilitySettings
              visibility={visibility}
              onVisibilityChange={setVisibility}
            />
            {!canDispatch && (
              <div className="text-sm text-amber-600">
                Select at least 1 vendor to proceed
              </div>
            )}
          </div>
          
          <div className="flex items-center gap-4">
            <motion.button
              onClick={onBack}
              className="px-6 py-2 text-slate-600 hover:text-slate-800 transition-colors"
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
            >
              Back
            </motion.button>
            
            <motion.button
              onClick={onNext}
              disabled={!canDispatch}
              className={`px-8 py-3 rounded-lg font-medium transition-all duration-200 flex items-center gap-2 ${
                canDispatch
                  ? 'bg-indigo-600 text-white hover:bg-indigo-700 shadow-lg hover:shadow-xl'
                  : 'bg-slate-100 text-slate-400 cursor-not-allowed'
              }`}
              whileHover={canDispatch ? { scale: 1.02 } : {}}
              whileTap={canDispatch ? { scale: 0.98 } : {}}
            >
              Send Invitations
              <ArrowRight size={18} />
            </motion.button>
          </div>
        </div>
      </motion.div>
    </div>
  );
};
[Step5_PreviewDispatch.tsx: end]

File: features/opportunityBuilder/sme/Step6_LiveMatchingDashboard.tsx
[Step6_LiveMatchingDashboard.tsx: start]
import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { 
  ArrowLeft, 
  RefreshCw, 
  Download,
  Clock,
  CheckCircle,
  AlertCircle
} from 'lucide-react';
import { PageHeader } from '../../../components/common/PageHeader';
import { LiveResponseCard } from '../../../components/matching/LiveResponseCard';
import { IndicativeSubmissionModal } from '../../../components/matching/IndicativeSubmissionModal';
import { useMatchingStore } from '../../../state/matching/store';
import { LeadResponse } from '../../../state/matching/types';
import { Step6CompareDrawer } from './CompareDrawer';
import { Card } from '../../../components/common/Card';
import { toast } from 'react-hot-toast'; // If you use a toast lib
import { useMemo } from 'react';

interface Step6_LiveMatchingDashboardProps {
  onBack: () => void;
}

const ProgressBar: React.FC<{ currentStep: number; totalSteps: number }> = ({ currentStep, totalSteps }) => (
  <div className="mb-8">
    <div className="flex items-center justify-between mb-2">
      <span className="text-sm font-medium text-slate-600">Step {currentStep} of {totalSteps}</span>
      <span className="text-sm text-slate-500">Live Matching Dashboard</span>
    </div>
    <div className="w-full bg-slate-200 rounded-full h-2">
      <div 
        className="bg-gradient-to-r from-green-500 to-emerald-500 h-2 rounded-full transition-all duration-500 ease-out"
        style={{ width: `${(currentStep / totalSteps) * 100}%` }}
      />
    </div>
  </div>
);

const ResponseWindowHeader: React.FC<{
  totalSent: number;
  accepted: number;
  pending: number;
  hoursRemaining: number;
  isUrgent: boolean;
}> = ({ totalSent, accepted, pending, hoursRemaining, isUrgent }) => (
  <motion.div
    initial={{ opacity: 0, y: 20 }}
    animate={{ opacity: 1, y: 0 }}
    className="bg-white border border-slate-200 rounded-xl p-6 mb-8"
  >
    <div className="flex items-center justify-between mb-4">
      <div className="flex items-center gap-3">
        <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${
          isUrgent ? 'bg-red-100' : 'bg-blue-100'
        }`}>
          <Clock size={20} className={isUrgent ? 'text-red-600' : 'text-blue-600'} />
        </div>
        <div>
          <h2 className="text-lg font-semibold text-slate-900">Response Window</h2>
          <p className="text-sm text-slate-600">
            {isUrgent ? 'Responses closing soon' : 'Responses still being accepted'}
          </p>
        </div>
      </div>
      
      <div className="text-right">
        <div className={`text-2xl font-bold ${
          isUrgent ? 'text-red-600' : 'text-blue-600'
        }`}>
          {hoursRemaining}h left
        </div>
        <div className="text-sm text-slate-500">remaining</div>
      </div>
    </div>

    {/* Progress Summary */}
    <div className="bg-slate-50 rounded-lg p-4">
      <div className="flex items-center justify-between text-sm">
        <span className="text-slate-600">
          {accepted} of {totalSent} responses received
        </span>
        <span className="text-slate-500">
          {pending} pending
        </span>
      </div>
      
      {/* Progress Bar */}
      <div className="w-full bg-slate-200 rounded-full h-2 mt-3">
        <motion.div
          className="bg-gradient-to-r from-green-500 to-emerald-500 h-2 rounded-full"
          initial={{ width: 0 }}
          animate={{ width: `${(accepted / totalSent) * 100}%` }}
          transition={{ duration: 1, ease: "easeOut" }}
        />
      </div>
    </div>
  </motion.div>
);

const LiveSyncIndicator: React.FC<{ isRefreshing: boolean }> = ({ isRefreshing }) => (
  <motion.div
    initial={{ opacity: 0 }}
    animate={{ opacity: 1 }}
    className="flex items-center gap-2 text-sm text-slate-500 mb-6"
  >
    <motion.div
      animate={{ rotate: isRefreshing ? 360 : 0 }}
      transition={{ duration: 1, repeat: isRefreshing ? Infinity : 0, ease: "linear" }}
    >
      <RefreshCw size={14} />
    </motion.div>
    <span>Live syncingâ€¦</span>
    <div className="w-1 h-1 bg-green-500 rounded-full animate-pulse" />
  </motion.div>
);

const ResponseFeed: React.FC<{
  responses: LeadResponse[];
  onViewSubmission: (response: LeadResponse) => void;
  onCompareSelect: (response: LeadResponse) => void;
  compareSelectedIds: string[];
  compareLimitReached: boolean;
}> = ({ responses, onViewSubmission, onCompareSelect, compareSelectedIds, compareLimitReached }) => {
  // Only show accepted and pending responses
  const activeResponses = responses.filter(r => r.status === 'ACCEPTED' || r.status === 'PENDING');
  
  if (activeResponses.length === 0) {
    return (
      <motion.div
        initial={{ opacity: 0, scale: 0.95 }}
        animate={{ opacity: 1, scale: 1 }}
        className="text-center py-12"
      >
        <div className="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <Clock size={24} className="text-slate-400" />
        </div>
        <h3 className="text-lg font-semibold text-slate-900 mb-2">
          Awaiting Responses
        </h3>
        <p className="text-slate-600">
          Responses will appear here as vendors and consultants reply to your invitations.
        </p>
      </motion.div>
    );
  }

  return (
    <div className="space-y-4">
      {activeResponses.map((response, index) => (
        <motion.div
          key={response.id}
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: index * 0.1 }}
        >
          <LiveResponseCard
            response={response}
            onViewSubmission={onViewSubmission}
            onCompareSelect={onCompareSelect}
            isCompareSelected={compareSelectedIds.includes(response.id)}
            isCompareDisabled={compareLimitReached && !compareSelectedIds.includes(response.id)}
          />
        </motion.div>
      ))}
    </div>
  );
};

const FooterSummary: React.FC<{
  accepted: number;
  totalSent: number;
  pending: number;
}> = ({ accepted, totalSent, pending }) => (
  <motion.div
    initial={{ opacity: 0, y: 20 }}
    animate={{ opacity: 1, y: 0 }}
    className="bg-slate-50 border border-slate-200 rounded-xl p-6 mt-8"
  >
    <div className="flex items-center justify-between">
      <div className="flex items-center gap-3">
        <div className="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
          <CheckCircle size={16} className="text-green-600" />
        </div>
        <div>
          <h3 className="font-semibold text-slate-900">
            {accepted} of {totalSent} responses received
          </h3>
          <p className="text-sm text-slate-600">
            {pending > 0 
              ? `SmartGrant will notify you when all ${pending} remaining responses are in.`
              : 'All responses have been received.'
            }
          </p>
        </div>
      </div>
      
      <motion.button
        className="p-2 text-slate-400 hover:text-slate-600 transition-colors"
        whileHover={{ scale: 1.1 }}
        whileTap={{ scale: 0.9 }}
        title="Export results"
      >
        <Download size={18} />
      </motion.button>
    </div>
  </motion.div>
);

export const Step6_LiveMatchingDashboard: React.FC<Step6_LiveMatchingDashboardProps> = ({ onBack }) => {
  const {
    responses,
    stats,
    responseWindow,
    selectedResponse,
    setSelectedResponse,
    refreshData
  } = useMatchingStore();

  const [isRefreshing, setIsRefreshing] = useState(false);
  const [selectedResponses, setSelectedResponses] = useState<LeadResponse[]>([]);
  const [isCompareDrawerOpen, setIsCompareDrawerOpen] = useState(false);
  const MAX_COMPARE = 2;

  // Handler to toggle selection
  const handleToggleCompareSelect = (response: LeadResponse) => {
    const isSelected = selectedResponses.some(r => r.id === response.id);
    if (isSelected) {
      setSelectedResponses(prev => prev.filter(r => r.id !== response.id));
    } else if (selectedResponses.length < MAX_COMPARE) {
      setSelectedResponses(prev => [...prev, response]);
    } else {
      toast && toast('Compare 2 at a time for clarity.', { icon: 'âš¡ï¸' });
    }
  };
  // Clear selected
  const handleClearCompare = () => setSelectedResponses([]);
  // Open compare drawer
  const handleOpenCompare = () => setIsCompareDrawerOpen(true);
  const handleCloseCompare = () => setIsCompareDrawerOpen(false);

  // Helpers for disable logic
  const compareLimitReached = selectedResponses.length >= MAX_COMPARE;
  const compareBarVisible = selectedResponses.length > 0;

  const handleViewSubmission = (response: LeadResponse) => {
    setSelectedResponse(response);
  };

  const handleCloseModal = () => {
    setSelectedResponse(null);
  };

  const handleRefresh = async () => {
    setIsRefreshing(true);
    await refreshData();
    setTimeout(() => setIsRefreshing(false), 1000);
  };

  // Auto-refresh every 30 seconds
  useEffect(() => {
    const interval = setInterval(() => {
      handleRefresh();
    }, 30000);

    return () => clearInterval(interval);
  }, []);

  const accepted = stats.accepted;
  const pending = stats.pending;
  const totalSent = stats.totalSent;
  const hoursRemaining = responseWindow.hoursRemaining;
  const isUrgent = hoursRemaining <= 6;

  return (
    <div className="max-w-4xl mx-auto animate-fade-in pb-20 md:pb-0">
      <button 
        onClick={onBack} 
        className="flex items-center gap-2 mb-6 text-sm font-medium text-indigo-600 hover:text-indigo-700 hover:underline transition-colors"
      >
        <ArrowLeft size={16} />Back to Preview & Dispatch
      </button>
      
      <PageHeader 
        title="Live Matching Dashboard" 
        subtitle="Monitor responses from vendors and consultants in real-time" 
      />

      <ProgressBar currentStep={6} totalSteps={6} />

      {/* Response Window Header */}
      <ResponseWindowHeader
        totalSent={totalSent}
        accepted={accepted}
        pending={pending}
        hoursRemaining={hoursRemaining}
        isUrgent={isUrgent}
      />

      {/* Live Sync Indicator */}
      <LiveSyncIndicator isRefreshing={isRefreshing} />

      {/* AI Assist Note */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        className="text-center text-sm text-slate-500 mb-6"
      >
        Responses are auto-ranked for quality and speed.
      </motion.div>

      {/* Response Feed */}
      <div className="mb-8">
        <h2 className="text-lg font-semibold text-slate-900 mb-4">
          Active Responses
        </h2>
        <ResponseFeed
          responses={responses}
          onViewSubmission={handleViewSubmission}
          onCompareSelect={handleToggleCompareSelect}
          compareSelectedIds={selectedResponses.map(r => r.id)}
          compareLimitReached={compareLimitReached}
        />
      </div>

      {/* Floating Compare Bar */}
      {compareBarVisible && (
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          exit={{ opacity: 0, y: 20 }}
          className="fixed bottom-6 left-1/2 transform -translate-x-1/2 z-30"
        >
          <Card className="bg-white shadow-xl border border-slate-200 px-6 py-4 animate-fadeUp">
            <div className="flex items-center gap-6">
              <div className="flex items-center gap-2">
                <div className="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                  <span className="text-sm font-bold text-blue-600">{selectedResponses.length}</span>
                </div>
                <span className="text-sm font-medium text-slate-700">
                  Compare selected response{selectedResponses.length > 1 ? 's' : ''}
                </span>
              </div>
              <div className="flex gap-2">
                <button
                  onClick={handleOpenCompare}
                  className="bg-blue-600 text-white font-medium px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm"
                  disabled={selectedResponses.length < 1}
                >
                  Compare
                </button>
                <button
                  onClick={handleClearCompare}
                  className="bg-slate-100 text-slate-700 font-medium px-4 py-2 rounded-lg hover:bg-slate-200 transition-colors text-sm"
                >
                  Clear
                </button>
              </div>
            </div>
          </Card>
        </motion.div>
      )}

      {/* Compare Drawer/Modal */}
      <Step6CompareDrawer
        isOpen={isCompareDrawerOpen}
        onClose={handleCloseCompare}
        selected={selectedResponses}
        onProceed={() => {
          // Optionally mark as "Ready for clarification"
          setIsCompareDrawerOpen(false);
          handleClearCompare();
          toast && toast.success('Marked ready for clarification!');
        }}
      />

      {/* Indicative Submission Modal */}
      <IndicativeSubmissionModal
        response={selectedResponse}
        onClose={handleCloseModal}
      />

      {/* Footer Summary */}
      <FooterSummary
        accepted={accepted}
        totalSent={totalSent}
        pending={pending}
      />
    </div>
  );
};
[Step6_LiveMatchingDashboard.tsx: end]

File: lib/utils.ts
[utils.ts: start]
import { type ClassValue, clsx } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
[utils.ts: end]

File: main.tsx
[main.tsx: start]
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.tsx'
import './styles/index.css'

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)
[main.tsx: end]

File: mocks/api.ts
[api.ts: start]
import { useAppStore } from '../state/store';
import { ReqDoc, Lead, Proposal, Quotation } from '../state/types';

// Simulate API latency
const delay = (ms: number) => new Promise(resolve => setTimeout(resolve, ms));

export const mockApi = {
  // ReqDoc operations
  createReqDoc: async (reqDocData: Omit<ReqDoc, 'id' | 'createdAt' | 'updatedAt'>) => {
    await delay(500);
    return useAppStore.getState().createReqDoc(reqDocData);
  },

  selectTRHLS: async (reqDocId: string, trhlsIds: string[]) => {
    await delay(300);
    useAppStore.getState().selectTRHLS(reqDocId, trhlsIds);
  },

  setVisibility: async (reqDocId: string, visibility: 'PRIVATE' | 'LIMITED' | 'PUBLIC') => {
    await delay(200);
    useAppStore.getState().setVisibility(reqDocId, visibility);
  },

  setMatchingMode: async (reqDocId: string, mode: 'SME_SELF_MANAGED' | 'CONSULTANT_MANAGED') => {
    await delay(200);
    useAppStore.getState().setMatchingMode(reqDocId, mode);
  },

  seedMatching: async (reqDocId: string) => {
    await delay(1000);
    useAppStore.getState().seedMatchingForReqDoc(reqDocId);
  },

  // Lead operations
  acceptLead: async (leadId: string, userId: string) => {
    await delay(800);
    useAppStore.getState().acceptLead(leadId, userId);
  },

  // Proposal/Quotation operations
  submitProposal: async (proposalData: Omit<Proposal, 'id' | 'createdAt'>) => {
    await delay(600);
    return useAppStore.getState().submitProposal(proposalData);
  },

  submitQuotation: async (quotationData: Omit<Quotation, 'id' | 'createdAt'>) => {
    await delay(600);
    return useAppStore.getState().submitQuotation(quotationData);
  },

  // Award operations
  finalizeIndicatives: async (reqDocId: string) => {
    await delay(400);
    useAppStore.getState().finalizeIndicatives(reqDocId);
  },

  awardVendor: async (reqDocId: string, vendorUserId: string) => {
    await delay(500);
    useAppStore.getState().awardVendor(reqDocId, vendorUserId);
  },

  awardConsultant: async (reqDocId: string, consultantUserId: string) => {
    await delay(500);
    useAppStore.getState().awardConsultant(reqDocId, consultantUserId);
  }
};
[api.ts: end]

File: mocks/matching.seeds.ts
[matching.seeds.ts: start]
import { LeadResponse, MatchingStats, ResponseWindow } from '../state/matching/types';

export const MOCK_LEAD_RESPONSES: LeadResponse[] = [
  { // 1. Acme ERP (ACCEPTED)
    id: 'response-1', vendorId: 'acme-erp', type: 'VENDOR', name: 'Acme ERP', logo: '/assets/vendors/acme-erp.svg', status: 'ACCEPTED', qualificationScore: 92, responseTime: 2.5, submittedAt: new Date(Date.now() - 2 * 60 * 60 * 1000), expiresAt: new Date(Date.now() + 22 * 60 * 60 * 1000),
    indicativeSubmission: { id: 'sub-1', title: 'Cloud ERP Proposal', summary: 'Cloud ERP for F&B. PSG grant ready.', estimatedCost: [20000, 25000], timeline: [3, 4], keyFeatures: ['PSG Pre-approved','Inventory Mgmt','24/7 Support','Training'], nextSteps: ['Requirements','Configuration','UAT','Go-live'], grantTag: 'PSG', tags: ['Fast Deployment','Budget Fit'], breakdown: [{item:'Licence',costBand:[10000,12000]},{item:'Setup',costBand:[7000,8000]},{item:'Support',costBand:[3000,4000]}], grantEligible: true, support: '6-month warranty', addOns: ['API','Custom Reports'] }
  },
  { // 2. Nova Cloud (ACCEPTED)
    id: 'response-2', vendorId: 'nova-cloud', type: 'VENDOR', name: 'Nova Cloud', logo: '/assets/vendors/nova-cloud.svg', status: 'ACCEPTED', qualificationScore: 88, responseTime: 1.4, submittedAt: new Date(Date.now() - 3 * 60 * 60 * 1000), expiresAt: new Date(Date.now() + 20 * 60 * 60 * 1000),
    indicativeSubmission: { id: 'sub-2', title: 'Digital Marketing Platform', summary: 'Full-funnel marketing, analytics and PSG grant.', estimatedCost: [15000, 20000], timeline: [2, 3], keyFeatures: ['Quick Setup','Analytics','PSG Approved','24/7 Support'], nextSteps: ['Kickoff','Sandbox','Rollout'], grantTag: 'PSG', tags: ['Quick Start','Cloud'], breakdown: [{item:'Platform',costBand:[9000,13000]},{item:'Service',costBand:[6000,7000]}], grantEligible: true, support:'1-year support', addOns: ['Mobile Access'] }
  },
  { // 3. TechFlow Systems (PENDING)
    id: 'response-3', vendorId: 'techflow-systems', type: 'VENDOR', name: 'TechFlow Systems', logo: '/assets/vendors/techflow.svg', status: 'PENDING', qualificationScore: 77, expiresAt: new Date(Date.now() + 16 * 60 * 60 * 1000) 
  },
  { // 4. DataWise Analytics (Optional - can be EXPIRED)
    id: 'response-4', vendorId: 'datawise-analytics', type: 'VENDOR', name: 'DataWise Analytics', logo: '/assets/vendors/datawise.svg', status: 'EXPIRED', qualificationScore: 65, expiresAt: new Date(Date.now() - 2 * 60 * 60 * 1000)
  },
  { // 5. CloudScale Solutions (Optional)
    id: 'response-5', vendorId: 'cloudscale-solutions', type: 'VENDOR', name: 'CloudScale Solutions', logo: '/assets/vendors/cloudscale.svg', status: 'EXPIRED', qualificationScore: 71, expiresAt: new Date(Date.now() - 5 * 60 * 60 * 1000)
  },
  // Consultants:
  { // 6. Carter Advisory (ACCEPTED)
    id: 'response-6', consultantId: 'carter-advisory', type: 'CONSULTANT', name: 'Carter Advisory', logo: '/assets/consultants/carter.svg', status: 'ACCEPTED', qualificationScore: 95, responseTime: 1.2, submittedAt: new Date(Date.now() - 1.2 * 60 * 60 * 1000), expiresAt: new Date(Date.now() + 22 * 60 * 60 * 1000),
    indicativeSubmission: { id: 'sub-3', title: 'EDG Grant Plan', summary:'Grant application & strategy for SME digital transformation.', estimatedCost:[8000,12000], timeline:[2,3], keyFeatures:['EDG Ready','Consultant Team','Compliance Support','Claims Handling'], nextSteps:['Consultation','Doc Review','Submission'], grantTag:'EDG', tags:['High Success Rate'], understanding:'Increase online customers through digital strategy.', approachPhases:[{label:'Strategy',weeks:'1-2 wks'},{label:'Implementation',weeks:'4-6 wks'},{label:'Claims',weeks:'2 wks'}], team:[{name:'Alice Carter',role:'Lead'},{name:'Ben Lee',role:'Co-consultant'}], assumptions:['SME provides recent P&L'], breakdown:[], support:'Advisory till grant award.'}
  },
  { // 7. Strategic Insights (ACCEPTED)
    id: 'response-7', consultantId: 'strategic-insights', type: 'CONSULTANT', name: 'Strategic Insights', logo: '/assets/consultants/strategic.svg', status: 'ACCEPTED', qualificationScore: 88, responseTime: 2.0, submittedAt: new Date(Date.now() - 3 * 60 * 60 * 1000), expiresAt: new Date(Date.now() + 19 * 60 * 60 * 1000),
    indicativeSubmission: { id:'sub-4', title:'Advisory Proposal', summary:'Process redesign and grant planning.', estimatedCost:[9000,13000], timeline:[2,4], keyFeatures:['Grant Specialist','Tech Advisory','Quick Start'], nextSteps:['Strategy Call','Planning','Dok Prep'], grantTag:'EDG', tags:['Process Expert'], understanding:'Increase digital leads via SEO.', approachPhases:[{label:'Plan',weeks:'1 wk'},{label:'Implement',weeks:'2-3 wks'}], team:[{name:'Sara Tan',role:'Lead'},{name:'Ken Wong',role:'Analyst'}], assumptions:['Access to prior grant docs'], breakdown:[], support:'Full submission support.'}
  },
  { // 8. Aegis Partners (PENDING)
    id: 'response-8', consultantId: 'aegis-partners', type: 'CONSULTANT', name: 'Aegis Partners', logo: '/assets/consultants/aegis.svg', status: 'PENDING', qualificationScore: 82, expiresAt: new Date(Date.now() + 17 * 60 * 60 * 1000) 
  },
  { // 9. InsightWorks Consulting (New, PENDING)
    id: 'response-9', consultantId: 'insightworks-consulting', type: 'CONSULTANT', name: 'InsightWorks Consulting', logo: '/assets/consultants/insightworks.svg', status: 'PENDING', qualificationScore: 80, expiresAt: new Date(Date.now() + 16 * 60 * 60 * 1000) 
  },
];

export const MOCK_MATCHING_STATS: MatchingStats = {
  totalSent: 6,
  accepted: 2,
  declined: 1,
  pending: 2,
  expired: 1,
  responseRate: 50, // (accepted + declined) / totalSent * 100
  avgResponseTime: 2.7
};

export const MOCK_RESPONSE_WINDOW: ResponseWindow = {
  closesAt: new Date(Date.now() + 20 * 60 * 60 * 1000), // 20 hours from now
  hoursRemaining: 20,
  isUrgent: false
};
[matching.seeds.ts: end]

File: mocks/preview.seeds.ts
[preview.seeds.ts: start]
import { Vendor, Consultant } from '../state/preview/types';

export const MOCK_VENDORS: Vendor[] = [
  {
    id: 'acme-erp',
    name: 'Acme ERP',
    logo: '/assets/vendors/acme-erp.svg',
    match: 92,
    grantTag: 'PSG',
    sector: 'F&B',
    product: 'Cloud ERP Suite',
    costRange: [20000, 25000],
    duration: [3, 4],
    reason: 'Your goal = Process Automation (F&B)',
    tags: ['Fast Deployment', 'Budget Fit', 'Local Support'],
    selected: true
  },
  {
    id: 'nova-cloud',
    name: 'Nova Cloud',
    logo: '/assets/vendors/nova-cloud.svg',
    match: 88,
    grantTag: 'PSG',
    sector: 'Retail',
    product: 'Digital Marketing Platform',
    costRange: [15000, 20000],
    duration: [2, 3],
    reason: 'Matches your digital transformation goals',
    tags: ['Quick Setup', 'PSG Approved', '24/7 Support'],
    selected: true
  },
  {
    id: 'techflow-systems',
    name: 'TechFlow Systems',
    logo: '/assets/vendors/techflow.svg',
    match: 77,
    grantTag: 'EDG',
    sector: 'Manufacturing',
    product: 'IoT Integration Suite',
    costRange: [30000, 40000],
    duration: [4, 6],
    reason: 'Advanced automation for manufacturing',
    tags: ['Enterprise Grade', 'EDG Eligible', 'Custom Solutions'],
    selected: false
  },
  {
    id: 'datawise-analytics',
    name: 'DataWise Analytics',
    logo: '/assets/vendors/datawise.svg',
    match: 65,
    grantTag: 'NON_GRANT',
    sector: 'Services',
    product: 'Business Intelligence Platform',
    costRange: [10000, 15000],
    duration: [2, 3],
    reason: 'Data analytics for business insights',
    tags: ['Cost Effective', 'Easy Integration', 'Self-Service'],
    selected: false
  },
  {
    id: 'cloudscale-solutions',
    name: 'CloudScale Solutions',
    logo: '/assets/vendors/cloudscale.svg',
    match: 71,
    grantTag: 'PSG',
    sector: 'F&B',
    product: 'Inventory Management System',
    costRange: [12000, 18000],
    duration: [2, 4],
    reason: 'F&B-specific inventory optimization',
    tags: ['Industry Specific', 'PSG Ready', 'Quick ROI'],
    selected: false
  }
];

export const MOCK_CONSULTANTS: Consultant[] = [
  {
    id: 'carter-advisory',
    name: 'Carter Advisory',
    logo: '/assets/consultants/carter.svg',
    match: 88,
    specialty: 'EDG Specialist',
    experience: '3 yrs F&B projects',
    successRate: 92,
    coreFocus: ['EDG Grant Planning', 'Process Redesign'],
    rating: 4.8,
    avgTurnaround: 14,
    selected: true
  },
  {
    id: 'aegis-partners',
    name: 'Aegis Partners',
    logo: '/assets/consultants/aegis.svg',
    match: 75,
    specialty: 'PSG Expert',
    experience: '5 yrs Retail sector',
    successRate: 87,
    coreFocus: ['Digital Transformation', 'Vendor Selection'],
    rating: 4.6,
    avgTurnaround: 10,
    selected: false
  },
  {
    id: 'strategic-insights',
    name: 'Strategic Insights',
    logo: '/assets/consultants/strategic.svg',
    match: 69,
    specialty: 'General Business',
    experience: '8 yrs cross-industry',
    successRate: 78,
    coreFocus: ['Business Strategy', 'Technology Adoption'],
    rating: 4.3,
    avgTurnaround: 21,
    selected: false
  }
];
[preview.seeds.ts: end]

File: mocks/seeds.trhls.ts
[seeds.trhls.ts: start]
import { TRHLSOption } from "../state/types";

export const TRHLS_FOR_MARKETING_VISIBILITY: TRHLSOption[] = [
  {
    id: "psg-digital-ads-suite",
    name: "PSG Digital Ads & CRM Suite",
    grantTag: "PSG",
    whyFit: "The perfect launchpad for SMEs wanting not just more leads, but a hands-off, unified approach across digital channels. Weâ€™ll bring advanced yet easy-to-use tools for ads, CRM, and analyticsâ€”all PSG-grant optimizedâ€”so you focus on growth while we handle the campaign science.",
    estCostBand: [20000, 25000],
    estDurationMonths: [3, 4],
    businessImpact: {
      revenueLiftPct: 10,
      leadDeltaPerMonth: 80,
      cacChangePct: -12,
      timeToFirstLeadWeeks: 3
    },
    grantWhy: "PSG supports adoption of pre-approved digital marketing and CRM systems for productivity and lead generation, and we help you maximize these funds at every step.",
    rationaleSignals: ["Industry fit (F&B/Retail)", "Budget within PSG range", "Proven vendors available"]
  },
  {
    id: "edg-market-expansion-sea",
    name: "EDG Market Expansion (SEA)",
    grantTag: "EDG",
    whyFit: "Supports overseas marketing strategy for regional customer growth.",
    estCostBand: [40000, 60000],
    estDurationMonths: [6, 8],
    businessImpact: {
      revenueLiftPct: 15,
      leadDeltaPerMonth: 100,
      cacChangePct: -8,
      timeToFirstLeadWeeks: 6
    },
    grantWhy: "EDG funds market access projects that build new customer pipelines across SEA.",
    rationaleSignals: ["Export ambition detected", "Medium complexity project", "Consultant-led implementation"]
  },
  {
    id: "edg-brand-refresh",
    name: "EDG Brand Revamp & Content Campaign",
    grantTag: "EDG",
    whyFit: "Improves brand positioning, storytelling and content funnel conversion.",
    estCostBand: [30000, 45000],
    estDurationMonths: [4, 6],
    businessImpact: {
      revenueLiftPct: 9,
      leadDeltaPerMonth: 50,
      cacChangePct: -10,
      timeToFirstLeadWeeks: 5
    },
    grantWhy: "EDG supports branding and content capability building projects tied to growth outcomes.",
    rationaleSignals: ["Creative capability gap", "Good fit for content-driven industries", "Consultant-guided project"]
  },
  {
    id: "ads-sprint-nongrant",
    name: "High Velocity Ads Sprint (Non-Grant)",
    grantTag: "NON_GRANT",
    whyFit: "Quick-start campaign to validate lead generation before full grant execution.",
    estCostBand: [12000, 18000],
    estDurationMonths: [1, 2],
    businessImpact: {
      revenueLiftPct: 5,
      leadDeltaPerMonth: 70,
      cacChangePct: -5,
      timeToFirstLeadWeeks: 2
    },
    rationaleSignals: ["Fast deployment", "Low commitment", "Useful for ROI benchmarking"]
  },
  {
    id: "cro-web-refresh-nongrant",
    name: "CRO + Website UX Refresh (Non-Grant)",
    grantTag: "NON_GRANT",
    whyFit: "Revamps your website UX and analytics to improve conversion rate.",
    estCostBand: [15000, 20000],
    estDurationMonths: [2, 3],
    businessImpact: {
      revenueLiftPct: 6,
      leadDeltaPerMonth: 30,
      cacChangePct: -10,
      timeToFirstLeadWeeks: 4
    },
    rationaleSignals: ["Improves conversion path", "Fast measurable impact", "Pairs with grant-funded MarTech"]
  }
];
[seeds.trhls.ts: end]

File: mocks/seeds.ts
[seeds.ts: start]
import { Company, User, TRHLSOption, CreditWallet } from '../state/types';

export const mockCompanies: Company[] = [
  {
    id: 'company-1',
    name: 'Innovate Pte. Ltd.',
    jurisdiction: 'SG',
    industry: 'Food & Beverage',
    revenueBand: 'S$1M - S$5M',
    headcountBand: '10-50 employees'
  }
];

export const mockUsers: User[] = [
  {
    id: 'user-sme-1',
    name: 'Innovate Pte. Ltd.',
    persona: 'SME',
    companyId: 'company-1',
    credits: 12
  },
  {
    id: 'user-vendor-1',
    name: 'Acme ERP',
    persona: 'VENDOR',
    companyId: 'company-1', // Same company for simplicity
    credits: 5
  },
  {
    id: 'user-vendor-2',
    name: 'Nova Cloud',
    persona: 'VENDOR',
    companyId: 'company-1',
    credits: 8
  },
  {
    id: 'user-consultant-1',
    name: 'Carter Advisory',
    persona: 'CONSULTANT',
    companyId: 'company-1',
    credits: 12
  },
  {
    id: 'user-consultant-2',
    name: 'Aegis Partners',
    persona: 'CONSULTANT',
    companyId: 'company-1',
    credits: 10
  }
];

export const mockTRHLS: TRHLSOption[] = [
  {
    id: 'trhls-1',
    name: 'Cloud ERP Implementation',
    grantTag: 'PSG',
    whyFit: 'Matches your F&B industry & budget for pre-approved systems.',
    estCostBand: [20000, 25000],
    estDurationMonths: [3, 4],
    businessImpact: {
      revenueLiftPct: 15,
      costSavePct: 25,
      opsSpeedupPct: 40
    },
    grantWhy: 'Pre-approved under PSG for productivity solutions in F&B sector.'
  },
  {
    id: 'trhls-2',
    name: 'Targeted Digital Marketing Campaign',
    grantTag: 'EDG',
    whyFit: 'Ideal for your goal to expand into Malaysia (Market Access).',
    estCostBand: [40000, 50000],
    estDurationMonths: [6, 8],
    businessImpact: {
      revenueLiftPct: 35,
      costSavePct: 10,
      opsSpeedupPct: 20
    },
    grantWhy: 'Eligible for EDG support for overseas market expansion initiatives.'
  },
  {
    id: 'trhls-3',
    name: 'Custom Website Development',
    grantTag: 'NON_GRANT',
    whyFit: 'Full custom control, but not aligned with grant support.',
    estCostBand: [15000, 20000],
    estDurationMonths: [2, 3],
    businessImpact: {
      revenueLiftPct: 20,
      costSavePct: 5,
      opsSpeedupPct: 15
    },
    grantWhy: 'Custom development without pre-approved templates typically does not qualify for PSG.'
  }
];

export const mockWallets: CreditWallet[] = [
  { userId: 'user-sme-1', balance: 12 },
  { userId: 'user-vendor-1', balance: 5 },
  { userId: 'user-vendor-2', balance: 8 },
  { userId: 'user-consultant-1', balance: 12 },
  { userId: 'user-consultant-2', balance: 10 }
];
[seeds.ts: end]

File: state/coach/coachConfig.ts
[coachConfig.ts: start]
export const COACH_CONFIG = {
  keywordMap: [
    { keys: ["customer", "customers", "sales", "marketing", "leads"], domain: "GROWTH" },
    { keys: ["inventory", "process", "system", "workflow"], domain: "OPERATIONS" },
    { keys: ["staff", "training", "hiring", "skills"], domain: "CAPABILITY" },
    { keys: ["supplier", "production", "machine", "manufacturing"], domain: "SUPPLY" }
  ],
  clarifiers: {
    GROWTH: [
      { id: "acquisition", label: "Find new customers" },
      { id: "retention",  label: "Improve retention" },
      { id: "visibility", label: "Increase online visibility" }
    ],
    // keep others for future
  },
  suggestionTemplates: {
    GROWTH: {
      coachLine: "Absolutely understood â€” let's zero in on boosting your brand's online presence and simplifying your campaign reporting.",
      text: "At its heart, your goal is to ensure your brand stands out online, attracting more customers while making campaign tracking far less of a headache. We understand youâ€™re striving for not just increased digital visibility, but also a way to see whatâ€™s working in your campaigns â€” across every platform, all in one place. Our priority is to empower your team with clearer insights and simpler reporting, freeing up your time to focus on actual growth.",
      rationale: "This approach enables a holistic match to marketing partners who not only drive lead generation, but also take pride in transparent, data-driven campaign outcomes."
    }
  },
  // Category chips to show under chat (auto from domain + clarifier)
  categoryMap: {
    GROWTH: ["Growth", "Marketing", "Digital Transformation"]
  },
  reqDocPreview: {
    problem: "Standing out online is tough, and it can be a real challenge to see which campaigns are actually making a difference. It's frustrating to pour effort (and budget) into digital channels and not get a simple, unified view of what's working.",
    goal: "Make your brand discoverable, boost your digital growth, and put streamlined, all-in-one campaign tracking in your hands â€” so you always know where your efforts are paying off.",
    domain: "Growth",
    complexity: "Low",
    industry: "F&B (example)",
    budgetBand: [25000, 50000],
    timelineMonths: [3, 6],
    grantPredictions: [
      { grant: "EDG", confidence: 0.78, reason: "Market expansion and capability building" },
      { grant: "PSG", confidence: 0.65, reason: "Adoption of digital marketing tools" }
    ],
    qualificationScore: 82
  }
} as const;
[coachConfig.ts: end]

File: state/coach/coachMachine.ts
[coachMachine.ts: start]
import { ChatMessage } from "./types";

export type CoachStage =
  | "INPUT"          // textbox only
  | "CHAT_INIT"      // after Diagnose: AI greets + asks clarifier
  | "CLARIFIER_SHOWN"
  | "SUGGESTION_SHOWN"
  | "APPLIED"        // refined text applied; categories/clarity bump
  | "PREVIEW_READY"; // enable Continue â†’ TRHLS

export interface CoachState {
  stage: CoachStage;
  input: string;
  domain?: "GROWTH" | "OPERATIONS" | "CAPABILITY" | "SUPPLY";
  clarifierId?: string;
  refinedText?: string;
  messages: ChatMessage[];
  categories: string[];
  clarity: number; // 0â€“100
}

export const initialCoachState: CoachState = {
  stage: "INPUT",
  input: "I want to increase customers for my business",
  messages: [],
  categories: [],
  clarity: 38 // low clarity for vague text
};

// naive clarity calculator for demo:
export function computeClarity({ refined }: { refined: boolean }): number {
  return refined ? 82 : 38;
}

export const coachActions = {
  diagnose(state: CoachState, domain: CoachState["domain"]): CoachState {
    const first: ChatMessage = {
      id: "m1",
      role: "AI",
      text: "It sounds like a marketing or sales growth issue. Which best fits?",
      actions: [
        { id: "acquisition", label: "Find new customers" },
        { id: "retention",  label: "Improve retention" },
        { id: "visibility", label: "Increase online visibility" }
      ]
    };
    return {
      ...state,
      stage: "CHAT_INIT",
      domain,
      messages: [first],
      categories: domain ? ["Growth"] : [],
      clarity: computeClarity({ refined: false })
    };
  },

  chooseClarifier(state: CoachState, clarifierId: string, label: string): CoachState {
    const userMsg: ChatMessage = { id: "m2", role: "SME", text: label };
    const ack: ChatMessage = {
      id: "m3",
      role: "AI",
      text: `Thanks â€” focusing on ${label.toLowerCase()}.`
    };
    const next: ChatMessage = {
      id: "m4",
      role: "AI",
      text: "Suggested improvement:\n\"We're struggling to attract new customers due to low online visibility. We want to improve our reach through digital marketing (SEO/ads) and website improvements.\"",
      actions: [
        { id: "apply", label: "Apply Suggestion" },
        { id: "back",  label: "Back to Clarifiers" }
      ]
    };
    return {
      ...state,
      stage: "SUGGESTION_SHOWN",
      clarifierId,
      messages: [...state.messages, userMsg, ack, next]
    };
  },

  backToClarifiers(state: CoachState): CoachState {
    // regenerate the first clarifier message
    const back: ChatMessage = {
      id: "m_back",
      role: "AI",
      text: "No problem. Which best fits?",
      actions: [
        { id: "acquisition", label: "Find new customers" },
        { id: "retention",  label: "Improve retention" },
        { id: "visibility", label: "Increase online visibility" }
      ]
    };
    return { ...state, stage: "CLARIFIER_SHOWN", messages: [...state.messages, back] };
  },

  applySuggestion(state: CoachState, refinedText: string, categories: string[]): CoachState {
    const applied: ChatMessage = {
      id: "m_applied",
      role: "SYSTEM",
      text: "Applied suggested improvement to your goal."
    };
    const newClarity = computeClarity({ refined: true });
    return {
      ...state,
      stage: "APPLIED",
      refinedText,
      input: refinedText,         // replace textbox content
      messages: [...state.messages, applied],
      categories,
      clarity: newClarity
    };
  },

  showPreview(state: CoachState): CoachState {
    const msg: ChatMessage = {
      id: "m_preview",
      role: "AI",
      text: "Great â€” I've normalised your input. You can proceed to recommendations next."
    };
    return { ...state, stage: "PREVIEW_READY", messages: [...state.messages, msg] };
  }
};
[coachMachine.ts: end]

File: state/coach/types.ts
[types.ts: start]
export type BubbleRole = "AI" | "SME" | "SYSTEM";

export interface ChatMessage {
  id: string;
  role: BubbleRole;
  text: string;
  actions?: { id: string; label: string }[]; // e.g., clarifier options, Apply Suggestion
}
[types.ts: end]

File: state/matching/modes.ts
[modes.ts: start]
export const MATCHING_MODES = {
  CONSULTANT_MANAGED: {
    title: "Consultant-Managed",
    tagline: "Guided & hands-off â€” we orchestrate for you.",
    badges: ["Expert-Guided", "Higher Grant Success"],
    recommended: true,
    roles: [
      { icon: "UserCheck", label: "You Approve" },
      { icon: "ListChecks", label: "Consultant Shortlists" },
      { icon: "FileCheck2", label: "Grant Docs Ready" }
    ],
    timeline: [
      { step: "Invite Consultants", icon: "UsersRound" },
      { step: "Compare Proposals", icon: "ClipboardCheck" },
      { step: "Select Consultant", icon: "Layers" }
    ],
    metrics: {
      effort: { label: "Your Effort", value: "Low", color: "emerald" },
      alignment: { label: "Grant Fit", value: "85%", bar: 0.85 },
      speed: { label: "First Quote", value: "3â€“5 days" }
    },
    note: "Best when approvals and documentation matter.",
    outcome: "Best when approvals and documentation matter."
  },
  SME_SELF_MANAGED: {
    title: "SME Self-Managed",
    tagline: "Hands-on & flexible â€” you drive vendor picks.",
    badges: ["Full Control", "Faster First Quotes"],
    recommended: false,
    roles: [
      { icon: "Hand", label: "You Pick Vendors" },
      { icon: "Send", label: "SmartGrant Dispatches" },
      { icon: "Users", label: "Consultant Optional" }
    ],
    timeline: [
      { step: "Invite Vendors", icon: "Store" },
      { step: "Receive Quotes", icon: "Inbox" },
      { step: "Add Consultant", icon: "Heart" }
    ],
    metrics: {
      effort: { label: "Your Effort", value: "Medium", color: "amber" },
      alignment: { label: "Grant Fit", value: "65%", bar: 0.65 },
      speed: { label: "First Quote", value: "2â€“4 days" }
    },
    note: "Best when you want speed and control.",
    outcome: "Best when you want speed and control."
  }
} as const;
[modes.ts: end]

File: state/matching/recommendation.ts
[recommendation.ts: start]
import { ReqDoc } from '../types';

export const getSmartRecommendation = (reqDoc: ReqDoc | null) => {
  if (!reqDoc) {
    return {
      recommended: 'CONSULTANT_MANAGED' as const,
      reason: 'Default recommendation for guided experience.',
      bannerText: 'Recommended for your timeline and grant paperwork needs â€” structured guidance, higher approval confidence.',
      tooltipText: 'Grant submissions often need scoped plans, evidence and checklists. Consultants shorten that cycle.'
    };
  }

  const { grantRelevant, timelineMonths, complexity } = reqDoc;
  const timeline = timelineMonths[0]; // Use minimum timeline

  // Heuristics
  const isLongTimeline = timeline >= 3;
  const isHighComplexity = complexity === 'HIGH';
  const hasGrantRequirements = grantRelevant === true;

  if (hasGrantRequirements && (isLongTimeline || isHighComplexity)) {
    return {
      recommended: 'CONSULTANT_MANAGED' as const,
      reason: 'Grant requirements with longer timeline or high complexity benefit from consultant guidance.',
      bannerText: 'Recommended for your timeline and grant paperwork needs â€” structured guidance, higher approval confidence.',
      tooltipText: 'Grant submissions often need scoped plans, evidence and checklists. Consultants shorten that cycle.'
    };
  }

  if (!hasGrantRequirements || timeline <= 2) {
    return {
      recommended: 'SME_SELF_MANAGED' as const,
      reason: 'Short timeline or no grant requirements favor direct vendor approach.',
      bannerText: 'Recommended for your short timeline â€” get vendor quotes faster with full control.',
      tooltipText: 'When grants are optional or light, direct vendor shortlisting gets you quotes quicker.'
    };
  }

  // Default fallback
  return {
    recommended: 'CONSULTANT_MANAGED' as const,
    reason: 'Default recommendation for guided experience.',
    bannerText: 'Recommended for your timeline and grant paperwork needs â€” structured guidance, higher approval confidence.',
    tooltipText: 'Grant submissions often need scoped plans, evidence and checklists. Consultants shorten that cycle.'
  };
};
[recommendation.ts: end]

File: state/matching/store.ts
[store.ts: start]
import { create } from 'zustand';
import { LeadResponse, MatchingStats, ResponseWindow } from './types';
import { MOCK_LEAD_RESPONSES, MOCK_MATCHING_STATS, MOCK_RESPONSE_WINDOW } from '../../mocks/matching.seeds';

interface MatchingStore {
  responses: LeadResponse[];
  stats: MatchingStats;
  responseWindow: ResponseWindow;
  selectedResponse: LeadResponse | null;
  setSelectedResponse: (response: LeadResponse | null) => void;
  updateResponseStatus: (responseId: string, status: LeadResponse['status']) => void;
  refreshData: () => void;
}

export const useMatchingStore = create<MatchingStore>((set, get) => ({
  responses: MOCK_LEAD_RESPONSES,
  stats: MOCK_MATCHING_STATS,
  responseWindow: MOCK_RESPONSE_WINDOW,
  selectedResponse: null,

  setSelectedResponse: (response: LeadResponse | null) => {
    set({ selectedResponse: response });
  },

  updateResponseStatus: (responseId: string, status: LeadResponse['status']) => {
    set((state) => {
      const responses = state.responses.map(response =>
        response.id === responseId ? { ...response, status } : response
      );
      
      // Recalculate stats
      const accepted = responses.filter(r => r.status === 'ACCEPTED').length;
      const declined = responses.filter(r => r.status === 'DECLINED').length;
      const pending = responses.filter(r => r.status === 'PENDING').length;
      const expired = responses.filter(r => r.status === 'EXPIRED').length;
      const totalSent = responses.length;
      
      const stats: MatchingStats = {
        totalSent,
        accepted,
        declined,
        pending,
        expired,
        responseRate: totalSent > 0 ? Math.round(((accepted + declined) / totalSent) * 100) : 0,
        avgResponseTime: 2.7 // Mock value
      };

      return { responses, stats };
    });
  },

  refreshData: () => {
    // In a real app, this would fetch fresh data from the API
    set({
      responses: MOCK_LEAD_RESPONSES,
      stats: MOCK_MATCHING_STATS,
      responseWindow: MOCK_RESPONSE_WINDOW
    });
  }
}));
[store.ts: end]

File: state/matching/types.ts
[types.ts: start]
export interface LeadResponse {
  id: string;
  vendorId?: string;
  consultantId?: string;
  type: 'VENDOR' | 'CONSULTANT';
  name: string;
  logo: string;
  status: 'PENDING' | 'ACCEPTED' | 'DECLINED' | 'EXPIRED';
  qualificationScore: number;
  responseTime?: number; // hours
  submittedAt?: Date;
  expiresAt: Date;
  indicativeSubmission?: {
    id: string;
    title: string;
    summary: string;
    estimatedCost: [number, number];
    timeline: [number, number];
    keyFeatures: string[];
    nextSteps: string[];
    // New optional, structured fields for the 1-Page Confidence Snapshot
    grantTag?: 'PSG' | 'EDG' | 'NON_GRANT';
    tags?: string[]; // e.g., High Success Rate, Fast Turnaround
    understanding?: string; // consultant: paraphrase of SME goal
    approachPhases?: { label: string; weeks: string; icon?: string }[]; // consultant phases
    team?: { name: string; role: string; avatarUrl?: string }[]; // consultant team
    similarProjects?: { sector: string; result: string }[]; // consultant social proof
    assumptions?: string[]; // dependencies/assumptions list
    breakdown?: { item: string; costBand?: [number, number] }[]; // vendor items
    grantEligible?: boolean; // vendor grant applicability
    support?: string; // vendor support/warranty
    addOns?: string[]; // vendor optional add-ons
  };
}

export interface MatchingStats {
  totalSent: number;
  accepted: number;
  declined: number;
  pending: number;
  expired: number;
  responseRate: number;
  avgResponseTime: number;
}

export interface ResponseWindow {
  closesAt: Date;
  hoursRemaining: number;
  isUrgent: boolean;
}
[types.ts: end]

File: state/opportunity/uiHints.ts
[uiHints.ts: start]
import { ReqDoc } from '../types';

export const getModeHint = (reqDoc: ReqDoc | null) => {
  if (!reqDoc?.trhlsSelectedIds) {
    return { 
      recommended: 'CONSULTANT_MANAGED' as const, 
      reason: 'Default recommendation for guided experience.' 
    };
  }
  
  const hasEDG = reqDoc.trhlsSelectedIds.some(id => id.includes('edg'));
  return hasEDG
    ? { 
        recommended: 'CONSULTANT_MANAGED' as const, 
        reason: 'EDG items benefit from consultant-led planning.' 
      }
    : { 
        recommended: 'SME_SELF_MANAGED' as const, 
        reason: 'Vendor-first flow suits tool adoption (PSG / non-grant).' 
      };
};

export const MODE_COPY = {
  CONSULTANT_MANAGED: {
    value: 'Expert-guided. You approve decisions; we orchestrate.',
    youHandle: ['Approvals', 'Final selection', 'Payments'],
    weHandle: ['Vendor shortlist', 'Grant paperwork outline', 'Timeline planning'],
    badges: ['Fastest to Start', 'Higher Grant Fit', 'Lower SME Effort'],
    effort: 'Low',
    grantAlignment: 0.85,
    timeToFirstQuote: 'â‰ˆ 3â€“5 days',
    footnote: 'Consultant fees are shown transparently before award.'
  },
  SME_SELF_MANAGED: {
    value: 'You drive shortlist; we keep it structured.',
    youHandle: ['Vendor picks', 'Brief consolidation', 'Basic comparisons'],
    weHandle: ['Matching engine', 'Invitation dispatch', 'Status tracking'],
    badges: ['Full Control', 'Direct Vendor Contact'],
    effort: 'Medium',
    grantAlignment: 0.65,
    timeToFirstQuote: 'â‰ˆ 2â€“4 days',
    footnote: 'You can invite a consultant later if grants are involved.'
  }
} as const;
[uiHints.ts: end]

File: state/preview/store.ts
[store.ts: start]
import { create } from 'zustand';
import { Vendor, Consultant, PreviewState } from './types';
import { MOCK_VENDORS, MOCK_CONSULTANTS } from '../../mocks/preview.seeds';

interface PreviewStore extends PreviewState {
  toggleVendor: (id: string) => void;
  toggleConsultant: (id: string) => void;
  setVisibility: (visibility: 'PRIVATE' | 'LIMITED' | 'PUBLIC') => void;
  addVendor: (id: string) => void;
  addConsultant: (id: string) => void;
  reset: () => void;
}

export const usePreviewStore = create<PreviewStore>((set, get) => ({
  vendors: MOCK_VENDORS,
  consultants: MOCK_CONSULTANTS,
  visibility: 'LIMITED',
  totalSelected: 0,
  vendorCount: 0,
  consultantCount: 0,

  toggleVendor: (id: string) => {
    set((state) => {
      const vendors = state.vendors.map(vendor =>
        vendor.id === id ? { ...vendor, selected: !vendor.selected } : vendor
      );
      const vendorCount = vendors.filter(v => v.selected).length;
      const consultantCount = state.consultants.filter(c => c.selected).length;
      
      return {
        vendors,
        vendorCount,
        consultantCount,
        totalSelected: vendorCount + consultantCount
      };
    });
  },

  toggleConsultant: (id: string) => {
    set((state) => {
      const consultants = state.consultants.map(consultant =>
        consultant.id === id ? { ...consultant, selected: !consultant.selected } : consultant
      );
      const vendorCount = state.vendors.filter(v => v.selected).length;
      const consultantCount = consultants.filter(c => c.selected).length;
      
      return {
        consultants,
        vendorCount,
        consultantCount,
        totalSelected: vendorCount + consultantCount
      };
    });
  },

  addVendor: (id: string) => {
    set((state) => {
      const vendors = state.vendors.map(vendor =>
        vendor.id === id ? { ...vendor, selected: true } : vendor
      );
      const vendorCount = vendors.filter(v => v.selected).length;
      const consultantCount = state.consultants.filter(c => c.selected).length;
      
      return {
        vendors,
        vendorCount,
        consultantCount,
        totalSelected: vendorCount + consultantCount
      };
    });
  },

  addConsultant: (id: string) => {
    set((state) => {
      const consultants = state.consultants.map(consultant =>
        consultant.id === id ? { ...consultant, selected: true } : consultant
      );
      const vendorCount = state.vendors.filter(v => v.selected).length;
      const consultantCount = consultants.filter(c => c.selected).length;
      
      return {
        consultants,
        vendorCount,
        consultantCount,
        totalSelected: vendorCount + consultantCount
      };
    });
  },

  setVisibility: (visibility: 'PRIVATE' | 'LIMITED' | 'PUBLIC') => {
    set({ visibility });
  },

  reset: () => {
    set({
      vendors: MOCK_VENDORS,
      consultants: MOCK_CONSULTANTS,
      visibility: 'LIMITED',
      totalSelected: 0,
      vendorCount: 0,
      consultantCount: 0
    });
  }
}));
[store.ts: end]

File: state/preview/types.ts
[types.ts: start]
export interface Vendor {
  id: string;
  name: string;
  logo: string;
  match: number;
  grantTag: 'PSG' | 'EDG' | 'NON_GRANT';
  sector: string;
  product: string;
  costRange: [number, number];
  duration: [number, number];
  reason: string;
  tags: string[];
  selected: boolean;
}

export interface Consultant {
  id: string;
  name: string;
  logo: string;
  match: number;
  specialty: string;
  experience: string;
  successRate: number;
  coreFocus: string[];
  rating: number;
  avgTurnaround: number;
  selected: boolean;
}

export interface PreviewState {
  vendors: Vendor[];
  consultants: Consultant[];
  visibility: 'PRIVATE' | 'LIMITED' | 'PUBLIC';
  totalSelected: number;
  vendorCount: number;
  consultantCount: number;
}
[types.ts: end]

File: state/store.ts
[store.ts: start]
import { create } from 'zustand';
import { immer } from 'zustand/middleware/immer';
import { AppState, ReqDoc, Lead, Proposal, Quotation, Match } from './types';
import { mockCompanies, mockUsers, mockTRHLS, mockWallets } from '../mocks/seeds';

export const useAppStore = create<AppState>()(
  immer((set, get) => ({
    // Initial state
    companies: mockCompanies,
    users: mockUsers,
    reqDocs: [],
    trhls: mockTRHLS,
    leads: [],
    proposals: [],
    quotations: [],
    matches: [],
    wallets: mockWallets,
    currentPersona: 'SME',
    currentReqDocId: undefined,

    // Actions
    setCurrentPersona: (persona) => {
      set((state) => {
        state.currentPersona = persona;
      });
    },

    createReqDoc: (reqDocData) => {
      const id = `reqdoc-${Date.now()}`;
      const now = new Date().toISOString();
      
      set((state) => {
        state.reqDocs.push({
          ...reqDocData,
          id,
          createdAt: now,
          updatedAt: now,
        });
        state.currentReqDocId = id;
      });
      
      return id;
    },

    selectTRHLS: (reqDocId, trhlsIds) => {
      set((state) => {
        const reqDoc = state.reqDocs.find(rd => rd.id === reqDocId);
        if (reqDoc) {
          reqDoc.trhlsSelectedIds = trhlsIds;
          reqDoc.updatedAt = new Date().toISOString();
        }
      });
    },

    setVisibility: (reqDocId, visibility) => {
      set((state) => {
        const reqDoc = state.reqDocs.find(rd => rd.id === reqDocId);
        if (reqDoc) {
          reqDoc.visibility = visibility;
          reqDoc.updatedAt = new Date().toISOString();
        }
      });
    },

    setMatchingMode: (reqDocId, mode) => {
      set((state) => {
        const reqDoc = state.reqDocs.find(rd => rd.id === reqDocId);
        if (reqDoc) {
          reqDoc.matchingMode = mode;
          reqDoc.updatedAt = new Date().toISOString();
        }
      });
    },

    seedMatchingForReqDoc: (reqDocId) => {
      set((state) => {
        const reqDoc = state.reqDocs.find(rd => rd.id === reqDocId);
        if (!reqDoc) return;

        // Create match
        const matchId = `match-${Date.now()}`;
        const vendorUserIds = state.users.filter(u => u.persona === 'VENDOR').map(u => u.id);
        const consultantUserIds = state.users.filter(u => u.persona === 'CONSULTANT').map(u => u.id);
        
        state.matches.push({
          id: matchId,
          reqDocId,
          vendorUserIds,
          consultantUserIds,
          createdAt: new Date().toISOString()
        });

        // Create leads for vendors
        vendorUserIds.forEach((userId, index) => {
          const leadId = `lead-vendor-${reqDocId}-${index}`;
          state.leads.push({
            id: leadId,
            reqDocId,
            audience: 'VENDOR',
            maskedPreview: {
              summary: `F&B company seeking ${reqDoc.trhlsSelectedIds.length > 0 ? 'technology solution' : 'business solution'}`,
              budgetBand: reqDoc.budgetBand,
              urgency: reqDoc.complexity === 'HIGH' ? 'HIGH' : reqDoc.complexity === 'MEDIUM' ? 'MEDIUM' : 'LOW',
              grantTag: reqDoc.grantRelevant ? (reqDoc.trhlsSelectedIds.includes('trhls-1') ? 'PSG' : 'EDG') : undefined
            },
            priceCredits: 1,
            qualificationScore: reqDoc.qualificationScore,
            expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(), // 7 days
            createdAt: new Date().toISOString()
          });
        });

        // Create leads for consultants
        consultantUserIds.forEach((userId, index) => {
          const leadId = `lead-consultant-${reqDocId}-${index}`;
          state.leads.push({
            id: leadId,
            reqDocId,
            audience: 'CONSULTANT',
            maskedPreview: {
              summary: `F&B company seeking ${reqDoc.trhlsSelectedIds.length > 0 ? 'technology solution' : 'business solution'}`,
              budgetBand: reqDoc.budgetBand,
              urgency: reqDoc.complexity === 'HIGH' ? 'HIGH' : reqDoc.complexity === 'MEDIUM' ? 'MEDIUM' : 'LOW',
              grantTag: reqDoc.grantRelevant ? (reqDoc.trhlsSelectedIds.includes('trhls-1') ? 'PSG' : 'EDG') : undefined
            },
            priceCredits: 1,
            qualificationScore: reqDoc.qualificationScore,
            expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(), // 7 days
            createdAt: new Date().toISOString()
          });
        });

        // Update reqDoc status
        reqDoc.status = 'SHORTLISTED';
        reqDoc.updatedAt = new Date().toISOString();
      });
    },

    acceptLead: (leadId, userId) => {
      set((state) => {
        const lead = state.leads.find(l => l.id === leadId);
        const wallet = state.wallets.find(w => w.userId === userId);
        
        if (lead && wallet && wallet.balance >= lead.priceCredits) {
          lead.acceptedByUserId = userId;
          wallet.balance -= lead.priceCredits;
          
          // Update reqDoc status if needed
          const reqDoc = state.reqDocs.find(rd => rd.id === lead.reqDocId);
          if (reqDoc && reqDoc.status === 'SHORTLISTED') {
            reqDoc.status = 'PREVIEWED';
            reqDoc.updatedAt = new Date().toISOString();
          }
        }
      });
    },

    submitProposal: (proposalData) => {
      const id = `proposal-${Date.now()}`;
      
      set((state) => {
        state.proposals.push({
          ...proposalData,
          id,
          createdAt: new Date().toISOString()
        });
      });
      
      return id;
    },

    submitQuotation: (quotationData) => {
      const id = `quotation-${Date.now()}`;
      
      set((state) => {
        state.quotations.push({
          ...quotationData,
          id,
          createdAt: new Date().toISOString()
        });
      });
      
      return id;
    },

    finalizeIndicatives: (reqDocId) => {
      set((state) => {
        const reqDoc = state.reqDocs.find(rd => rd.id === reqDocId);
        if (reqDoc) {
          reqDoc.status = 'INDICATIVE';
          reqDoc.updatedAt = new Date().toISOString();
        }
      });
    },

    awardVendor: (reqDocId, vendorUserId) => {
      set((state) => {
        const reqDoc = state.reqDocs.find(rd => rd.id === reqDocId);
        if (reqDoc) {
          reqDoc.status = 'AWARDED';
          reqDoc.updatedAt = new Date().toISOString();
        }
      });
    },

    awardConsultant: (reqDocId, consultantUserId) => {
      set((state) => {
        const reqDoc = state.reqDocs.find(rd => rd.id === reqDocId);
        if (reqDoc) {
          reqDoc.status = 'AWARDED';
          reqDoc.updatedAt = new Date().toISOString();
        }
      });
    }
  }))
);
[store.ts: end]

File: state/trhls/impact.ts
[impact.ts: start]
import { TRHLSOption } from "../types";

export const formatImpact = (opt: TRHLSOption) => [
  { label: "Revenue Lift", value: `${opt.businessImpact.revenueLiftPct}%` },
  { label: "New Leads / mo", value: `${opt.businessImpact.leadDeltaPerMonth}` },
  { label: "CAC Change", value: `${opt.businessImpact.cacChangePct}%` },
  { label: "Time to First Lead", value: `${opt.businessImpact.timeToFirstLeadWeeks} wks` }
];

export const getGrantBadgeColor = (grantTag: string) => {
  switch (grantTag) {
    case "PSG":
      return "bg-blue-100 text-blue-700 border-blue-200";
    case "EDG":
      return "bg-emerald-100 text-emerald-700 border-emerald-200";
    case "NON_GRANT":
      return "bg-slate-100 text-slate-700 border-slate-200";
    default:
      return "bg-gray-100 text-gray-700 border-gray-200";
  }
};

export const getImpactColor = (value: number, type: 'revenue' | 'leads' | 'cac' | 'time') => {
  if (type === 'cac') {
    return value < 0 ? 'text-emerald-600' : 'text-red-600';
  }
  if (type === 'time') {
    return value <= 3 ? 'text-emerald-600' : value <= 6 ? 'text-amber-600' : 'text-slate-600';
  }
  return value >= 10 ? 'text-emerald-600' : value >= 5 ? 'text-amber-600' : 'text-slate-600';
};
[impact.ts: end]

File: state/trhls/store.ts
[store.ts: start]
import { create } from "zustand";
import { TRHLSOption } from "../types";
import { TRHLS_FOR_MARKETING_VISIBILITY } from "../../mocks/seeds.trhls";

interface TRHLSState {
  all: TRHLSOption[];
  selected: TRHLSOption[];
  toggleSelect: (id: string) => void;
  clear: () => void;
}

export const useTrhlsStore = create<TRHLSState>((set, get) => ({
  all: TRHLS_FOR_MARKETING_VISIBILITY,
  selected: [],
  toggleSelect: (id) => {
    const { selected, all } = get();
    const exists = selected.find((s) => s.id === id);
    if (exists) {
      set({ selected: selected.filter((s) => s.id !== id) });
    } else if (selected.length < 3) {
      const newSel = all.find((s) => s.id === id);
      if (newSel) set({ selected: [...selected, newSel] });
    }
  },
  clear: () => set({ selected: [] })
}));
[store.ts: end]

File: state/types.ts
[types.ts: start]
export type Persona = 'SME' | 'VENDOR' | 'CONSULTANT';

export interface Company {
  id: string;
  name: string;
  jurisdiction: 'SG';
  industry: string;
  revenueBand: string;
  headcountBand: string;
}

export interface User {
  id: string;
  name: string;
  persona: Persona;
  companyId: string;
  credits: number;
}

export type VisibilityLevel = 'PRIVATE' | 'LIMITED' | 'PUBLIC';
export type MatchingMode = 'SME_SELF_MANAGED' | 'CONSULTANT_MANAGED';

export interface TRHLSOption {
  id: string;
  name: string;                 // e.g., "Cloud ERP Implementation"
  grantTag: 'PSG' | 'EDG' | 'NON_GRANT';
  whyFit: string;               // explainable text
  estCostBand: [number, number];
  estDurationMonths: [number, number];
  businessImpact: { 
    revenueLiftPct?: number; 
    costSavePct?: number; 
    opsSpeedupPct?: number;
    leadDeltaPerMonth?: number;
    cacChangePct?: number;
    timeToFirstLeadWeeks?: number;
  };
  grantWhy?: string;            // "Pre-approved under PSG â€¦"
  rationaleSignals?: string[];  // AI reasoning signals
}

export interface ReqDoc {
  id: string;
  companyId: string;
  problem: string;
  goal: string;
  domain: string;
  complexity: 'LOW' | 'MEDIUM' | 'HIGH';
  budgetBand: [number, number];
  timelineMonths: [number, number];
  grantRelevant: boolean;
  trhlsSelectedIds: string[];   // chosen solution paths (1â€“2)
  visibility: VisibilityLevel;
  matchingMode?: MatchingMode;
  qualificationScore: number;   // 0â€“100
  status: 'NEW' | 'SHORTLISTED' | 'PREVIEWED' | 'ACCEPTED' | 'INDICATIVE' | 'QNA' | 'DECISIONED' | 'AWARDED';
  createdAt: string;
  updatedAt: string;
}

export interface Lead {
  id: string;
  reqDocId: string;
  audience: 'VENDOR' | 'CONSULTANT';
  maskedPreview: { 
    summary: string; 
    budgetBand: [number, number]; 
    urgency: 'LOW'|'MEDIUM'|'HIGH'; 
    grantTag?: 'PSG'|'EDG'|'NON_GRANT' 
  };
  priceCredits: number;
  qualificationScore: number;
  expiresAt: string;
  acceptedByUserId?: string; // when accepted â†’ unmask
  createdAt: string;
}

export interface Quotation { 
  id: string; 
  vendorUserId: string; 
  reqDocId: string; 
  priceBand: [number, number]; 
  summary: string; 
  version: number;
  createdAt: string;
}

export interface Proposal { 
  id: string; 
  consultantUserId: string; 
  reqDocId: string; 
  feeBand: [number, number]; 
  approach: string; 
  timeline: [number, number]; 
  version: number;
  createdAt: string;
}

export interface Match { 
  id: string; 
  reqDocId: string; 
  vendorUserIds: string[]; 
  consultantUserIds: string[];
  createdAt: string;
}

export interface CreditWallet { 
  userId: string; 
  balance: number;
}

// Store state interface
export interface AppState {
  // Data arrays
  companies: Company[];
  users: User[];
  reqDocs: ReqDoc[];
  trhls: TRHLSOption[];
  leads: Lead[];
  proposals: Proposal[];
  quotations: Quotation[];
  matches: Match[];
  wallets: CreditWallet[];
  
  // UI state
  currentPersona: Persona;
  currentReqDocId?: string;
  
  // Actions
  setCurrentPersona: (persona: Persona) => void;
  createReqDoc: (reqDoc: Omit<ReqDoc, 'id' | 'createdAt' | 'updatedAt'>) => string;
  selectTRHLS: (reqDocId: string, trhlsIds: string[]) => void;
  setVisibility: (reqDocId: string, visibility: VisibilityLevel) => void;
  setMatchingMode: (reqDocId: string, mode: MatchingMode) => void;
  seedMatchingForReqDoc: (reqDocId: string) => void;
  acceptLead: (leadId: string, userId: string) => void;
  submitProposal: (proposal: Omit<Proposal, 'id' | 'createdAt'>) => string;
  submitQuotation: (quotation: Omit<Quotation, 'id' | 'createdAt'>) => string;
  finalizeIndicatives: (reqDocId: string) => void;
  awardVendor: (reqDocId: string, vendorUserId: string) => void;
  awardConsultant: (reqDocId: string, consultantUserId: string) => void;
}
[types.ts: end]

File: styles/index.css
[index.css: start]
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  body {
    font-family: 'Inter', sans-serif;
  }
}

@layer utilities {
  .animate-fade-in {
    animation: fadeIn 0.5s ease-in-out;
  }
  
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
}

/* Custom slider styles */
.slider {
  -webkit-appearance: none;
  appearance: none;
  background: transparent;
  cursor: pointer;
}

.slider::-webkit-slider-track {
  background: #e2e8f0;
  height: 8px;
  border-radius: 4px;
}

.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  background: #3b82f6;
  height: 20px;
  width: 20px;
  border-radius: 50%;
  cursor: pointer;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  transition: all 0.2s ease;
}

.slider::-webkit-slider-thumb:hover {
  background: #2563eb;
  transform: scale(1.1);
}

.slider::-moz-range-track {
  background: #e2e8f0;
  height: 8px;
  border-radius: 4px;
  border: none;
}

.slider::-moz-range-thumb {
  background: #3b82f6;
  height: 20px;
  width: 20px;
  border-radius: 50%;
  cursor: pointer;
  border: none;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  transition: all 0.2s ease;
}

.slider::-moz-range-thumb:hover {
  background: #2563eb;
  transform: scale(1.1);
}

/* Enhanced textarea and form styling */
.goal-textarea {
  background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  border: 2px solid #e2e8f0;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.goal-textarea:focus {
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1), 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  background: #ffffff;
}

.goal-textarea:hover {
  border-color: #cbd5e1;
  box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.1);
}

/* Intent chip animations */
.intent-chip {
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  transform: translateY(0);
}

.intent-chip:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 8px -2px rgba(0, 0, 0, 0.1);
}

.intent-chip.selected {
  transform: translateY(-2px);
  box-shadow: 0 6px 12px -2px rgba(0, 0, 0, 0.15);
}

/* AI Coach animations */
.ai-coach-enter {
  animation: slideInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Character counter animation */
.character-counter {
  animation: fadeIn 0.2s ease-in-out;
}

/* Progress bar enhancements */
.progress-bar {
  background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%);
  box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
}
[index.css: end]

